<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Quality - أناقة متجددة</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

    <style>
        /* --- Base & Variables --- */
        :root {
            --bg-color: #1a1a1a;
            --surface-color: #242424;
            --card-bg: #2f2f2f;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0; /* Ensure contrast with --surface-color */
            --primary-accent: #e4c17a; /* Ensure contrast with --surface-color */
            --primary-accent-darker: #c7a55d;
            --primary-accent-hover: #f9e8c0;
            --border-color: #404040;
            --shadow-color: rgba(0, 0, 0, 0.6);
            --shadow-light: rgba(0, 0, 0, 0.3);
            --glow-color: rgba(228, 193, 122, 0.25);
            --success-color: #66bb6a;
            --error-color: #ef5350;
            --new-badge-bg: #42a5f5;
            --wishlist-heart: #ff7979;
            --remove-btn-color: var(--error-color);
            --remove-btn-hover-bg: rgba(239, 83, 80, 0.15);
            --button-active-bg: rgba(228, 193, 122, 0.15);
            --light-bg-color: #fdfdfd;
            --light-surface-color: #ffffff;
            --light-card-bg: #ffffff;
            --light-text-primary: #1f1f1f;
            --light-text-secondary: #555; /* Ensure contrast with --light-surface-color */
            --light-border-color: #e5e5e5;
            --light-shadow-color: rgba(0, 0, 0, 0.1);
            --light-shadow-light: rgba(0, 0, 0, 0.06);
            --light-glow-color: rgba(228, 193, 122, 0.15);
            --light-button-active-bg: rgba(228, 193, 122, 0.1);
            --light-remove-btn-hover-bg: rgba(239, 83, 80, 0.1);
            --header-height: 70px;
            --bottom-nav-height: 60px;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 18px;
            --transition-fast: 0.25s ease;
            --transition-medium: 0.4s ease;
            --main-font: 'Cairo', sans-serif;
            --heading-font: 'Playfair Display', serif;
            --section-padding: 60px 0;
        }
        body.light-theme {
             /* Light theme variables */
            --bg-color: var(--light-bg-color); --surface-color: var(--light-surface-color); --card-bg: var(--light-card-bg); --text-primary: var(--light-text-primary); --text-secondary: var(--light-text-secondary); --border-color: var(--light-border-color); --shadow-color: var(--light-shadow-color); --shadow-light: var(--light-shadow-light); --glow-color: var(--light-glow-color); --remove-btn-hover-bg: var(--light-remove-btn-hover-bg); --button-active-bg: var(--light-button-active-bg);
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; scroll-padding-top: calc(var(--header-height) + 20px); }
        body { font-family: var(--main-font); background-color: var(--bg-color); color: var(--text-primary); line-height: 1.7; overflow-x: hidden; padding-bottom: var(--bottom-nav-height); font-weight: 400; transition: background-color var(--transition-medium), color var(--transition-medium); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; -webkit-tap-highlight-color: transparent; }
        .container { width: 90%; max-width: 1400px; margin: 0 auto; padding: 0 15px; }
        img { max-width: 100%; height: auto; display: block; }
        a { text-decoration: none; color: var(--primary-accent); transition: color var(--transition-fast); }
        a:hover { color: var(--primary-accent-hover); }
        h1, h2, h3, h4 { line-height: 1.3; margin-bottom: 0.75em; font-weight: 700; }
        h1 { font-family: var(--heading-font); font-size: clamp(2.5rem, 5vw, 3.5rem); color: var(--primary-accent); }
        h2 { font-family: var(--heading-font); font-size: clamp(1.8rem, 4vw, 2.5rem); color: var(--primary-accent); text-align: center; margin-bottom: 1.5em; }
        h3 { font-size: 1.25rem; color: var(--text-primary); margin-bottom: 0.5em; font-weight: 600; }
        h4 { font-size: 1.1rem; color: var(--primary-accent); font-weight: 600; }
        .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
        .section-padding { padding: var(--section-padding); }
        .text-center { text-align: center; }
        .display-none { display: none !important; }

        /* Buttons */
        .button-base, .icon-button { display: inline-flex; align-items: center; justify-content: center; border-radius: var(--border-radius-sm); border: none; font-family: var(--main-font); font-weight: 600; cursor: pointer; transition: all var(--transition-fast); text-align: center; padding: 10px 22px; font-size: 0.95rem; -webkit-tap-highlight-color: rgba(0,0,0,0.05); }
        .button-base:active, .icon-button:active { transform: scale(0.97); background-color: var(--button-active-bg); }
        .button-primary { background-color: var(--primary-accent); color: #111; box-shadow: 0 4px 12px var(--shadow-light); }
        .button-primary:hover { background-color: var(--primary-accent-hover); transform: translateY(-2px); box-shadow: 0 6px 16px var(--shadow-light); }
        .button-primary:active { background-color: var(--primary-accent-darker); transform: scale(0.97); box-shadow: 0 2px 8px var(--shadow-light); }
        .button-secondary { background-color: transparent; color: var(--primary-accent); border: 1px solid var(--primary-accent); }
        .button-secondary:hover { background-color: var(--button-active-bg); border-color: var(--primary-accent-hover); color: var(--primary-accent-hover); }
        .button-secondary:active { background-color: var(--button-active-bg); border-color: var(--primary-accent-darker); transform: scale(0.97); }
        .icon-button { background: none; color: var(--text-secondary); font-size: 1.3rem; padding: 8px; border-radius: 50%; } /* Base size 1.3rem */
        .icon-button:hover { color: var(--primary-accent); background-color: rgba(255, 255, 255, 0.05); }
        body.light-theme .icon-button:hover { background-color: rgba(0, 0, 0, 0.05); }
        .icon-button:active { color: var(--primary-accent-darker); transform: scale(0.95); }

        /* Header */
        header { position: sticky; top: 0; z-index: 1000; background-color: rgba(26, 26, 26, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-color); height: var(--header-height); transition: background-color var(--transition-medium), border-color var(--transition-medium); }
        body.light-theme header { background-color: rgba(253, 253, 253, 0.85); }
        .header-content { display: flex; justify-content: space-between; align-items: center; height: 100%; }
        .logo img { max-height: 45px; transition: transform var(--transition-fast); filter: brightness(1.1); }
        .logo img:hover { transform: scale(1.05); }
        nav.desktop-nav ul { list-style: none; display: flex; gap: 35px; }
        nav.desktop-nav ul li a { color: var(--text-secondary); font-weight: 600; font-size: 1rem; padding-bottom: 6px; position: relative; letter-spacing: 0.5px; }
        nav.desktop-nav ul li a::after { content: ''; position: absolute; bottom: -2px; left: 50%; transform: translateX(-50%); width: 0; height: 2px; background-color: var(--primary-accent); transition: width var(--transition-medium); }
        nav.desktop-nav ul li a:hover, nav.desktop-nav ul li a.active { color: var(--primary-accent); }
        nav.desktop-nav ul li a:hover::after, nav.desktop-nav ul li a.active::after { width: 60%; }
        .header-controls { display: flex; align-items: center; gap: 12px; }
        .filter-control select, .search-container input { padding: 8px 14px; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); background-color: var(--surface-color); color: var(--text-primary); font-family: var(--main-font); font-size: 0.9rem; transition: all var(--transition-fast); }
        .filter-control select:hover, .search-container input:hover { border-color: var(--primary-accent); }
        .filter-control select:focus, .search-container input:focus { outline: none; border-color: var(--primary-accent); box-shadow: 0 0 0 3px var(--glow-color); background-color: var(--card-bg); }
        body.light-theme .filter-control select:focus, body.light-theme .search-container input:focus { background-color: var(--light-surface-color); }
        .search-container { position: relative; }
        .search-container input { padding-right: 40px; width: 200px; }
        .search-container .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none; font-size: 1rem; }
        #wishlist-button, #mobile-wishlist-button { position: relative; }
        #wishlist-count, #mobile-wishlist-count { position: absolute; top: 0px; right: 0px; background-color: var(--wishlist-heart); color: white; font-size: 0.6rem; font-weight: bold; border-radius: 50%; width: 18px; height: 18px; display: flex; justify-content: center; align-items: center; line-height: 1; padding-bottom: 1px; border: 1px solid var(--surface-color); transition: transform 0.2s ease-in-out, background-color 0.2s ease; }
        #wishlist-button.active i, #mobile-wishlist-button.active i { color: var(--wishlist-heart); }
        #wishlist-button.active #wishlist-count, #mobile-wishlist-button.active #mobile-wishlist-count { transform: scale(1.1); background-color: darken(var(--wishlist-heart), 10%); }
        /* Theme toggle buttons will inherit size from .icon-button */
        .mobile-controls { display: none; gap: 8px; }

        /* Hero Section */
        .hero-section { min-height: 65vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.75)), url('https://placehold.co/1920x1080/333333/666666?text=Modern+Fashion') no-repeat center center / cover; padding: 80px 0; text-align: center; position: relative; overflow: hidden; border-bottom: 1px solid var(--border-color); color: #fff; }
        body.light-theme .hero-section { background: linear-gradient(rgba(255,255,255,0.3), rgba(240, 240, 240, 0.6)), url('https://placehold.co/1920x1080/eeeeee/cccccc?text=Modern+Fashion') no-repeat center center / cover; color: var(--light-text-primary); }
        .hero-content { max-width: 750px; animation: fadeInHero 1.2s ease-out 0.2s both; }
        .hero-title { color: #fff; text-shadow: 2px 2px 8px rgba(0,0,0,0.5); margin-bottom: 10px; }
        body.light-theme .hero-title { color: var(--primary-accent); text-shadow: 1px 1px 4px rgba(0,0,0,0.1); }
        .hero-subtitle { font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9; font-weight: 400; color: #e0e0e0; }
        body.light-theme .hero-subtitle { color: var(--light-text-secondary); }
        .hero-cta-button { padding: 12px 35px; font-size: 1.05rem; border-radius: 50px; background: var(--primary-accent); color: #111; box-shadow: 0 5px 15px var(--shadow-color); }
        .hero-cta-button:hover { background: var(--primary-accent-hover); box-shadow: 0 7px 20px var(--shadow-color); transform: scale(1.03) translateY(-2px); }
        .hero-cta-button i { margin-left: 10px; }
        @keyframes fadeInHero { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }

        /* Category Browser Section */
        .category-browser-section { background-color: var(--surface-color); border-bottom: 1px solid var(--border-color); padding: 40px 0; transition: background-color var(--transition-medium); }
        .category-browser-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 25px; max-width: 1000px; margin: 0 auto; }
        .category-card { background-color: var(--card-bg); border-radius: var(--border-radius-md); padding: 20px 15px; text-align: center; border: 1px solid var(--border-color); transition: transform var(--transition-fast), box-shadow var(--transition-fast), background-color var(--transition-medium); cursor: pointer; }
        .category-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px var(--shadow-light); background-color: var(--bg-color); }
        body.light-theme .category-card { background-color: #f9f9f9; }
        body.light-theme .category-card:hover { background-color: var(--light-surface-color); }
        .category-card i { font-size: 2.5rem; color: var(--primary-accent); margin-bottom: 15px; display: block; }
        .category-card span { font-weight: 600; color: var(--text-primary); font-size: 0.95rem; }

        /* --- New Arrivals Carousel Section --- */
        .new-arrivals-section {
            padding: 50px 0;
            background-color: var(--bg-color); /* Match body bg */
            overflow: hidden; /* Important for Swiper */
        }
        .new-arrivals-section .container {
             position: relative; /* For positioning arrows */
        }
        .new-arrivals-section h2 {
            margin-bottom: 1em; /* Less margin for section title */
        }
        .swiper-container {
             width: 100%;
             padding: 10px 0 40px 0; /* Padding for shadow and pagination */
             overflow: visible; /* Allow shadows from cards to show */
        }
        .swiper-slide {
            width: auto; /* Let Swiper calculate width based on slidesPerView */
            padding: 0 10px; /* Spacing between slides handled by spaceBetween */
            box-sizing: border-box;
            height: auto; /* Allow slides to grow */
            display: flex; /* Ensure card takes full height */
        }
        .swiper-slide .product-card {
            width: 100%; /* Card takes full width of the slide */
            height: 100%; /* Card takes full height */
            margin-bottom: 0; /* Remove margin if any */
             box-shadow: 0 4px 12px var(--shadow-light); /* Slightly less shadow for carousel */
        }
        .swiper-slide .product-card:hover {
             transform: translateY(-4px); /* Less hover effect */
             box-shadow: 0 8px 18px var(--shadow-color);
        }
        .swiper-button-next, .swiper-button-prev {
            color: var(--primary-accent);
            background-color: rgba(30, 30, 30, 0.6);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            transition: background-color var(--transition-fast), color var(--transition-fast);
            z-index: 10;
        }
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: var(--primary-accent);
            color: var(--bg-color);
        }
        .swiper-button-next::after, .swiper-button-prev::after {
            font-size: 1rem; /* Adjust arrow size */
            font-weight: bold;
        }
         body.light-theme .swiper-button-next, body.light-theme .swiper-button-prev {
            background-color: rgba(240, 240, 240, 0.7);
            color: var(--light-text-primary);
         }
         body.light-theme .swiper-button-next:hover, body.light-theme .swiper-button-prev:hover {
            background-color: var(--primary-accent);
            color: #111;
         }
        .swiper-pagination-bullet {
            background-color: var(--text-secondary);
            opacity: 0.7;
            transition: background-color var(--transition-fast), opacity var(--transition-fast);
        }
        .swiper-pagination-bullet-active {
            background-color: var(--primary-accent);
            opacity: 1;
        }
        @media (min-width: 768px) {
             .swiper-button-prev { left: -10px; }
             .swiper-button-next { right: -10px; }
        }
        @media (max-width: 767px) {
             .swiper-button-prev, .swiper-button-next { display: none; } /* Hide arrows on mobile */
        }


        /* --- Main Product Display Area --- */
        main#product-section { padding-top: 0; }
        .category-section-header { text-align: center; margin-bottom: 50px; padding-bottom: 15px; }
        #category-title-main { margin-bottom: 0.5em; }
        #category-description { font-size: 1rem; margin-top: -1em; color: var(--text-secondary); }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
            gap: 35px;
            margin-bottom: 40px;
        }
        .product-card { background-color: var(--card-bg); border-radius: var(--border-radius-md); overflow: hidden; border: 1px solid transparent; box-shadow: 0 6px 18px var(--shadow-light); transition: transform var(--transition-medium), box-shadow var(--transition-medium), border-color var(--transition-medium); display: flex; flex-direction: column; position: relative; opacity: 1; transform: none; animation: fadeInUpCard 0.5s ease-out forwards; /* Keep animation definition */ }
        .product-card.hidden { display: none; }
        .product-card:hover { transform: translateY(-6px); box-shadow: 0 10px 25px var(--shadow-color); border-color: var(--border-color); }
        .product-image-container { width: 100%; overflow: hidden; background-color: var(--surface-color); aspect-ratio: 1 / 1.15; position: relative; display: flex; align-items: center; justify-content: center; transition: background-color var(--transition-medium); cursor: pointer; border-bottom: 1px solid var(--border-color); }
        .product-card img { width: 100%; height: 100%; object-fit: contain; transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), filter var(--transition-medium); }
        .product-card:hover img { transform: scale(1.08); filter: brightness(1.1); }
        .product-badges { position: absolute; top: 15px; left: 15px; display: flex; flex-direction: column; gap: 8px; z-index: 2; }
        .badge { color: #fff; font-size: 0.7rem; font-weight: 600; padding: 4px 10px; border-radius: var(--border-radius-sm); text-align: center; display: inline-flex; align-items: center; gap: 5px; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        body.light-theme .badge { background-color: rgba(255, 255, 255, 0.6); color: var(--light-text-primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .badge i { font-size: 0.65rem; opacity: 0.9; }
        .badge.available { background-color: var(--success-color); color: #fff; }
        .badge.new-arrival { background-color: var(--new-badge-bg); color: #fff; }
        body.light-theme .badge.available, body.light-theme .badge.new-arrival { color: #fff; }
        .product-info { padding: 20px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; }
        .product-card h3 { font-size: 1.05rem; color: var(--text-primary); margin-bottom: 8px; line-height: 1.5; font-family: var(--main-font); font-weight: 600; min-height: 45px; }
        .product-card .price-card { font-size: 1.2rem; font-weight: 700; color: var(--primary-accent); margin-bottom: 18px; }
        .product-card .price-card .currency { font-size: 0.8rem; font-weight: 400; color: var(--text-secondary); margin-right: 3px; }
        .product-card-actions { display: flex; justify-content: center; gap: 12px; margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border-color); }
        .product-card-actions .icon-button { font-size: 1.1rem; padding: 8px; background-color: transparent; border-radius: 50%; border: 1px solid transparent; }
        .product-card-actions .icon-button:hover { background-color: var(--surface-color); border-color: var(--border-color); }
        .product-card-actions .icon-button.wishlist-btn { color: var(--text-secondary); }
        .product-card-actions .icon-button.wishlist-btn.active { color: var(--wishlist-heart); }
        .product-card-actions .icon-button.wishlist-btn.active:hover { background-color: rgba(255, 121, 121, 0.1); border-color: var(--wishlist-heart); }
        .product-card-actions .icon-button.quick-order-btn { color: var(--success-color); }
        .product-card-actions .icon-button.quick-order-btn:hover { color: #fff; background-color: var(--success-color); border-color: var(--success-color); }
        @keyframes fadeInUpCard { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Load More Button --- */
        .load-more-container { text-align: center; padding: 20px 0; }
        #load-more-button { padding: 12px 35px; font-size: 1rem; }
        #load-more-button.hidden { display: none; }
        #load-more-button:disabled { opacity: 0.6; cursor: not-allowed; background-color: var(--text-secondary); color: var(--bg-color); }


        /* Features Section */
        .features-section { padding: var(--section-padding); margin-top: 50px; background-color: var(--surface-color); border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); transition: background-color var(--transition-medium), border-color var(--transition-medium); }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto; }
        .feature-item { text-align: center; padding: 35px 30px; background-color: var(--card-bg); border-radius: var(--border-radius-md); border: 1px solid var(--border-color); transition: all var(--transition-medium); box-shadow: 0 4px 10px var(--shadow-light); }
        body.light-theme .feature-item { background-color: var(--light-surface-color); }
        .feature-item:hover { transform: translateY(-6px); box-shadow: 0 8px 20px var(--shadow-light); background-color: var(--bg-color); }
        body.light-theme .feature-item:hover { background-color: #f9f9f9; }
        .feature-item i { font-size: 3rem; color: var(--primary-accent); margin-bottom: 20px; display: block; }
        .feature-item h3 { font-size: 1.2rem; color: var(--text-primary); margin-bottom: 12px; font-family: var(--main-font); font-weight: 600; }
        .feature-item p { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.75; }

        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.75); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity var(--transition-medium), visibility 0s linear var(--transition-medium); z-index: 2000; padding: 20px; }
        body.light-theme .modal-overlay { background-color: rgba(255, 255, 255, 0.65); }
        .modal-overlay.active { opacity: 1; visibility: visible; transition-delay: 0s; }
        .modal-content { background-color: var(--surface-color); color: var(--text-primary); padding: 35px 40px; border-radius: var(--border-radius-lg); position: relative; max-width: 950px; width: 100%; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border-color); box-shadow: 0 15px 45px var(--shadow-color); transform: scale(0.9) translateY(-15px); transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color var(--transition-medium), color var(--transition-medium), opacity 0.3s ease; scrollbar-width: thin; scrollbar-color: var(--primary-accent) var(--bg-color); }
        .modal-content::-webkit-scrollbar { width: 8px; }
        .modal-content::-webkit-scrollbar-track { background: var(--bg-color); border-radius: 10px; }
        .modal-content::-webkit-scrollbar-thumb { background-color: var(--primary-accent); border-radius: 10px; border: 2px solid var(--bg-color); }
        body.light-theme .modal-content { background-color: var(--light-surface-color); }
        .modal-overlay.active .modal-content { transform: scale(1) translateY(0); }
        .modal-close { position: absolute; top: 18px; left: 18px; background: none; border: none; color: var(--text-secondary); font-size: 1.9rem; line-height: 1; cursor: pointer; transition: color var(--transition-fast), transform var(--transition-fast); z-index: 10; padding: 5px; }
        .modal-close:hover { color: var(--primary-accent); transform: rotate(90deg) scale(1.1); }
        .modal-header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .modal-header h2 { font-size: 1.8rem; margin-bottom: 8px; color: var(--primary-accent); font-family: var(--heading-font); }
        .modal-header p { font-size: 1rem; color: var(--text-secondary); }
        .modal-header i { font-size: 2.8rem; color: var(--primary-accent); margin-bottom: 15px; display: block; }
        /* Quick View Modal Specifics */
        #quick-view-modal .modal-content { max-width: 850px; }
        #quick-view-modal .modal-body { display: grid; grid-template-columns: 1fr 1.1fr; gap: 40px; align-items: flex-start; }
        #quick-view-modal .modal-image { border-radius: var(--border-radius-md); overflow: hidden; background-color: var(--bg-color); position: relative; z-index: 1; transition: background-color var(--transition-medium); aspect-ratio: 1 / 1.1; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border-color); }
        body.light-theme #quick-view-modal .modal-image { background-color: #f0f0f0; }
        #quick-view-modal .modal-image img { display: block; max-width: 100%; height: auto; object-fit: contain; cursor: grab; } /* Initial cursor */
        #quick-view-modal .modal-image img:active { cursor: grabbing; }
        .zoom-hint { position:absolute; bottom:10px; right:10px; background:rgba(0,0,0,0.5); color:white; padding: 3px 8px; font-size: 0.7rem; border-radius: 4px; display: none; z-index: 5; /* Ensure hint is above image */ }
        #quick-view-modal .modal-details { position: relative; z-index: 2; padding-top: 10px; }
        #quick-view-modal .modal-details h2 { font-size: 2rem; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; color: var(--primary-accent); font-family: var(--heading-font); text-align: right; }
        #quick-view-modal .info-item { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; font-size: 1.05rem; }
        #quick-view-modal .info-item i { color: var(--primary-accent); width: 22px; text-align: center; font-size: 1.1rem; }
        #quick-view-modal .info-item .label { color: var(--text-secondary); }
        #quick-view-modal .info-item .value { font-weight: 600; color: var(--text-primary); }
        #quick-view-modal .description { color: var(--text-secondary); margin: 25px 0 35px 0; font-size: 1rem; line-height: 1.8; }
        #proceed-button { width: 100%; font-size: 1.1rem; padding: 14px 25px; }
        #proceed-button i { margin-left: 10px; }
        #modal-add-to-wishlist-button { width: 100%; margin-top: 10px; }
        #modal-add-to-wishlist-button i { margin-left: 8px; }
        /* Order Form & Wishlist Modals */
        #order-form-modal .modal-content { max-width: 650px; }
        .order-summary { background-color: var(--bg-color); padding: 20px; margin-bottom: 25px; border-radius: var(--border-radius-md); border: 1px solid var(--border-color); transition: background-color var(--transition-medium), border-color var(--transition-medium); }
        body.light-theme .order-summary { background-color: #f9f9f9; }
        .order-summary h4 { color: var(--primary-accent); margin-bottom: 15px; font-size: 1.2rem; font-weight: 600; border-bottom: 1px dashed var(--primary-accent-darker); padding-bottom: 10px; }
        .order-summary p { font-size: 0.95rem; color: var(--text-primary); margin-bottom: 8px; }
        .order-summary span { font-weight: bold; color: var(--primary-accent); }
        .order-summary i { color: var(--text-secondary); margin-left: 5px; }
        #order-summary-items-list { list-style: none; padding: 0; margin: 15px 0; text-align: right; max-height: 160px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 12px; background-color: var(--surface-color); scrollbar-width: thin; scrollbar-color: var(--primary-accent) var(--bg-color); }
        #order-summary-items-list::-webkit-scrollbar { width: 6px; }
        #order-summary-items-list::-webkit-scrollbar-track { background: var(--surface-color); border-radius: 10px; }
        #order-summary-items-list::-webkit-scrollbar-thumb { background-color: var(--primary-accent); border-radius: 10px; border: 1px solid var(--surface-color); }
        #order-summary-items-list li { font-size: 0.9rem; color: var(--text-secondary); border-bottom: 1px solid var(--border-color); padding-bottom: 8px; margin-bottom: 8px; }
        #order-summary-items-list li:last-child { border-bottom: none; margin-bottom: 0; }
        #order-summary-items-list li span { color: var(--primary-accent); font-weight: 600; margin-right: 5px; }
        #order-form label { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-weight: 600; color: var(--text-secondary); font-size: 0.9rem; text-align: right; }
        #order-form label i { color: var(--primary-accent); width: 16px; }
        #order-form input[type="text"], #order-form input[type="tel"], #order-form textarea { width: 100%; padding: 12px 16px; margin-bottom: 18px; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-primary); font-family: var(--main-font); font-size: 1rem; transition: all var(--transition-medium); }
        body.light-theme #order-form input[type="text"], body.light-theme #order-form input[type="tel"], body.light-theme #order-form textarea { background-color: #fdfdfd; }
        #order-form input:focus, #order-form textarea:focus { outline: none; border-color: var(--primary-accent); background-color: var(--surface-color); box-shadow: 0 0 0 3px var(--glow-color); }
        body.light-theme #order-form input:focus, body.light-theme #order-form textarea:focus { background-color: var(--light-surface-color); }
        #order-form textarea { min-height: 90px; resize: vertical; }
        #form-error-message { color: var(--error-color); background-color: rgba(239, 83, 80, 0.1); border: 1px solid var(--error-color); font-size: 0.9rem; margin-bottom: 18px; display: none; text-align: center; font-weight: bold; padding: 10px; border-radius: var(--border-radius-sm); }
        #modal-whatsapp-button-final { width: 100%; background: linear-gradient(145deg, var(--success-color), #4caf50); color: white; padding: 14px 25px; font-size: 1.05rem; margin-top: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        #modal-whatsapp-button-final:hover { background: linear-gradient(145deg, #4caf50, #81c784); box-shadow: 0 6px 15px rgba(0,0,0,0.3); transform: translateY(-2px); }
        #modal-whatsapp-button-final:active { transform: scale(0.98); box-shadow: none; }
        #modal-whatsapp-button-final i { margin-left: 10px; }
        #wishlist-modal .modal-content { max-width: 750px; }
        #wishlist-items-container { display: flex; flex-direction: column; gap: 18px; margin-top: 25px; max-height: 60vh; overflow-y: auto; padding: 5px 10px 5px 5px; margin-bottom: 25px; scrollbar-width: thin; scrollbar-color: var(--primary-accent) var(--bg-color); }
        #wishlist-items-container::-webkit-scrollbar { width: 6px; }
        #wishlist-items-container::-webkit-scrollbar-track { background: var(--surface-color); border-radius: 10px; }
        #wishlist-items-container::-webkit-scrollbar-thumb { background-color: var(--primary-accent); border-radius: 10px; border: 1px solid var(--surface-color); }
        body.light-theme #wishlist-items-container::-webkit-scrollbar-track { background: var(--light-bg-color); }
        body.light-theme #wishlist-items-container::-webkit-scrollbar-thumb { border: 1px solid var(--light-bg-color); }
        .wishlist-item { display: flex; align-items: center; gap: 18px; background-color: var(--bg-color); padding: 15px; border-radius: var(--border-radius-md); border: 1px solid var(--border-color); transition: background-color var(--transition-medium), border-color var(--transition-medium), transform 0.2s ease; }
        body.light-theme .wishlist-item { background-color: #f9f9f9; }
        .wishlist-item:hover { transform: translateX(-5px); border-color: var(--primary-accent); }
        .wishlist-item-image { width: 80px; height: 80px; border-radius: var(--border-radius-sm); overflow: hidden; flex-shrink: 0; background-color: var(--surface-color); border: 1px solid var(--border-color); }
        body.light-theme .wishlist-item-image { background-color: #eee; }
        .wishlist-item-image img { width: 100%; height: 100%; object-fit: contain; }
        .wishlist-item-details { flex-grow: 1; text-align: right; }
        .wishlist-item-details h4 { font-size: 1.05rem; font-weight: 600; margin-bottom: 6px; color: var(--text-primary); font-family: var(--main-font); }
        .wishlist-item-details p { font-size: 1rem; color: var(--primary-accent); font-weight: bold; margin-bottom: 0; }
        .wishlist-item-actions { display: flex; gap: 10px; align-items: center; flex-shrink: 0; }
        .wishlist-item-actions .wishlist-remove-item-btn { color: var(--remove-btn-color); font-size: 1.2rem; padding: 8px; background: none; border: none; border-radius: 50%; }
        .wishlist-item-actions .wishlist-remove-item-btn:hover { background-color: var(--remove-btn-hover-bg); }
        #wishlist-order-all-btn { width: 100%; margin-top: 20px; padding: 14px 25px; font-size: 1.05rem; background: linear-gradient(145deg, var(--success-color), #4caf50); color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        #wishlist-order-all-btn:hover:not(:disabled) { background: linear-gradient(145deg, #4caf50, #81c784); box-shadow: 0 6px 15px rgba(0,0,0,0.3); transform: translateY(-2px); }
        #wishlist-order-all-btn:disabled { background: var(--text-secondary); cursor: not-allowed; opacity: 0.6; transform: none; box-shadow: none; }
        #wishlist-order-all-btn:active:not(:disabled) { transform: scale(0.98); box-shadow: none; }
        #wishlist-order-all-btn i { margin-left: 10px; }
        #wishlist-empty-message { text-align: center; padding: 50px 20px; color: var(--text-secondary); font-size: 1.1rem; }
        #wishlist-empty-message i.fa-heart-crack { font-size: 3.5rem; display: block; margin-bottom: 20px; color: var(--primary-accent); opacity: 0.8; }
        #wishlist-empty-message i.fa-heart { color: var(--wishlist-heart); vertical-align: middle; }


        /* Footer */
        footer { text-align: center; margin-top: 80px; padding: 50px 20px; background-color: var(--surface-color); color: var(--text-secondary); font-size: 0.95rem; border-top: 1px solid var(--border-color); transition: background-color var(--transition-medium), color var(--transition-medium), border-color var(--transition-medium); }
        footer p { margin-bottom: 10px; font-weight: 400; }
        footer a { font-weight: 600; }
        footer a i { margin-left: 6px; font-size: 1.1em; vertical-align: middle; }
        .footer-logo img { max-height: 40px; margin-bottom: 15px; opacity: 0.8; filter: grayscale(50%) contrast(1.1); }
        body.light-theme .footer-logo img { filter: grayscale(30%) contrast(1); }

        /* No Results */
        #no-results { text-align: center; font-size: 1.2rem; color: var(--text-secondary); display: none; margin: 80px auto; padding: 40px; background-color: var(--surface-color); border-radius: var(--border-radius-md); border: 1px solid var(--border-color); max-width: 600px; }
        #no-results i { color: var(--primary-accent); margin-bottom: 20px; font-size: 2.5rem; display: block; }

        /* --- Bottom Navigation --- */
        .bottom-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: var(--bottom-nav-height); background-color: var(--surface-color); box-shadow: 0 -6px 18px var(--shadow-light); border-top: 1px solid var(--border-color); z-index: 1001; transition: background-color var(--transition-medium), border-color var(--transition-medium); }
        .bottom-nav ul { list-style: none; display: flex; justify-content: space-around; align-items: stretch; height: 100%; }
        .bottom-nav ul li { flex: 1; }
        .bottom-nav ul li a { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary); /* Ensure contrast */ font-size: 0.85rem; /* Default mobile text size */ font-weight: 600; padding: 4px 0; transition: color var(--transition-fast), transform 0.2s ease; position: relative; text-align: center; }
        .bottom-nav ul li a i { font-size: 1.6rem; /* Default mobile icon size */ margin-bottom: 3px; display: block; transition: transform 0.2s ease; }
        .bottom-nav ul li a.active { color: var(--primary-accent); /* Ensure contrast */ }
        .bottom-nav ul li a.active i { transform: scale(1.15); }
        .bottom-nav ul li a:active { transform: scale(0.95); background-color: var(--button-active-bg); }
        .bottom-nav ul li a .nav-text { display: block; line-height: 1.2; }

        /* Mobile Overlays */
        .mobile-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 1500; display: flex; justify-content: center; align-items: flex-start; padding-top: calc(var(--header-height) + 30px); opacity: 0; visibility: hidden; transition: opacity var(--transition-medium), visibility 0s linear var(--transition-medium); }
        body.light-theme .mobile-overlay { background-color: rgba(255, 255, 255, 0.6); }
        .mobile-overlay.active { opacity: 1; visibility: visible; transition-delay: 0s; }
        .mobile-overlay-content { background-color: var(--surface-color); padding: 30px 25px; border-radius: var(--border-radius-md); box-shadow: 0 8px 25px var(--shadow-color); width: 90%; max-width: 400px; transform: translateY(-25px); transition: transform var(--transition-medium), background-color var(--transition-medium); border: 1px solid var(--border-color); position: relative; }
        body.light-theme .mobile-overlay-content { background-color: var(--light-surface-color); }
        .mobile-overlay.active .mobile-overlay-content { transform: translateY(0); }
        .mobile-overlay-close { position: absolute; top: 12px; left: 12px; font-size: 1.7rem; }
        .mobile-overlay h3 { color: var(--primary-accent); font-size: 1.4rem; text-align: center; margin-bottom: 25px; font-family: var(--main-font); font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .mobile-overlay .filter-control select, .mobile-overlay .search-container input { width: 100%; margin-bottom: 20px; font-size: 1rem; padding: 12px 14px; background-color: var(--bg-color); }
        body.light-theme .mobile-overlay .filter-control select, body.light-theme .mobile-overlay .search-container input { background-color: var(--light-bg-color); }
        .mobile-overlay .search-container { width: 100%; }
        .mobile-overlay .search-container input { padding-right: 40px; }
        .mobile-overlay .search-container .search-icon { right: 14px; }
        #apply-mobile-filters, #apply-mobile-search { width: 100%; margin-top: 10px; padding: 12px; font-size: 1rem; }


        /* Scrollbar Styling */
        body::-webkit-scrollbar { width: 10px; }
        body::-webkit-scrollbar-track { background: var(--bg-color); }
        body::-webkit-scrollbar-thumb { background-color: var(--primary-accent); border-radius: 10px; border: 2px solid var(--bg-color); }
        body.light-theme::-webkit-scrollbar-track { background: var(--light-bg-color); }
        body.light-theme::-webkit-scrollbar-thumb { border: 2px solid var(--light-bg-color); }

        /* Responsive Adjustments */
        @media (max-width: 1200px) { .container { width: 95%; } .product-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; } h1 { font-size: clamp(2.2rem, 4.5vw, 3rem); } h2 { font-size: clamp(1.6rem, 3.5vw, 2.2rem); } }

        @media (max-width: 992px) {
            nav.desktop-nav { display: none; }
            /* --- MODIFICATION START: Hide ALL desktop header controls --- */
            .header-controls { display: none; }
            /* --- MODIFICATION END --- */
            .mobile-controls { display: flex; } /* Show mobile controls */
            .product-grid { grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 25px; }
            #quick-view-modal .modal-body { grid-template-columns: 1fr; gap: 25px; }
            #quick-view-modal .modal-image { aspect-ratio: 1 / 1; min-height: 320px; }
            #quick-view-modal .modal-details h2 { font-size: 1.8rem; text-align: center; }
            .hero-section { min-height: 55vh; padding: 60px 0; }
            #wishlist-modal .modal-content { max-width: 90%; }
            .category-browser-grid { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 20px; }
            .category-card i { font-size: 2.2rem; }
            .category-card span { font-size: 0.9rem; }
        }

        @media (max-width: 768px) {
            :root { --header-height: 65px; --bottom-nav-height: 60px; }
            body { padding-bottom: var(--bottom-nav-height); font-size: 15px; line-height: 1.65; }
            .container { width: 95%; padding: 0 10px; }
            .header-content { padding: 0 15px; }
            .logo img { max-height: 38px; }
            .bottom-nav { display: flex; }
            main#product-section { padding: 40px 0; }
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 20px; }
            .product-info { padding: 15px; }
            .product-card h3 { font-size: 0.95rem; min-height: 40px; margin-bottom: 6px; }
            .product-card .price-card { font-size: 1.05rem; margin-bottom: 12px; }
            .product-card-actions { gap: 10px; padding-top: 12px; }
            .product-card-actions .icon-button { font-size: 1rem; padding: 6px; }
            h1 { font-size: clamp(2rem, 6vw, 2.5rem); }
            h2 { font-size: clamp(1.5rem, 5vw, 1.8rem); margin-bottom: 1.2em; }
            .hero-section { min-height: 50vh; } .hero-subtitle { font-size: 1rem; } .hero-cta-button { font-size: 1rem; padding: 10px 30px; }
            .features-grid { grid-template-columns: 1fr; gap: 25px; } .feature-item { padding: 30px 25px; }
            .modal-content { padding: 25px 20px; max-height: 88vh; }
            #quick-view-modal .modal-details h2 { font-size: 1.6rem; } #quick-view-modal .modal-image { min-height: 280px; }
            #order-form-modal .modal-content { max-width: 95%; } #order-form-modal .modal-header h2 { font-size: 1.5rem; }
            .wishlist-item { flex-direction: row; align-items: center; gap: 12px; padding: 12px; }
            .wishlist-item-image { width: 65px; height: 65px; } .wishlist-item-details h4 { font-size: 1rem; } .wishlist-item-details p { font-size: 0.95rem; }
            .category-browser-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            /* --- MODIFICATION START: Bottom Nav Size Adjustment for Mid-size Mobile --- */
             .bottom-nav ul li a {
                 font-size: 0.85rem; /* Slightly larger text */
             }
             .bottom-nav ul li a i {
                 font-size: 1.7rem; /* Slightly larger icon */
             }
             /* --- MODIFICATION END --- */
        }
        @media (max-width: 500px) {
            :root { --header-height: 60px; --bottom-nav-height: 55px; }
            .product-grid { grid-template-columns: 1fr; gap: 25px; }
            h1 { font-size: clamp(1.8rem, 7vw, 2.2rem); }
            .hero-section { min-height: 45vh; }
            footer { padding: 40px 15px calc(var(--bottom-nav-height) + 20px) 15px; font-size: 0.9rem; }
            /* --- MODIFICATION START: Bottom Nav Size Adjustment for Small Mobile --- */
            .bottom-nav ul li a {
                font-size: 0.9rem; /* Increased significantly */
                padding: 2px 0;
            }
            .bottom-nav ul li a i {
                font-size: 1.8rem; /* Increased significantly */
                margin-bottom: 4px; /* Increased space */
            }
             .bottom-nav ul li a .nav-text {
                 text-align: center;
                 line-height: 1.1;
             }
            /* --- MODIFICATION END --- */
            #wishlist-modal .modal-content { padding: 20px 15px; }
            .wishlist-item { padding: 10px; } .wishlist-item-image { width: 55px; height: 55px; } .wishlist-item-details h4 { font-size: 0.9rem; } .wishlist-item-details p { font-size: 0.9rem; } .wishlist-item-actions .wishlist-remove-item-btn { font-size: 1.1rem; padding: 5px; } #wishlist-order-all-btn { font-size: 1rem; padding: 12px 20px; }
            #quick-view-modal .modal-body { gap: 20px; } #quick-view-modal .modal-image { min-height: 240px; }
            .modal-header h2 { font-size: 1.4rem; } .modal-header p { font-size: 0.9rem; } .modal-header i { font-size: 2.5rem; }
            .category-browser-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .category-card i { font-size: 2rem; } .category-card span { font-size: 0.85rem; }
            .feature-item { padding: 25px 20px; } .feature-item i { font-size: 2.5rem; }
        }

    </style>
</head>
<body>

    <header>
        <div class="header-content container">
            <div class="logo">
                <a href="#" onclick="setActiveCategory('all', this); scrollToProducts(); return false;" aria-label="الصفحة الرئيسية Master Quality">
                    <img src="logo.png" alt="Master Quality Logo" onerror="this.src='https://placehold.co/150x45/2f2f2f/e4c17a?text=Logo'; this.onerror=null;">
                </a>
            </div>
            <nav class="desktop-nav">
                <ul>
                     <li><a href="#product-section" data-category="all" class="nav-link active" onclick="setActiveCategory('all', this); scrollToProducts(); return false;">الكل</a></li>
                     <li><a href="#product-section" data-category="trousers" class="nav-link" onclick="setActiveCategory('trousers', this); scrollToProducts(); return false;">بناطيل</a></li>
                     <li><a href="#product-section" data-category="maternity" class="nav-link" onclick="setActiveCategory('maternity', this); scrollToProducts(); return false;">حوامل</a></li>
                     <li><a href="#product-section" data-category="tops" class="nav-link" onclick="setActiveCategory('tops', this); scrollToProducts(); return false;">توبات</a></li>
                </ul>
            </nav>
            <div class="header-controls"> <div class="filter-control">
                     <select id="size-select" aria-label="فلترة حسب المقاس">
                         <option value="all">كل المقاسات</option>
                         <option value="XS">XS</option> <option value="S">S</option> <option value="M">M</option>
                         <option value="L">L</option> <option value="XL">XL</option> <option value="XXL">XXL</option>
                         <option value="2XL">2XL</option>
                     </select>
                 </div>
                 <div class="search-container">
                     <input type="search" id="search-input" placeholder="بحث عن منتج..." aria-label="بحث عن منتج">
                     <i class="fas fa-search search-icon"></i>
                 </div>
                 <button id="wishlist-button" class="icon-button" aria-label="قائمة الأمنيات">
                     <i class="far fa-heart"></i>
                     <span id="wishlist-count" class="visually-hidden">0</span>
                 </button>
                 <button id="theme-toggle-button" class="icon-button" aria-label="تبديل الوضع المظلم/الفاتح">
                     <i class="fas fa-sun"></i> </button>
            </div>
             <div class="mobile-controls"> <button class="icon-button" id="mobile-filter-btn" aria-label="فتح خيارات الفلترة"><i class="fas fa-filter"></i></button>
                 <button class="icon-button" id="mobile-search-btn" aria-label="فتح البحث"><i class="fas fa-search"></i></button>
                 <button id="mobile-wishlist-button" class="icon-button" aria-label="فتح قائمة الأمنيات">
                     <i class="far fa-heart"></i>
                     <span id="mobile-wishlist-count" class="visually-hidden">0</span>
                 </button>
                 <button id="mobile-theme-toggle-button" class="icon-button" aria-label="تبديل الوضع المظلم/الفاتح">
                     <i class="fas fa-sun"></i> </button>
             </div>
        </div>
    </header>

    <div id="mobile-search-overlay" class="mobile-overlay">
        <div class="mobile-overlay-content">
            <button class="mobile-overlay-close icon-button" id="close-search-overlay" aria-label="إغلاق البحث">&times;</button>
            <h3><i class="fas fa-search"></i> البحث عن منتج</h3>
            <div class="search-container">
                <input type="search" id="search-input-mobile" placeholder="ادخل اسم المنتج..." aria-label="ادخل اسم المنتج للبحث">
                <i class="fas fa-search search-icon"></i>
            </div>
            <button class="button-primary" id="apply-mobile-search">ابحث الآن</button>
        </div>
    </div>
    <div id="mobile-filter-overlay" class="mobile-overlay">
        <div class="mobile-overlay-content">
            <button class="mobile-overlay-close icon-button" id="close-filter-overlay" aria-label="إغلاق الفلترة">&times;</button>
            <h3><i class="fas fa-filter"></i> فلترة حسب المقاس</h3>
            <div class="filter-control">
                <select id="size-select-mobile" aria-label="اختر المقاس للفلترة">
                    <option value="all">كل المقاسات</option>
                    <option value="XS">XS</option> <option value="S">S</option> <option value="M">M</option>
                    <option value="L">L</option> <option value="XL">XL</option> <option value="XXL">XXL</option>
                    <option value="2XL">2XL</option>
                </select>
            </div>
            <button class="button-primary" id="apply-mobile-filters">تطبيق الفلتر</button>
        </div>
    </div>

    <section class="hero-section">
        <div class="hero-content container">
            <h1 class="hero-title">Master Quality</h1>
            <p class="hero-subtitle">أناقتك تبدأ من هنا. اكتشفي تشكيلتنا المختارة بعناية من أجود المنتجات العصرية.</p>
            <a href="#category-browser" class="hero-cta-button button-base">
                استكشفي الآن <i class="fas fa-arrow-down"></i>
            </a>
        </div>
    </section>

    <section id="category-browser" class="category-browser-section section-padding">
        <div class="container">
            <h2>تصفحي حسب الفئة</h2>
            <div class="category-browser-grid">
                <div class="category-card" data-category="all" onclick="setActiveCategory('all', this); scrollToProducts();">
                    <i class="fas fa-store"></i>
                    <span>جميع المنتجات</span>
                </div>
                <div class="category-card" data-category="trousers" onclick="setActiveCategory('trousers', this); scrollToProducts();">
                    <i class="fas fa-user-secret"></i> <span>بناطيل</span>
                </div>
                <div class="category-card" data-category="maternity" onclick="setActiveCategory('maternity', this); scrollToProducts();">
                    <i class="fas fa-person-pregnant"></i>
                    <span>ملابس حوامل</span>
                </div>
                <div class="category-card" data-category="tops" onclick="setActiveCategory('tops', this); scrollToProducts();">
                    <i class="fas fa-tshirt"></i>
                    <span>توبات وبلوزات</span>
                </div>
            </div>
        </div>
    </section>

    <section class="new-arrivals-section section-padding">
        <div class="container">
            <h2><i class="fas fa-star" style="color: var(--primary-accent); margin-left: 10px;"></i> وصل حديثاً</h2>
            <div class="swiper-container new-arrivals-swiper">
                <div class="swiper-wrapper" id="new-arrivals-wrapper">
                    </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </div>
    </section>

    <main id="product-section" class="container section-padding" style="padding-top: 0;">
        <div id="category-header" class="category-section-header">
            <h2 id="category-title-main">جميع المنتجات</h2>
            <p id="category-description" class="text-secondary"></p>
        </div>

        <div class="product-grid" id="product-grid-main">
            </div>

        <div class="load-more-container">
            <button id="load-more-button" class="button-primary button-base hidden">
                <i class="fas fa-chevron-down" style="margin-left: 8px;"></i> عرض المزيد
            </button>
        </div>

        <div id="no-results" class="section-padding" style="display: none;">
            <i class="fas fa-box-open"></i>
            <p>عذراً، لا توجد منتجات تطابق بحثك أو الفلتر الحالي.</p>
            <p>حاول تغيير معايير البحث أو استعراض فئة أخرى.</p>
        </div>
    </main>

    <section class="features-section section-padding">
        <div class="container">
            <h2 class="features-title">لماذا تختارين Master Quality؟</h2>
            <div class="features-grid">
                <div class="feature-item"> <i class="fas fa-shipping-fast"></i> <h3>توصيل سريع وموثوق</h3> <p>طلباتك تصلك بسرعة وأمان إلى بغداد وجميع المحافظات العراقية.</p> </div>
                <div class="feature-item"> <i class="fas fa-gem"></i> <h3>جودة لا مثيل لها</h3> <p>نختار أرقى الخامات وأحدث التصاميم لنضمن لكِ إطلالة متألقة وعصرية.</p> </div>
                <div class="feature-item"> <i class="fas fa-headset"></i> <h3>خدمة عملاء مميزة</h3> <p>فريقنا جاهز لمساعدتك والإجابة على كافة استفساراتك عبر واتساب.</p> </div>
            </div>
        </div>
    </section>

    <div id="quick-view-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="modal-close-button-qv" class="modal-close" title="إغلاق" aria-label="إغلاق نافذة العرض السريع">&times;</button>
            <div class="modal-body">
                <div class="modal-image">
                     <img id="modal-product-image" src="" alt="صورة المنتج" loading="lazy" onerror="this.src='https://placehold.co/400x450/cccccc/999999?text=Image+Not+Found'; this.onerror=null;">
                     <span class="zoom-hint"><i class="fas fa-search-plus"></i> قرّب الصورة</span>
                </div>
                 <div class="modal-details">
                    <h2 id="modal-product-title">اسم المنتج</h2>
                    <div class="info-item"> <i class="fas fa-ruler-combined"></i> <span class="label">المقاس:</span> <span class="value" id="modal-product-size"></span> </div>
                    <div class="info-item"> <i class="fas fa-tag"></i> <span class="label">السعر:</span> <span class="value" id="modal-product-price"></span>&nbsp;<span class="currency" style="color:var(--text-secondary); font-size: 0.9em;">د.ع</span> </div>
                    <div class="info-item" id="modal-availability-info"> <i class="fas fa-check-circle"></i> <span class="label">التوفر:</span> <span class="value" id="modal-product-availability"></span> </div>
                    <p class="description" id="modal-product-description">وصف المنتج...</p>
                    <button id="proceed-button" class="button-primary button-base"> <i class="fas fa-shopping-cart"></i> إكمال الطلب </button>
                    <button id="modal-add-to-wishlist-button" class="button-secondary button-base"> <i class="far fa-heart"></i> إضافة إلى قائمة الأمنيات </button>
                </div>
            </div>
        </div>
    </div>

    <div id="order-form-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="modal-close-button-order" class="modal-close" title="إغلاق" aria-label="إغلاق نموذج الطلب">&times;</button>
            <div class="modal-header"> <i class="fas fa-truck-fast"></i> <h2>تأكيد الطلب وبيانات التوصيل</h2> <p>خطوة أخيرة لإتمام طلبك (الدفع عند الاستلام)</p> </div>
            <div class="order-summary">
                <h4 id="order-summary-main-title"><i class="fas fa-box-open"></i> المنتج/المنتجات المطلوبة</h4>
                <div id="order-summary-single-item-details"> <p id="order-summary-title">اسم المنتج</p> <p> <i class="fas fa-ruler-combined"></i> المقاس: <span id="order-summary-size"></span> | <i class="fas fa-tag"></i> السعر: <span id="order-summary-price"></span> <span class="currency">د.ع</span> </p> </div>
                <ul id="order-summary-items-list" class="display-none"></ul>
                <input type="hidden" id="order-form-product-id">
                <input type="hidden" id="order-form-product-title">
                <input type="hidden" id="order-form-product-size">
                <input type="hidden" id="order-form-product-price">
            </div>
            <form id="order-form" novalidate>
                <div id="form-error-message"></div>
                <div> <label for="customer-name"><i class="fas fa-user"></i> الاسم الكامل:</label> <input type="text" id="customer-name" name="customerName" required placeholder="الاسم الثلاثي من فضلك..." aria-required="true"> </div>
                <div> <label for="customer-phone"><i class="fas fa-phone"></i> رقم الهاتف (واتساب):</label> <input type="tel" id="customer-phone" name="customerPhone" required pattern="^(07[5789][0-9]{8})$" placeholder="مثال: 07712345678" aria-required="true"> <small style="font-size: 0.8rem; color: var(--text-secondary); display: block; margin-top: -10px; margin-bottom: 10px;">سيتم التواصل معك عبر هذا الرقم.</small> </div>
                <div> <label for="customer-address"><i class="fas fa-map-marker-alt"></i> العنوان الكامل:</label> <textarea id="customer-address" name="customerAddress" rows="3" required placeholder="المحافظة - المدينة/القضاء - المنطقة - أقرب نقطة دالة..." aria-required="true"></textarea> </div>
                <button type="submit" id="modal-whatsapp-button-final" class="button-base"> <i class="fab fa-whatsapp"></i> تأكيد وإرسال الطلب عبر واتساب </button>
            </form>
        </div>
    </div>

    <div id="wishlist-modal" class="modal-overlay">
        <div class="modal-content">
             <button id="modal-close-button-wishlist" class="modal-close" title="إغلاق" aria-label="إغلاق قائمة الأمنيات">&times;</button>
             <div class="modal-header"> <i class="fas fa-heart-circle-check"></i> <h2>قائمة الأمنيات</h2> <p>المنتجات التي نالت إعجابك</p> </div>
             <div id="wishlist-items-container">
                 <div id="wishlist-empty-message" style="display: none;"> <i class="fas fa-heart-crack"></i> <p>قائمة أمنياتك فارغة حالياً.</p> <p>أضف المنتجات التي تعجبك بالضغط على أيقونة القلب <i class="far fa-heart"></i> في صفحة المنتج!</p> </div>
             </div>
             <button id="wishlist-order-all-btn" class="button-base" disabled> <i class="fas fa-shopping-cart"></i> إرسال طلب بجميع المنتجات عبر واتساب </button>
        </div>
     </div>

    <nav class="bottom-nav">
        <ul>
             <li><a href="#product-section" data-category="all" class="nav-link-mobile active" onclick="setActiveCategory('all', this); scrollToProducts(); return false;"><i class="fas fa-store"></i><span class="nav-text">الكل</span></a></li>
             <li><a href="#product-section" data-category="trousers" class="nav-link-mobile" onclick="setActiveCategory('trousers', this); scrollToProducts(); return false;"><i class="fas fa-user-secret"></i><span class="nav-text">بناطيل</span></a></li>
             <li><a href="#product-section" data-category="maternity" class="nav-link-mobile" onclick="setActiveCategory('maternity', this); scrollToProducts(); return false;"><i class="fas fa-person-pregnant"></i><span class="nav-text">حوامل</span></a></li>
             <li><a href="#product-section" data-category="tops" class="nav-link-mobile" onclick="setActiveCategory('tops', this); scrollToProducts(); return false;"><i class="fas fa-tshirt"></i><span class="nav-text">توبات</span></a></li>
        </ul>
    </nav>

    <footer>
        <div class="container">
            <div class="footer-logo">
                <img src="logo.png" alt="Master Quality Logo Footer" onerror="this.src='https://placehold.co/150x40/2f2f2f/a0a0a0?text=Logo'; this.onerror=null;">
            </div>
            <p>&copy; <span id="year"></span> Master Quality. جميع الحقوق محفوظة.</p>
            <p>تصاميم عصرية بجودة تستحقينها.</p>
            <p style="margin-top: 15px;"> للتواصل والطلبات السريعة: <a href="https://wa.me/9647778076465" target="_blank" rel="noopener noreferrer"> <i class="fab fa-whatsapp"></i> راسلنا على واتساب </a> </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
    // --- Product Data (Sample - Replace with your actual data source) ---
    const products = [
        // --- Trousers/Jeggings ---
        { id: 1, title: "بنطلون جيجنز Master Quality أزرق مريح", image: "1.png", price: "12,000", size: "S (كمر 36)", base_size: "S", category: "trousers", availability: "in stock", description: "جيجنز مريح وعملي بلون أزرق جذاب، مثالي للارتداء اليومي.", is_new: false },
        { id: 4, title: "بنطلون جيجنز Master Quality أزرق عملي", image: "4.png", price: "12,000", size: "M (كمر 40)", base_size: "M", category: "trousers", availability: "in stock", description: "جيجنز بقصة عملية ومريحة للاستخدام اليومي.", is_new: false },
        { id: 5, title: "بنطلون Master Quality مطبع بألوان زاهية", image: "5.png", price: "14,000", size: "L (كمر 42)", base_size: "L", category: "trousers", availability: "in stock", description: "بنطلون قماش خفيف بنقشة بيزلي زاهية ومميزة.", is_new: true }, // Marked as new
        { id: 7, title: "بنطلون Master Quality خصر عالي جملي", image: "7.png", price: "15,000", size: "XXL (كمر 48)", base_size: "XXL", category: "trousers", availability: "in stock", description: "بنطلون أنيق بلون جملي دافئ وخصر عالي مع أزرار زينة.", is_new: false },
        { id: 8, title: "بنطلون Master Quality مقلم أرجل واسعة رمادي", image: "8.png", price: "14,000", size: "M (كمر 38)", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون عصري مقلم بقصة أرجل واسعة ومريحة.", is_new: false },
        { id: 9, title: "بنطلون Master Quality أسود بحزام وكسرات", image: "9.png", price: "14,000", size: "M (كمر 38)", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون أسود كلاسيكي مع حزام أنيق وكسرات أمامية لإطلالة رسمية.", is_new: false },
        { id: 10, title: "بنطلون Master Quality بيج أرجل واسعة", image: "10.png", price: "14,000", size: "M (كمر 38)", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون بيج فاتح بقصة أرجل واسعة وخامة مريحة للصيف.", is_new: false },
        { id: 11, title: "بنطلون Master Quality أصفر خردلي برباط خصر", image: "11.png", price: "12,000", size: "L (كمر 42)", base_size: "L", category: "trousers", availability: "in stock", description: "بنطلون كاجوال مريح بلون أصفر خردلي جذاب وخصر مطاطي مع رباط.", is_new: false },
        { id: 12, title: "بنطلون Master Quality أبيض قصة مرتبة", image: "12.png", price: "14,000", size: "S (كمر 34)", base_size: "S", category: "trousers", availability: "in stock", description: "بنطلون أبيض أساسي بقصة كلاسيكية مرتبة لمختلف المناسبات.", is_new: true }, // Marked as new
        { id: 13, title: "بنطلون Master Quality دانتيل أبيض", image: "13.png", price: "18,000", size: "L (كمر 42)", base_size: "L", category: "trousers", availability: "in stock", description: "بنطلون أنيق من الدانتيل الأبيض الفاخر لإطلالة مميزة وجذابة.", is_new: false },
        { id: 14, title: "بنطلون Master Quality ليجنز زيتي مطبع", image: "14.png", price: "14,000", size: "M (كمر 37)", base_size: "M", category: "trousers", availability: "in stock", description: "ليجنز مريح بلون زيتي عملي ونقشة هادئة.", is_new: false },
        { id: 102, title: "بنطلون كارجو Master Quality بيج برباط كاحل", image: "102.png", price: "8,000", size: "M", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون كارجو عملي ومريح بلون بيج، يتميز برباط قابل للتعديل عند الكاحل.", is_new: true }, // New Product

        // --- Maternity Wear ---
        { id: 2, title: "بنطلون جينز حوامل Master Quality أزرق فاتح", image: "2.png", price: "18,000", size: "XL (كمر 44)", base_size: "XL", category: "maternity", availability: "in stock", description: "جينز حوامل بقصة مريحة ولون فاتح مع حزام بطن قماشي عريض ومرن.", is_new: false },
        { id: 3, title: "بنطلون جينز حوامل Master Quality أزرق فاتح", image: "3.png", price: "18,000", size: "L (كمر 40)", base_size: "L", category: "maternity", availability: "in stock", description: "جينز حوامل بقصة مريحة ولون فاتح مع حزام بطن قماشي عريض ومرن.", is_new: false },
        { id: 54, title: "بلوزة حوامل Master Quality بيج بياقة V", image: "54.png", price: "8,000", size: "XS", base_size: "XS", category: "maternity", availability: "in stock", description: "بلوزة حوامل مريحة بلون بيج، تتميز بتصميم لف وياقة V وأكمام قصيرة.", is_new: true }, // New Product

        // --- Tops ---
        { id: 15, title: "توب تانك Master Quality مضلع رمادي غامق", image: "15.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب أساسي مضلع ومريح بلون رمادي غامق للاستخدام اليومي.", is_new: false },
        { id: 16, title: "توب كروب Master Quality مضلع أخضر ليموني", image: "16.png", price: "4,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "توب كروب عصري مضلع بلون نيون منعش وحافة مكشكشة.", is_new: true }, // Marked as new
        { id: 17, title: "توب تانك Master Quality مخطط فوشي/أبيض", image: "17.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب مخطط كلاسيكي بألوان صيفية زاهية وحواف بيضاء.", is_new: false },
        { id: 18, title: "توب تانك Master Quality مضلع أبيض", image: "18.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب أبيض أساسي مضلع لا غنى عنه في أي خزانة.", is_new: false },
        { id: 19, title: "توب تانك Master Quality أخضر زاهي", image: "19.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب أساسي مريح وعملي بلون أخضر منعش.", is_new: false },
        { id: 20, title: "توب تانك Master Quality تركوازي", image: "20.png", price: "4,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "توب أساسي ناعم بلون تركوازي هادئ ومريح.", is_new: false },
        { id: 21, title: "توب تانك Master Quality أسود", image: "21.png", price: "4,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "توب أسود أساسي عملي لكل الإطلالات برقبة واسعة قليلاً.", is_new: false },
        { id: 22, title: "كاميصول Master Quality تركوازي بحواف دانتيل", image: "22.png", price: "4,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "كاميصول ناعم بلون تركوازي مع لمسة دانتيل أنثوية على الحافة.", is_new: false },
        { id: 23, title: "كاميصول Master Quality تركوازي بحواف دانتيل", image: "23.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول ناعم بلون تركوازي مع لمسة دانتيل أنثوية على الحافة.", is_new: false },
        { id: 24, title: "توب تانك Master Quality رمادي فاتح ميلانج", image: "24.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "توب أساسي مريح وعملي بلون رمادي فاتح ميلانج.", is_new: false },
        { id: 25, title: "كاميصول Master Quality أخضر فاتح بحواف دانتيل", image: "25.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول ناعم بلون أخضر باستيل ولمسة دانتيل رقيقة.", is_new: false },
        { id: 26, title: "توب كروب Master Quality أخضر فاتح بملمس مميز", image: "26.png", price: "4,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "توب كروب عصري بملمس مجعد (سموكيد) ورقبة V.", is_new: true }, // Marked as new
        { id: 27, title: "توب تانك Master Quality مخطط أخضر/أبيض مضلع", image: "27.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "توب مضلع مخطط بقصة مريحة وألوان منعشة.", is_new: false },
        { id: 28, title: "كاميصول Master Quality أوف وايت/كريمي", image: "28.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول أساسي ناعم بلون أوف وايت هادئ ومريح.", is_new: false },
        { id: 29, title: "توب كروب Master Quality خوخي/مرجاني بملمس مميز", image: "29.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "توب كروب عصري بملمس مجعد (سموكيد) ورقبة V بلون خوخي.", is_new: false },
        { id: 30, title: "توب/فيست Master Quality محبوك بنقشة مموجة", image: "30.png", price: "4,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "فيست محبوك بنقشة مموجة جريئة وألوان زاهية (أزرق وأصفر).", is_new: true }, // Marked as new
        { id: 31, title: "توب تانك Master Quality أخضر ليموني نيون", image: "31.png", price: "4,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "توب رياضي أو كاجوال بلون نيون منعش وقصة مريحة.", is_new: false },
        { id: 32, title: "توب كروب Master Quality أخضر بقصة غير متماثلة", image: "32.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب كروب عصري بقصة كتف غير متماثلة وجريئة.", is_new: false },
        { id: 33, title: "توب تانك Master Quality مخطط كحلي/أبيض", image: "33.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب مخطط كلاسيكي بستايل بحري أنيق (كحلي وأبيض).", is_new: false },
        { id: 34, title: "توب كروب Master Quality مضلع بيج", image: "34.png", price: "4,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "توب كروب أساسي مضلع بلون بيج محايد وعصري.", is_new: false },
        { id: 35, title: "كاميصول Master Quality فوشي بحواف دانتيل", image: "35.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول أنثوي بلون فوشي جذاب ولمسة دانتيل رقيقة.", is_new: false },
        { id: 37, title: "توب كروب Master Quality مخطط أخضر فاتح/أبيض مضلع", image: "37.png", price: "4,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "توب كروب مضلع ومخطط بألوان هادئة (أخضر فاتح وأبيض).", is_new: false },
        { id: 38, title: "توب كروب Master Quality أسود بكشكشة", image: "38.png", price: "4,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "توب كروب أسود أنيق بتصميم كشكشة أمامي للمناسبات.", is_new: true }, // Marked as new
        { id: 42, title: "تي شيرت Master Quality أصفر فاتح مطبع", image: "42.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "تي شيرت عصري ومريح بلون أصفر فاتح مع طبعات كتابية، مثالي للإطلالات اليومية.", is_new: true }, // New Product
        { id: 43, title: "بلوزة Master Quality بأكمام طويلة ونقشة بيزلي", image: "43.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة وياقة، تتميز بنقشة بيزلي باللونين الأزرق والأبيض.", is_new: true }, // New Product
        { id: 45, title: "بلوزة Master Quality موردة بأكمام طويلة", image: "45.png", price: "8,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة وياقة V، تتميز بنقشة موردة زاهية وحواف مطاطية.", is_new: true }, // New Product
        { id: 47, title: "بلوزة Master Quality بلون خمري وأكمام طويلة", image: "47.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة ناعمة بلون خمري غني، تتميز بأكمام طويلة مع أساور مطاطية وياقة دائرية.", is_new: true }, // New Product
        { id: 48, title: "تي شيرت Master Quality أبيض بطبعة فلامنجو", image: "48.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "تي شيرت قطني مريح باللون الأبيض مع طبعة فلامنجو وردية مميزة.", is_new: true }, // New Product
    ];

    // --- DOM Elements ---
    const body = document.body;
    const productGrid = document.getElementById('product-grid-main');
    const categoryHeader = document.getElementById('category-header');
    const categoryTitleMain = document.getElementById('category-title-main');
    const categoryDescription = document.getElementById('category-description');
    const noResultsDiv = document.getElementById('no-results');
    const loadMoreButton = document.getElementById('load-more-button');
    const newArrivalsWrapper = document.getElementById('new-arrivals-wrapper');

    // Desktop Controls
    const desktopSearchInput = document.getElementById('search-input');
    const desktopSizeSelect = document.getElementById('size-select');
    const desktopNavLinks = document.querySelectorAll('nav.desktop-nav ul li a.nav-link');
    const themeToggleButton = document.getElementById('theme-toggle-button');
    const wishlistButton = document.getElementById('wishlist-button');
    const wishlistCountSpan = document.getElementById('wishlist-count');

    // Mobile Controls
    const mobileSearchInput = document.getElementById('search-input-mobile');
    const mobileSizeSelect = document.getElementById('size-select-mobile');
    const mobileNavLinks = document.querySelectorAll('.bottom-nav ul li a.nav-link-mobile');
    const mobileSearchOverlay = document.getElementById('mobile-search-overlay');
    const mobileFilterOverlay = document.getElementById('mobile-filter-overlay');
    const mobileSearchBtn = document.getElementById('mobile-search-btn');
    const mobileFilterBtn = document.getElementById('mobile-filter-btn');
    const closeSearchOverlayBtn = document.getElementById('close-search-overlay');
    const closeFilterOverlayBtn = document.getElementById('close-filter-overlay');
    const applyMobileFiltersBtn = document.getElementById('apply-mobile-filters');
    const applyMobileSearchBtn = document.getElementById('apply-mobile-search');
    const mobileThemeToggleButton = document.getElementById('mobile-theme-toggle-button');
    const mobileWishlistButton = document.getElementById('mobile-wishlist-button');
    const mobileWishlistCountSpan = document.getElementById('mobile-wishlist-count');

    // Modals & Content
    const quickViewModalOverlay = document.getElementById('quick-view-modal');
    const quickViewModalCloseButton = document.getElementById('modal-close-button-qv');
    const orderFormModalOverlay = document.getElementById('order-form-modal');
    const orderFormModalCloseButton = document.getElementById('modal-close-button-order');
    const wishlistModalOverlay = document.getElementById('wishlist-modal');
    const wishlistModalCloseButton = document.getElementById('modal-close-button-wishlist');
    const wishlistItemsContainer = document.getElementById('wishlist-items-container');
    const wishlistEmptyMessage = document.getElementById('wishlist-empty-message');
    const wishlistOrderAllBtn = document.getElementById('wishlist-order-all-btn');

    // Quick View Modal Content
    const modalImageElement = document.getElementById('modal-product-image');
    const modalTitle = document.getElementById('modal-product-title');
    const modalSize = document.getElementById('modal-product-size');
    const modalPrice = document.getElementById('modal-product-price');
    const modalDescription = document.getElementById('modal-product-description');
    const modalAvailabilityInfo = document.getElementById('modal-availability-info');
    const modalAvailability = document.getElementById('modal-product-availability');
    const proceedButton = document.getElementById('proceed-button');
    const modalAddToWishlistButton = document.getElementById('modal-add-to-wishlist-button');
    const zoomHint = document.querySelector('.zoom-hint');

    // Order Form Modal Content
    const orderForm = document.getElementById('order-form');
    const formErrorMessage = document.getElementById('form-error-message');
    const orderSummaryMainTitle = document.getElementById('order-summary-main-title');
    const orderSummarySingleItemDetails = document.getElementById('order-summary-single-item-details');
    const orderSummaryItemsList = document.getElementById('order-summary-items-list');
    const orderSummaryTitle = document.getElementById('order-summary-title');
    const orderSummarySize = document.getElementById('order-summary-size');
    const orderSummaryPrice = document.getElementById('order-summary-price');
    const orderFormProductId = document.getElementById('order-form-product-id');
    const orderFormProductTitle = document.getElementById('order-form-product-title');
    const orderFormProductSize = document.getElementById('order-form-product-size');
    const orderFormProductPrice = document.getElementById('order-form-product-price');

    // --- State & Constants ---
    const whatsappNumber = '9647778076465'; // Replace with your actual WhatsApp number (تأكد من أن هذا هو رقم الواتساب الصحيح)
    let currentProductIdForOrder = null; // Legacy, might remove later
    let currentProductIdForQuickView = null;
    let activeCategory = 'all';
    let wishlist = JSON.parse(localStorage.getItem('mqWishlist')) || [];
    let wishlistItemsForOrder = []; // Used for multi-item orders via wishlist modal
    let currentPanzoomInstance = null;
    let displayedProductCount = 0;
    const productsPerLoad = 8; // Number of products to load each time
    let currentFilteredProducts = []; // Holds the currently filtered list of products

    // Category descriptions (for display)
    const categoryDescriptions = {
        all: "تصفحي جميع منتجاتنا المختارة بعناية.",
        trousers: "تشكيلة واسعة من البناطيل المريحة والأنيقة لجميع المناسبات.",
        maternity: "ملابس حوامل مصممة خصيصاً لراحتك وأناقتك خلال هذه الفترة المميزة.",
        tops: "توبات وبلوزات عصرية تناسب جميع الأذواق والإطلالات.",
    };

    // --- Utility Functions ---
    // Debounce function to limit the rate at which a function can fire.
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // --- Wishlist Functions ---
    // Update the visual count on wishlist buttons
    function updateWishlistCount() {
        const count = wishlist.length;
        const hasItems = count > 0;
        wishlistCountSpan.textContent = count;
        mobileWishlistCountSpan.textContent = count;
        wishlistCountSpan.classList.toggle('visually-hidden', !hasItems);
        mobileWishlistCountSpan.classList.toggle('visually-hidden', !hasItems);
        [wishlistButton, mobileWishlistButton].forEach(btn => {
             if (btn) {
                btn.classList.toggle('active', hasItems);
                const icon = btn.querySelector('i');
                if (icon) icon.className = hasItems ? 'fas fa-heart' : 'far fa-heart'; // Solid heart if items exist
             }
        });
        if(wishlistOrderAllBtn) wishlistOrderAllBtn.disabled = !hasItems; // Enable/disable order all button
    }
    // Check if a product is in the wishlist
    function isWished(productId) {
        return wishlist.includes(Number(productId));
    }
    // Add or remove a product from the wishlist
    function toggleWishlist(productId, buttonElement = null) {
        const numProductId = Number(productId);
        const index = wishlist.indexOf(numProductId);
        const wasWished = index > -1;

        if (wasWished) { wishlist.splice(index, 1); } // Remove if exists
        else { wishlist.push(numProductId); } // Add if doesn't exist
        localStorage.setItem('mqWishlist', JSON.stringify(wishlist)); // Save to local storage
        updateWishlistCount(); // Update UI

        // Update all relevant wishlist buttons on the page
        document.querySelectorAll(`.wishlist-btn[data-id="${numProductId}"], #modal-add-to-wishlist-button`).forEach(btn => {
             if (!btn) return;
            const isNowWished = !wasWished;
            const icon = btn.querySelector('i');
             btn.classList.toggle('active', isNowWished);

             if (btn.id === 'modal-add-to-wishlist-button') { // Specific update for modal button text
                 if (icon) icon.className = isNowWished ? 'fas fa-heart-circle-check' : 'far fa-heart';
                 btn.childNodes[2].nodeValue = isNowWished ? ' تمت الإضافة للأمنيات' : ' إضافة إلى قائمة الأمنيات';
             } else if (icon) { // Update icon for card buttons
                 icon.className = isNowWished ? 'fas fa-heart' : 'far fa-heart';
             }
        });

        // If the wishlist modal is open, re-render its content
        if (wishlistModalOverlay.classList.contains('active')) { renderWishlistItems(); }
    }

    // --- Theme Toggle Functions ---
    // Apply the selected theme (light/dark)
    function applyTheme(theme) {
        body.classList.toggle('light-theme', theme === 'light');
        const iconClass = theme === 'light' ? 'fa-moon' : 'fa-sun'; // Moon for light theme, Sun for dark
        const newAriaLabel = theme === 'light' ? 'تفعيل الوضع المظلم' : 'تفعيل الوضع الفاتح';
        [themeToggleButton, mobileThemeToggleButton].forEach(btn => {
            if(btn) {
                const iconElement = btn.querySelector('i');
                if (iconElement) {
                    iconElement.className = `fas ${iconClass}`; // Update existing icon
                } else {
                    btn.innerHTML = `<i class="fas ${iconClass}"></i>`; // Set icon if somehow missing
                }
                btn.setAttribute('aria-label', newAriaLabel);
            }
        });
        localStorage.setItem('mqTheme', theme); // Save preference
    }
    // Toggle between light and dark themes
    function toggleTheme() {
        const currentTheme = body.classList.contains('light-theme') ? 'light' : 'dark';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
    }

    // --- Create Product Card Function ---
    // Generates the HTML for a single product card
    function createProductCard(product, isCarousel = false) {
        const card = document.createElement('div'); // Wrapper div for carousel slide
        const cardContent = document.createElement('div'); // The actual product card content
        cardContent.className = 'product-card';
        cardContent.dataset.title = product.title.toLowerCase(); // For search filtering
        cardContent.dataset.category = product.category;       // For category filtering
        cardContent.dataset.base_size = product.base_size;     // For size filtering
        cardContent.dataset.id = product.id;                   // Store product ID
         if (!isCarousel) {
            // Apply fade-in animation for grid cards
            cardContent.style.animation = 'fadeInUpCard 0.5s ease-out forwards';
         }

        // Image container
        const imageContainer = document.createElement('div');
        imageContainer.className = 'product-image-container';
        // Open quick view when image area (not buttons) is clicked
        imageContainer.onclick = (e) => { if (!e.target.closest('.product-card-actions button')) openQuickView(product.id); };
        const img = document.createElement('img');
        img.src = product.image;
        img.alt = product.title;
        img.loading = 'lazy'; // Use native browser lazy loading
        // Fallback image if the original fails to load
        img.onerror = () => { img.src = 'https://placehold.co/300x350/cccccc/999999?text=Image+Not+Found'; img.onerror = null; };
        imageContainer.appendChild(img);

        // Badges (Availability, New Arrival)
        const badgesContainer = document.createElement('div');
        badgesContainer.className = 'product-badges';
        if (product.availability === 'in stock') {
            badgesContainer.innerHTML += `<span class="badge available"><i class="fas fa-check"></i> متوفر</span>`;
        } else {
            badgesContainer.innerHTML += `<span class="badge out-of-stock" style="background-color: var(--text-secondary);"><i class="fas fa-times"></i> غير متوفر</span>`;
        }
        if (product.is_new) {
            badgesContainer.innerHTML += `<span class="badge new-arrival"><i class="fas fa-star"></i> وصل حديثاً</span>`;
        }
        imageContainer.appendChild(badgesContainer);

        // Product info (title, price, action buttons)
        const infoContainer = document.createElement('div');
        infoContainer.className = 'product-info';
        infoContainer.innerHTML = `
            <h3>${product.title}</h3>
            <p class="price-card">${product.price} <span class="currency">د.ع</span></p>
            <div class="product-card-actions">
                <button class="icon-button wishlist-btn ${isWished(product.id) ? 'active' : ''}" data-id="${product.id}" aria-label="إضافة للمفضلة أو إزالة">
                    <i class="${isWished(product.id) ? 'fas fa-heart' : 'far fa-heart'}"></i>
                </button>
                <button class="icon-button quick-order-btn" data-id="${product.id}" aria-label="طلب سريع للمنتج">
                    <i class="fas fa-cart-plus"></i>
                </button>
            </div>
        `;
        // Add event listeners to action buttons
        infoContainer.querySelector('.wishlist-btn').onclick = (e) => { e.stopPropagation(); toggleWishlist(product.id, e.currentTarget); };
        infoContainer.querySelector('.quick-order-btn').onclick = (e) => { e.stopPropagation(); openOrderModal(product.id); };

        // Assemble the card content
        cardContent.appendChild(imageContainer);
        cardContent.appendChild(infoContainer);

        // Return either the slide wrapper or the card content directly
        if (isCarousel) {
            card.className = 'swiper-slide';
            card.appendChild(cardContent);
            return card; // Return the swiper-slide div
        } else {
            return cardContent; // Return the product-card div directly
        }
    }

    // --- Modal Functions ---
    // Generic function to open any modal/overlay
     function openModal(modalOverlay) {
         if (!modalOverlay) return;
         // Close Panzoom only if opening a DIFFERENT modal than Quick View
         if (currentPanzoomInstance && modalOverlay !== quickViewModalOverlay) {
             safelyDestroyPanzoom();
         }
         modalOverlay.classList.add('active');
         // Prevent body scroll when modal is open (slight delay for transition)
         setTimeout(() => { body.style.overflow = 'hidden'; }, 50);
     }
     // Generic function to close any modal/overlay
     function closeModal(modalOverlay) {
         if (!modalOverlay || !modalOverlay.classList.contains('active')) return;
         modalOverlay.classList.remove('active');
         // Specific cleanup for Quick View modal (destroy Panzoom)
         if (modalOverlay === quickViewModalOverlay) {
            safelyDestroyPanzoom();
            currentProductIdForQuickView = null; // Reset ID when closing Quick View
         }
         // Specific cleanup for mobile filter/search overlays
         if (modalOverlay === mobileFilterOverlay || modalOverlay === mobileSearchOverlay) {
            // No specific cleanup needed currently
         }
         // Restore body scroll only if NO modals or mobile overlays remain active
         const anyModalActive = document.querySelector('.modal-overlay.active, .mobile-overlay.active');
         if (!anyModalActive) {
             body.style.overflow = '';
         }
     }
     // Safely destroy the Panzoom instance if it exists
     function safelyDestroyPanzoom() {
         if (currentPanzoomInstance) {
             try {
                 currentPanzoomInstance.destroy();
             } catch (e) {
                 console.error("Error destroying Panzoom instance:", e);
             } finally {
                 currentPanzoomInstance = null;
                 // Reset image style and cursor
                 if (modalImageElement) {
                     modalImageElement.style.transform = '';
                     modalImageElement.style.cursor = 'grab';
                 }
                 if (zoomHint) zoomHint.style.display = 'none'; // Hide zoom hint
             }
         }
     }

     // --- Panzoom Initialization ---
     // Initialize Panzoom library on the Quick View modal image
     function initPanzoom() {
         safelyDestroyPanzoom(); // Ensure any previous instance is destroyed first
         // Check if Panzoom library is loaded, image element exists, and is visible
         if (modalImageElement && typeof Panzoom === 'function' && modalImageElement.offsetParent !== null) {
             // Check if the image has loaded its dimensions
             if (modalImageElement.naturalWidth === 0) {
                 console.warn("Panzoom target image not fully loaded yet.");
                 // Optionally, retry after a short delay or wait for onload event
                 return;
             }
             try {
                 currentPanzoomInstance = Panzoom(modalImageElement, {
                     maxScale: 3,       // Max zoom level
                     minScale: 1,       // Min zoom level (original size)
                     contain: 'inside', // Keep zoomed image within its container
                     canvas: true,      // Improves rendering performance
                     handleStartEvent: e => { e.preventDefault(); }, // Prevents text selection during pan
                     cursor: 'grab'     // Set initial cursor
                 });

                 // Add event listeners for cursor changes during pan/zoom
                 modalImageElement.addEventListener('panzoomstart', () => {
                     modalImageElement.style.cursor = 'grabbing';
                 });
                 modalImageElement.addEventListener('panzoomend', () => {
                     modalImageElement.style.cursor = 'grab';
                 });

                 // Enable zooming with mouse wheel
                 modalImageElement.addEventListener('wheel', function(event) {
                     if (currentPanzoomInstance) {
                         currentPanzoomInstance.zoomWithWheel(event);
                     }
                 });

                 // Show the zoom hint briefly
                 if (zoomHint) {
                     zoomHint.style.display = 'inline-block';
                     setTimeout(() => { if (zoomHint) zoomHint.style.display = 'none'; }, 2500);
                 }
             } catch (e) {
                 console.error("Error initializing Panzoom:", e);
                 safelyDestroyPanzoom(); // Clean up if initialization failed
             }
         } else {
             // Log errors if Panzoom cannot be initialized
             if (!modalImageElement) console.error("Panzoom target image element not found.");
             if (typeof Panzoom !== 'function') console.error("Panzoom library not loaded.");
             if (modalImageElement && modalImageElement.offsetParent === null) console.warn("Panzoom target not visible.");
         }
     }

     // --- Quick View Modal ---
     // Open the Quick View modal and populate it with product details
     function openQuickView(productId) {
         const product = products.find(p => p.id === Number(productId));
         if (!product) { console.error("Product not found for Quick View:", productId); return; }
         currentProductIdForQuickView = productId; // Store the ID of the product being viewed

         // Reset panzoom state before changing image
         safelyDestroyPanzoom();
         modalImageElement.style.transform = ''; // Reset any previous transform
         modalImageElement.src = ""; // Clear src first to ensure onload triggers reliably

         // Set new image source and handle potential load errors
         modalImageElement.alt = product.title;
         modalImageElement.onerror = () => {
             modalImageElement.src = 'https://placehold.co/400x450/cccccc/999999?text=Image+Not+Found';
             modalImageElement.onerror = null; // Prevent infinite loop if placeholder fails
             // Optionally try to init panzoom on the placeholder, though less useful
             // initPanzoom();
         };

         // Initialize Panzoom *after* the new image has loaded
         modalImageElement.onload = () => {
             // Only initialize if the modal is still open for THIS specific product
             if (quickViewModalOverlay.classList.contains('active') && currentProductIdForQuickView === productId) {
                 initPanzoom();
             }
         };

         // Set the src AFTER defining onload/onerror to trigger loading
         modalImageElement.src = product.image;

         // Populate other modal details
         modalTitle.textContent = product.title;
         modalSize.textContent = product.size;
         modalPrice.textContent = product.price;
         modalDescription.textContent = product.description || "تصميم مميز وعصري من أجود الخامات المتوفرة."; // Fallback description
         // Update availability status and style
         if (product.availability === 'in stock') {
             modalAvailability.textContent = "متوفر حالياً";
             modalAvailabilityInfo.style.color = 'var(--success-color)';
             modalAvailabilityInfo.querySelector('i').className = 'fas fa-check-circle';
         } else {
             modalAvailability.textContent = "غير متوفر حالياً";
             modalAvailabilityInfo.style.color = 'var(--error-color)';
             modalAvailabilityInfo.querySelector('i').className = 'fas fa-times-circle';
         }
         // Update the "Add to Wishlist" button state and text
         const isInWishlist = isWished(productId);
         const modalWishlistIcon = modalAddToWishlistButton.querySelector('i');
         if (modalWishlistIcon) modalWishlistIcon.className = isInWishlist ? 'fas fa-heart-circle-check' : 'far fa-heart';
         modalAddToWishlistButton.childNodes[2].nodeValue = isInWishlist ? ' تمت الإضافة للأمنيات' : ' إضافة إلى قائمة الأمنيات'; // Update text node

         openModal(quickViewModalOverlay); // Open the modal
     }
     // Close the Quick View modal
     function closeQuickView() { closeModal(quickViewModalOverlay); }

     // --- Order Modal Functions ---
     // Open the order form modal for a single product
     function openOrderModal(productId = null) {
         wishlistItemsForOrder = []; // Ensure multi-item list is clear for single orders
         const targetProductId = productId || currentProductIdForQuickView; // Use passed ID or fallback to the one in Quick View
         const isSingleItemOrder = !!targetProductId && !Array.isArray(targetProductId);

         if (isSingleItemOrder) {
             const product = products.find(p => p.id === Number(targetProductId));
             if (!product) { console.error("Product not found for Order:", targetProductId); return; }
             // Populate summary for single item
             orderSummaryMainTitle.innerHTML = '<i class="fas fa-box-open"></i> المنتج المطلوب';
             orderSummaryTitle.textContent = product.title;
             orderSummarySize.textContent = product.size;
             orderSummaryPrice.textContent = product.price;
             // Store details in hidden fields for form submission
             orderFormProductId.value = product.id;
             orderFormProductTitle.value = product.title;
             orderFormProductSize.value = product.size;
             orderFormProductPrice.value = product.price;
             // Show single item details, hide multi-item list
             orderSummarySingleItemDetails.classList.remove('display-none');
             orderSummaryItemsList.classList.add('display-none');
             orderSummaryItemsList.innerHTML = ''; // Clear list just in case
         } else {
             // This case should not happen via this function anymore
             console.error("Cannot open single order modal without a valid product ID.");
             return;
         }

         // Close other modals if they are open
         if (quickViewModalOverlay.classList.contains('active')) closeQuickView();
         if (wishlistModalOverlay.classList.contains('active')) closeWishlistModal();

         orderForm.reset(); // Clear any previous form input
         formErrorMessage.textContent = ''; // Clear any previous error message
         formErrorMessage.style.display = 'none';
         openModal(orderFormModalOverlay); // Open the order form modal
     }
     // Prepare the order form modal for ordering all items from the wishlist
     function prepareOrderForAllWishlistItems() {
         if (wishlist.length === 0) return; // Do nothing if wishlist is empty
         wishlistItemsForOrder = [...wishlist]; // Copy wishlist IDs to the list used for submission

         // Populate summary for multiple items
         orderSummaryMainTitle.innerHTML = `<i class="fas fa-boxes-stacked"></i> المنتجات المطلوبة (${wishlistItemsForOrder.length})</span>`;
         let itemsHtml = '';
         let totalPrice = 0;
         wishlistItemsForOrder.forEach(id => {
             const product = products.find(p => p.id === id);
             if (product) {
                 // Add list item for each product
                 itemsHtml += `<li>${product.title} (مقاس: ${product.size}) - <span>${product.price} د.ع</span></li>`;
                 // Calculate total price (handle potential parsing errors)
                 try { totalPrice += parseInt(product.price.replace(/,/g, ''), 10) || 0; } catch(e) { console.warn("Error parsing price:", product.price); }
             }
         });
         orderSummaryItemsList.innerHTML = itemsHtml; // Add items to the list element
         // Hide single item details, show multi-item list
         orderSummarySingleItemDetails.classList.add('display-none');
         orderSummaryItemsList.classList.remove('display-none');

         // Clear single product hidden fields as this is a multi-item order
         orderFormProductId.value = '';
         orderFormProductTitle.value = '';
         orderFormProductSize.value = '';
         orderFormProductPrice.value = '';

         closeWishlistModal(); // Close wishlist modal first
         orderForm.reset(); // Clear form fields
         formErrorMessage.textContent = ''; // Clear errors
         formErrorMessage.style.display = 'none';
         openModal(orderFormModalOverlay); // Open the order modal
     }
     // Close the order form modal
     function closeOrderModal() {
         closeModal(orderFormModalOverlay);
         wishlistItemsForOrder = []; // Clear the multi-item list when closing
     }


    // --- Wishlist Modal Functions ---
    // Render the items currently in the wishlist inside the wishlist modal
     function renderWishlistItems() {
         wishlistItemsContainer.innerHTML = ''; // Clear previous items
         const hasItems = wishlist.length > 0;
         wishlistEmptyMessage.style.display = hasItems ? 'none' : 'block'; // Show/hide empty message
         if (wishlistOrderAllBtn) wishlistOrderAllBtn.disabled = !hasItems; // Enable/disable order all button

         if(hasItems) {
             wishlist.forEach(productId => {
                 const product = products.find(p => p.id === productId);
                 if (product) {
                     // Create HTML for each wishlist item
                     const itemDiv = document.createElement('div');
                     itemDiv.className = 'wishlist-item';
                     itemDiv.innerHTML = `
                         <div class="wishlist-item-image">
                              <img src="${product.image}" alt="${product.title}" loading="lazy" onerror="this.src='https://placehold.co/80x80/cccccc/999999?text=N/A'; this.onerror=null;">
                         </div>
                         <div class="wishlist-item-details">
                             <h4>${product.title}</h4>
                             <p>${product.price} <span class="currency" style="color:var(--text-secondary); font-size: 0.9em;">د.ع</span></p>
                         </div>
                         <div class="wishlist-item-actions">
                             <button class="icon-button quick-order-btn" data-id="${product.id}" title="طلب هذا المنتج" aria-label="طلب ${product.title}">
                                 <i class="fas fa-cart-plus"></i>
                             </button>
                             <button class="icon-button wishlist-remove-item-btn" data-id="${product.id}" title="إزالة من الأمنيات" aria-label="إزالة ${product.title} من الأمنيات">
                                 <i class="fas fa-trash-alt"></i>
                             </button>
                         </div>`;
                     // Add event listeners for remove and quick order buttons within the wishlist item
                     itemDiv.querySelector('.wishlist-remove-item-btn').addEventListener('click', (e) => { e.stopPropagation(); toggleWishlist(product.id); });
                     itemDiv.querySelector('.quick-order-btn').addEventListener('click', (e) => { e.stopPropagation(); openOrderModal(product.id); });
                     wishlistItemsContainer.appendChild(itemDiv);
                 } else {
                     // Handle case where a wishlist item ID doesn't match any product (data inconsistency)
                     console.warn("Wishlist item not found in products data:", productId);
                     // Remove the invalid ID from wishlist and update storage/UI
                     const index = wishlist.indexOf(productId);
                     if (index > -1) { wishlist.splice(index, 1); localStorage.setItem('mqWishlist', JSON.stringify(wishlist)); updateWishlistCount(); }
                 }
             });
         }
     }
     // Open the wishlist modal
     function openWishlistModal() { renderWishlistItems(); openModal(wishlistModalOverlay); }
     // Close the wishlist modal
     function closeWishlistModal() { closeModal(wishlistModalOverlay); }


    // --- Filter and Display Products ---
    // Apply current filters (category, size, search) and update the product grid
    function applyFilters() {
        // Get filter values from appropriate controls based on screen size
        const searchTerm = (window.innerWidth <= 992 ? mobileSearchInput.value : desktopSearchInput.value).toLowerCase().trim();
        const selectedSize = (window.innerWidth <= 992 ? mobileSizeSelect.value : desktopSizeSelect.value);

        // Filter the main products array
        currentFilteredProducts = products.filter(product => {
            const categoryMatch = activeCategory === 'all' || product.category === activeCategory;
            const searchMatch = !searchTerm || product.title.toLowerCase().includes(searchTerm);
            const sizeMatch = selectedSize === 'all' || product.base_size === selectedSize;
            return categoryMatch && searchMatch && sizeMatch;
        });

        // Prepare grid for new content
        productGrid.innerHTML = ''; // Clear the grid
        displayedProductCount = 0; // Reset the count of displayed products
        noResultsDiv.style.display = currentFilteredProducts.length === 0 ? 'block' : 'none'; // Show/hide 'no results' message
        loadMoreProducts(); // Load the first batch of filtered products

        // Update category title and description display
        const categoryData = categoryDescriptions[activeCategory];
        // Get category name from the active navigation link text
        const activeLinkText = document.querySelector(`.nav-link[data-category="${activeCategory}"], .nav-link-mobile[data-category="${activeCategory}"]`)?.textContent;
        categoryTitleMain.textContent = activeLinkText ? activeLinkText.replace(/<[^>]*>/g, '').trim() : "المنتجات"; // Use link text or default
        if(categoryDescription) categoryDescription.textContent = categoryData || ""; // Set description or clear it
    }

    // Load the next batch of products into the grid
    function loadMoreProducts() {
        if (!productGrid || !loadMoreButton) return; // Safety check

        const nextBatch = currentFilteredProducts.slice(displayedProductCount, displayedProductCount + productsPerLoad);
        let animationDelayCounter = 0; // For staggered animation effect

        nextBatch.forEach(product => {
            const card = createProductCard(product, false); // Create card HTML
             card.style.animationDelay = `${animationDelayCounter * 0.06}s`; // Apply animation delay
             productGrid.appendChild(card); // Add card to the grid
             animationDelayCounter++;
        });

        displayedProductCount += nextBatch.length; // Update displayed count

        // Show/hide the "Load More" button based on whether all products are displayed
        if (displayedProductCount >= currentFilteredProducts.length) {
            loadMoreButton.classList.add('hidden');
        } else {
            loadMoreButton.classList.remove('hidden');
        }
         loadMoreButton.disabled = false; // Re-enable button after loading
    }

    // Create a debounced version of applyFilters for search input to avoid excessive calls
    const debouncedApplyFilters = debounce(applyFilters, 300);

    // --- WhatsApp Order Submission ---
    // Handle the order form submission
    orderForm.addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        // Get form elements and values
        const customerNameInput = document.getElementById('customer-name');
        const customerPhoneInput = document.getElementById('customer-phone');
        const customerAddressInput = document.getElementById('customer-address');
        const customerName = customerNameInput.value.trim();
        const customerPhone = customerPhoneInput.value.trim();
        const customerAddress = customerAddressInput.value.trim();
        let isValid = true;
        formErrorMessage.textContent = ''; // Clear previous errors
        formErrorMessage.style.display = 'none';
        // Reset input border colors
        [customerNameInput, customerPhoneInput, customerAddressInput].forEach(input => input.style.borderColor = '');

        // --- Simple Validation ---
        if (!customerName) {
            formErrorMessage.textContent += 'يرجى إدخال الاسم الكامل. ';
            customerNameInput.style.borderColor = 'var(--error-color)'; // Highlight error
            isValid = false;
        }
        // Validate Iraqi phone number format (07 followed by 9 digits)
        if (!customerPhone || !/^(07[5789][0-9]{8})$/.test(customerPhone)) {
            formErrorMessage.textContent += 'يرجى إدخال رقم هاتف عراقي صحيح (11 رقم يبدأ بـ 07). ';
            customerPhoneInput.style.borderColor = 'var(--error-color)'; // Highlight error
            isValid = false;
        }
        if (!customerAddress) {
            formErrorMessage.textContent += 'يرجى إدخال العنوان الكامل. ';
            customerAddressInput.style.borderColor = 'var(--error-color)'; // Highlight error
            isValid = false;
        }

        // If validation fails, show error message and stop
        if (!isValid) {
            formErrorMessage.style.display = 'block';
            return;
        }

        // --- Construct WhatsApp Message ---
        let message = '';
        const intro = `👋 *طلب جديد من موقع Master Quality* 👋\n------------------------------------\n\n`;
        const outro = `\n------------------------------------\n*بيانات الزبون:*\n👤 *الاسم:* ${customerName}\n📱 *الهاتف:* ${customerPhone}\n📍 *العنوان:* ${customerAddress}\n\n💰 *(الدفع عند الاستلام)*\n\n✨ شكراً لاختياركم Master Quality! ✨`;

        if (wishlistItemsForOrder && wishlistItemsForOrder.length > 0) {
            // --- Message for Multiple Items (from Wishlist) ---
            message += intro + "*المنتجات المطلوبة:*\n";
            let itemNumber = 1;
            let totalPrice = 0;
            wishlistItemsForOrder.forEach(id => {
                 const product = products.find(p => p.id === id);
                 if (product) {
                     message += `${itemNumber++}. ${product.title} (مقاس: ${product.size}) - ${product.price} د.ع\n`;
                     try { totalPrice += parseInt(product.price.replace(/,/g, ''), 10) || 0; } catch(e){}
                 }
            });
             message += `\n*إجمالي السعر التقريبي:* ${totalPrice.toLocaleString('ar-IQ')} د.ع`; // Format total price
             message += outro;
             // Clear the temporary list after preparing the message
             wishlistItemsForOrder = [];
        } else {
            // --- Message for Single Item ---
            // Get details from hidden fields populated when the modal was opened
            const productId = orderFormProductId.value;
            const productTitle = orderFormProductTitle.value;
            const productSize = orderFormProductSize.value;
            const productPrice = orderFormProductPrice.value;

             // Basic check if single product details are present
             if (!productId || !productTitle) {
                 console.error("Single order details missing from hidden fields.");
                 formErrorMessage.textContent = 'حدث خطأ في تفاصيل المنتج المطلوب. يرجى المحاولة مرة أخرى.';
                 formErrorMessage.style.display = 'block';
                 return; // Stop submission
             }
             message += intro + `*المنتج:* ${productTitle}\n*المقاس:* ${productSize}\n*السعر:* ${productPrice} د.ع` + outro;
        }

        // --- Send to WhatsApp ---
        // *** MODIFICATION: Using api.whatsapp.com instead of wa.me as a potential fix for mobile issues ***
        const encodedMessage = encodeURIComponent(message.trim());
        const whatsappUrl = `https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${encodedMessage}`;
        // Log the generated URL for debugging (optional)
        // console.log("WhatsApp URL:", whatsappUrl);

        // Attempt to open the WhatsApp link
        try {
             window.open(whatsappUrl, '_blank');
        } catch (error) {
            console.error("Error opening WhatsApp link:", error);
            // Display a user-friendly message if window.open fails immediately (e.g., popup blocker)
            formErrorMessage.textContent = 'لم نتمكن من فتح واتساب تلقائياً. قد يكون بسبب مانع النوافذ المنبثقة. يرجى المحاولة مرة أخرى أو نسخ تفاصيل الطلب يدوياً.';
            formErrorMessage.style.display = 'block';
            return; // Stop further execution
        }

        // Close the order modal after attempting to send
        // Note: This doesn't guarantee the message was sent, only that the link was opened.
        closeOrderModal();
    });

    // --- Navigation & Filter Logic ---
    // Set the active category and update filters/UI
    function setActiveCategory(category, clickedLinkElement = null) {
        activeCategory = category; // Update global state
        // Update active class on all navigation links (desktop and mobile)
        document.querySelectorAll('[data-category]').forEach(link => {
            link.classList.toggle('active', link.dataset.category === category);
        });

        // If a category link/card was clicked, reset other filters (size, search)
        if (clickedLinkElement) {
            if(desktopSizeSelect) desktopSizeSelect.value = 'all';
            if(desktopSearchInput) desktopSearchInput.value = '';
            if(mobileSizeSelect) mobileSizeSelect.value = 'all';
            if(mobileSearchInput) mobileSearchInput.value = '';
            // Close mobile filter/search overlays if open
            closeModal(mobileFilterOverlay);
            closeModal(mobileSearchOverlay);
        }
        applyFilters(); // Re-apply filters for the newly selected category
    }

    // Scroll smoothly to the product section
    function scrollToProducts() {
        const targetElement = document.getElementById('product-section');
        if (targetElement) {
            // Calculate offset considering the sticky header height for accurate positioning
            const headerOffset = document.querySelector('header')?.offsetHeight || 70; // Use actual height or fallback
            const elementPosition = targetElement.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset - 20; // Add a small buffer

            window.scrollTo({
                 top: offsetPosition,
                 behavior: "smooth" // Use smooth scrolling
            });
        }
    }

    // --- Swiper Initialization (for New Arrivals Carousel) ---
    function initSwiper() {
        // Check if Swiper library is loaded
        if (typeof Swiper === 'undefined') {
            console.error("Swiper library not loaded.");
            return;
        }
        // Filter products marked as new
        const newArrivals = products.filter(p => p.is_new);
        if (newArrivalsWrapper && newArrivals.length > 0) {
             newArrivalsWrapper.innerHTML = ''; // Clear existing slides
             // Create and append a card for each new arrival product
             newArrivals.forEach(product => {
                 newArrivalsWrapper.appendChild(createProductCard(product, true)); // true indicates it's for a carousel
             });

            // Initialize Swiper instance
            new Swiper('.new-arrivals-swiper', {
                loop: newArrivals.length > 4, // Enable loop only if enough slides for it to make sense
                slidesPerView: 'auto', // Let Swiper determine slides based on width/breakpoints
                spaceBetween: 15,      // Space between slides
                centeredSlides: false, // Don't center slides
                grabCursor: true,      // Show grab cursor on hover
                preloadImages: false,  // Don't preload all images at once (improves performance)
                // Responsive breakpoints
                breakpoints: {
                    320: { slidesPerView: 1.5, spaceBetween: 10 },
                    480: { slidesPerView: 2.2, spaceBetween: 15 },
                    768: { slidesPerView: 3.5, spaceBetween: 20 },
                    1024: { slidesPerView: 4.5, spaceBetween: 25 }
                },
                // Pagination dots
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                // Navigation arrows
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
            });
        } else if(newArrivalsWrapper) {
            // Hide the entire section if there are no new arrivals
            const arrivalsSection = newArrivalsWrapper.closest('.new-arrivals-section');
             if(arrivalsSection) arrivalsSection.style.display = 'none';
        }
    }

    // --- Event Listeners Setup ---
    // Central function to attach all necessary event listeners
    function setupEventListeners() {
        // --- Desktop Filters ---
        desktopSearchInput?.addEventListener('input', debouncedApplyFilters); // Debounced search
        desktopSizeSelect?.addEventListener('change', applyFilters); // Size filter change
        // Desktop navigation link clicks handled by inline onclick + setActiveCategory

        // --- Mobile Filters/Search Overlays ---
        mobileSearchBtn?.addEventListener('click', () => openModal(mobileSearchOverlay));
        closeSearchOverlayBtn?.addEventListener('click', () => closeModal(mobileSearchOverlay));
        applyMobileSearchBtn?.addEventListener('click', () => { applyFilters(); closeModal(mobileSearchOverlay); scrollToProducts(); }); // Apply and close
        mobileFilterBtn?.addEventListener('click', () => openModal(mobileFilterOverlay));
        closeFilterOverlayBtn?.addEventListener('click', () => closeModal(mobileFilterOverlay));
        applyMobileFiltersBtn?.addEventListener('click', () => { applyFilters(); closeModal(mobileFilterOverlay); scrollToProducts(); }); // Apply and close
        // Close overlays on backdrop click
        mobileSearchOverlay?.addEventListener('click', (e) => { if (e.target === mobileSearchOverlay) closeModal(mobileSearchOverlay); });
        mobileFilterOverlay?.addEventListener('click', (e) => { if (e.target === mobileFilterOverlay) closeModal(mobileFilterOverlay); });
        // Mobile navigation link clicks handled by inline onclick + setActiveCategory

        // --- Load More Button ---
        loadMoreButton?.addEventListener('click', () => {
             loadMoreButton.disabled = true; // Prevent multiple clicks while loading
             setTimeout(loadMoreProducts, 100); // Slight delay for visual feedback before loading
        });

        // --- Modals - General Close Actions ---
        quickViewModalCloseButton?.addEventListener('click', closeQuickView);
        quickViewModalOverlay?.addEventListener('click', (e) => { if (e.target === quickViewModalOverlay) closeQuickView(); }); // Close on backdrop click
        orderFormModalCloseButton?.addEventListener('click', closeOrderModal);
        orderFormModalOverlay?.addEventListener('click', (e) => { if (e.target === orderFormModalOverlay) closeOrderModal(); }); // Close on backdrop click
        wishlistModalCloseButton?.addEventListener('click', closeWishlistModal);
        wishlistModalOverlay?.addEventListener('click', (e) => { if (e.target === wishlistModalOverlay) closeWishlistModal(); }); // Close on backdrop click

        // --- Modals - Specific Action Buttons ---
        // "Proceed to Order" button in Quick View modal
        proceedButton?.addEventListener('click', () => openOrderModal()); // Uses currentProductIdForQuickView implicitly
        // "Add to Wishlist" button in Quick View modal
        modalAddToWishlistButton?.addEventListener('click', (e) => { if(currentProductIdForQuickView) { toggleWishlist(currentProductIdForQuickView, e.currentTarget); } });
        // Wishlist buttons in header/mobile controls
        wishlistButton?.addEventListener('click', openWishlistModal);
        mobileWishlistButton?.addEventListener('click', openWishlistModal);
        // "Order All" button in Wishlist modal
        wishlistOrderAllBtn?.addEventListener('click', prepareOrderForAllWishlistItems);

        // --- Theme Toggle ---
        themeToggleButton?.addEventListener('click', toggleTheme);
        mobileThemeToggleButton?.addEventListener('click', toggleTheme);

        // --- Footer Year ---
        const yearSpan = document.getElementById('year');
        if (yearSpan) yearSpan.textContent = new Date().getFullYear(); // Set current year

        // --- Global Keydown Listener (for Escape key) ---
         document.addEventListener('keydown', (event) => {
             if (event.key === 'Escape') {
                 // Close any active modal or mobile overlay
                 const activeModal = document.querySelector('.modal-overlay.active');
                 if (activeModal) {
                     closeModal(activeModal);
                 }
                 const activeMobileOverlay = document.querySelector('.mobile-overlay.active');
                  if (activeMobileOverlay) {
                     closeModal(activeMobileOverlay);
                 }
             }
         });
    }

    // --- Initialization ---
    // Runs when the DOM is fully loaded and parsed
    document.addEventListener('DOMContentLoaded', () => {
        // Apply stored theme or default to dark
        const storedTheme = localStorage.getItem('mqTheme') || 'dark';
        applyTheme(storedTheme);

        // Initialize the new arrivals carousel
        initSwiper();

        // Load initial products into the grid
        if(productGrid && loadMoreButton) {
            applyFilters(); // Apply default filters ('all' category)
        } else {
            console.error("Product grid or load more button not found!");
        }

        // Update wishlist count based on local storage
        updateWishlistCount();
        // Setup all event listeners for interactivity
        setupEventListeners();
    });

    </script>

</body>
</html>
