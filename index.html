<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Quality - واجهة محسنة ودقيقة</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Readex+Pro:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

    <script src="https://cdn.tailwindcss.com"></script>

    <script>
    // --- Tailwind Config (Refined for 3D Buttons, Shadows, Animations) ---
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    'primary': { DEFAULT: '#0891B2', light: '#67E8F9', dark: '#155E75', text: '#ffffff' },
                    'secondary': { DEFAULT: '#F59E0B', light: '#FCD34D', dark: '#B45309', text: '#111827' },
                    'accent': { DEFAULT: '#EC4899', light: '#F9A8D4', dark: '#BE185D', text: '#ffffff' },
                    'light': {
                        'background': '#F8FAFC', 'surface': '#FFFFFF', 'border': '#E5E7EB', 'input-border': '#D1D5DB',
                        'text-primary': '#111827', 'text-secondary': '#4B5563', 'text-muted': '#6B7280',
                    },
                    'dark': {
                        'background': '#0F172A', 'surface': '#1E293B', 'border': '#374151', 'input-border': '#4B5563',
                        'text-primary': '#F3F4F6', 'text-secondary': '#9CA3AF', 'text-muted': '#6B7280',
                    },
                    'success': { DEFAULT: '#10B981', light: '#34D399', dark: '#047857', text: '#ffffff'},
                    'error': { DEFAULT: '#EF4444', light: '#F87171', dark: '#B91C1C', text: '#ffffff'},
                    'warning': { DEFAULT: '#F59E0B', light: '#FCD34D', dark: '#B45309', text: '#111827'},
                    'info': { DEFAULT: '#3B82F6', light: '#60A5FA', dark: '#1D4ED8', text: '#ffffff'},
                    'cart-icon-color': 'light.text-secondary', 'cart-icon-color-dark': 'dark.text-secondary',
                    'cart-badge-bg': 'error.DEFAULT', 'new-badge-bg': 'info.DEFAULT', 'new-badge-text': 'info.text',
                    // Refined Shadow Colors for Buttons
                    'primary-shadow': '#065f77', 'primary-shadow-dark': '#164e63', // Slightly darker base shadow
                    'secondary-shadow': '#92400e', 'secondary-shadow-dark': '#78350F',
                    'success-shadow': '#057a55', 'danger-shadow': '#b91c1c',
                    'accent-shadow': '#9d174d', 'neutral-shadow': '#a0aec0', 'neutral-shadow-dark': '#4a5568', // Adjusted neutral shadows
                },
                fontFamily: {
                    sans: ['Cairo', 'sans-serif'], heading: ['Readex Pro', 'sans-serif'],
                },
                boxShadow: {
                    'xs': '0 1px 2px 0 rgba(0, 0, 0, 0.04)', 'xs-dark': '0 1px 2px 0 rgba(0, 0, 0, 0.2)',
                    'sm': '0 1px 3px 0 rgba(0, 0, 0, 0.06), 0 1px 2px -1px rgba(0, 0, 0, 0.06)', 'sm-dark': '0 1px 3px 0 rgba(0, 0, 0, 0.25), 0 1px 2px -1px rgba(0, 0, 0, 0.2)',
                    'card': '0 4px 8px -2px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.05)', 'card-hover': '0 12px 20px -4px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.07)', // Enhanced hover
                    'card-dark': '0 4px 8px -2px rgba(0, 0, 0, 0.35), 0 2px 4px -2px rgba(0, 0, 0, 0.3)', 'card-hover-dark': '0 12px 20px -4px rgba(0, 0, 0, 0.45), 0 4px 6px -4px rgba(0, 0, 0, 0.4)', // Enhanced dark hover
                    'lg': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.08)', 'lg-dark': '0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -4px rgba(0, 0, 0, 0.35)',
                    'xl': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)', 'xl-dark': '0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 8px 10px -6px rgba(0, 0, 0, 0.45)',
                    '2xl': '0 25px 50px -12px rgba(0, 0, 0, 0.2)', '2xl-dark': '0 25px 50px -12px rgba(0, 0, 0, 0.6)',
                    'inner-input': 'inset 0 1px 3px 0 rgba(0, 0, 0, 0.05)', 'inner-input-dark': 'inset 0 1px 3px 0 rgba(0, 0, 0, 0.3)', 'inner-input-focus': 'inset 0 1px 3px 0 rgba(0, 0, 0, 0.07)', 'inner-input-focus-dark': 'inset 0 1px 3px 0 rgba(0, 0, 0, 0.4)',
                    'header': '0 2px 6px rgba(0, 0, 0, 0.06)', 'header-dark': '0 2px 6px rgba(0, 0, 0, 0.3)',
                    // --- Refined 3D Button Shadows for better depth ---
                    'btn-3d': '0 4px 0 theme("colors.neutral-shadow / 70%"), 0 3px 6px rgba(0,0,0,0.08)', // Increased depth/blur
                    'btn-3d-dark': '0 4px 0 theme("colors.neutral-shadow-dark / 70%"), 0 3px 6px rgba(0,0,0,0.25)',
                    'btn-primary-3d': '0 4px 0 theme("colors.primary-shadow"), 0 3px 6px rgba(8,145,178,0.25)',
                    'btn-primary-3d-dark': '0 4px 0 theme("colors.primary-shadow-dark"), 0 3px 6px rgba(21,94,117,0.35)',
                    'btn-secondary-3d': '0 4px 0 theme("colors.secondary-shadow"), 0 3px 6px rgba(245,158,11,0.2)',
                    'btn-secondary-3d-dark': '0 4px 0 theme("colors.secondary-shadow-dark"), 0 3px 6px rgba(180,83,9,0.3)',
                    'btn-success-3d': '0 4px 0 theme("colors.success-shadow"), 0 3px 6px rgba(16,185,129,0.25)', // Added success shadow config reference
                    'btn-success-3d-dark': '0 4px 0 theme("colors.success-dark"), 0 3px 6px rgba(4,120,87,0.35)', // Added dark success shadow reference
                    'btn-danger-3d': '0 4px 0 theme("colors.danger-shadow"), 0 3px 6px rgba(239,68,68,0.25)',
                    'btn-accent-3d': '0 4px 0 theme("colors.accent-shadow"), 0 3px 6px rgba(236,72,153,0.25)',
                    'btn-active-shadow': 'inset 0 3px 5px rgba(0,0,0,0.2)', // Deeper inset for active state
                },
                borderRadius: { 'DEFAULT': '0.625rem', 'lg': '0.75rem', 'xl': '1rem', '2xl': '1.5rem', '3xl': '2rem', 'full': '9999px', },
                transitionTimingFunction: { 'smooth': 'cubic-bezier(0.4, 0, 0.2, 1)', 'gentle': 'cubic-bezier(0.33, 1, 0.68, 1)', 'bouncy': 'cubic-bezier(0.68, -0.55, 0.27, 1.55)', 'accelerate': 'cubic-bezier(0.4, 0, 1, 1)', 'decelerate': 'cubic-bezier(0, 0, 0.2, 1)', },
                transitionDuration: { 'fast': '150ms', 'DEFAULT': '250ms', 'medium': '350ms', 'slow': '500ms', 'xslow': '700ms' },
                fontSize: { 'xs': '0.75rem', 'sm': '0.875rem', 'base': '1rem', 'lg': '1.125rem', 'xl': '1.25rem', '2xl': '1.5rem', '3xl': '1.875rem', '4xl': '2.25rem', '5xl': '3rem', '6xl': '3.75rem', '7xl':'4.5rem' },
                keyframes: {
                    fadeInUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }, fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, fadeOut: { '0%': { opacity: '1' }, '100%': { opacity: '0' } }, pulseGlow: { '0%, 100%': { opacity: '0.6', transform: 'scale(1)' }, '50%': { opacity: '0.9', transform: 'scale(1.03)' } }, slideInRight: { '0%': { transform: 'translateX(100%)', opacity: '0' }, '100%': { transform: 'translateX(0)', opacity: '1'} }, slideOutRight: { '0%': { transform: 'translateX(0)', opacity: '1' }, '100%': { transform: 'translateX(100%)', opacity: '0'} }, scaleUp: { '0%': { transform: 'scale(0.95)', opacity: '0'}, '100%': { transform: 'scale(1)', opacity: '1'} }, scaleDown: { '0%': { transform: 'scale(1)', opacity: '1'}, '100%': { transform: 'scale(0.95)', opacity: '0'} }, bounceSmall: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-6px)' } },
                    shimmer: { '0%': { backgroundPosition: '-1000px 0' }, '100%': { backgroundPosition: '1000px 0' } }
                },
                animation: {
                    'fade-in-up': 'fadeInUp 0.6s ease-out forwards', 'fade-in': 'fadeIn 0.4s ease-out forwards', 'fade-out': 'fadeOut 0.3s ease-in forwards', 'pulse-glow': 'pulseGlow 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'slide-in-right': 'slideInRight 0.4s ease-gentle forwards', 'slide-out-right': 'slideOutRight 0.3s ease-gentle forwards', 'scale-up': 'scaleUp 0.3s ease-gentle forwards', 'scale-down': 'scaleDown 0.25s ease-gentle forwards', 'bounce-small': 'bounceSmall 1s ease-in-out infinite',
                    'shimmer': 'shimmer 2s infinite linear',
                },
                ringWidth: { 'DEFAULT': '2px', '3': '3px', '4': '4px' },
                ringOffsetWidth: { 'DEFAULT': '2px', '3': '3px', '4': '4px' }
            },
        },
        plugins: [],
    }
    </script>

    <style>
        /* --- Global Styles & Scrollbar --- */
        body { font-family: theme('fontFamily.sans'); font-size: theme('fontSize.base'); line-height: 1.7; @apply bg-light-background dark:bg-dark-background text-light-text-primary dark:text-dark-text-primary transition-colors duration-medium; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; overflow-x: hidden; /* Prevent horizontal scroll */ }
        h1, h2, h3, h4, h5, h6 { font-family: theme('fontFamily.heading'); @apply font-semibold; }
        ::-webkit-scrollbar { width: 8px; height: 8px; } ::-webkit-scrollbar-track { @apply bg-light-border/20 dark:bg-dark-border/20; } ::-webkit-scrollbar-thumb { @apply bg-primary/60 dark:bg-primary-light/60 border-2 border-transparent rounded-full; background-clip: content-box; transition: background-color 0.2s ease; } ::-webkit-scrollbar-thumb:hover { @apply bg-primary dark:bg-primary-light; }

        /* --- Header & Navigation --- */
        #main-header { transition: box-shadow 0.3s ease-out, background-color 0.3s ease-out; } #main-header.scrolled { @apply shadow-header dark:shadow-header-dark bg-light-background/95 dark:bg-dark-background/95 backdrop-blur-md; } #main-nav a { @apply transition-colors duration-200 ease-in-out relative; } #main-nav a.active { @apply text-primary dark:text-primary-light font-bold; }
        #main-nav a::before { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; @apply bg-accent transition-all duration-300 ease-out; } /* Underline hover effect */
        #main-nav a:hover::before, #main-nav a.active::before { width: 100%; } /* Expand underline on hover/active */
        #main-nav a.active::after, #mobile-nav-menu a.active::after { content: ''; position: absolute; left: 50%; transform: translateX(-50%); bottom: -8px; width: 6px; height: 6px; @apply bg-accent rounded-full opacity-100 transition-all duration-300 ease-out scale-0; } /* Dot indicator */
        #main-nav a.active::after, #mobile-nav-menu a.active::after { @apply scale-100; } /* Show dot only on active */
        #mobile-nav-menu { transition: transform 0.35s theme('transitionTimingFunction.smooth'), opacity 0.35s ease-in-out, visibility 0.35s ease-in-out; will-change: transform, opacity; } #mobile-nav-menu a { @apply transition-colors duration-200 ease-in-out relative; } #mobile-nav-menu a.active { @apply bg-primary/10 dark:bg-primary-light/15 text-primary dark:text-primary-light; } #mobile-nav-menu a.active::after { bottom: 6px; }

        /* --- Section Animation --- */
        .section-animate { opacity: 0; transform: translateY(30px); /* Slightly more noticeable entry */ transition: opacity 0.8s theme('transitionTimingFunction.gentle'), transform 0.8s theme('transitionTimingFunction.gentle'); will-change: opacity, transform; } .section-animate.visible { opacity: 1; transform: translateY(0); }

        /* --- Panel/Modal Animations --- */
        .animate-in { animation: fadeIn 0.3s ease-out forwards; } .animate-out { animation: fadeOut 0.25s ease-in forwards; } .modal-content.animate-in { animation: scaleUp 0.35s theme('transitionTimingFunction.gentle') forwards; } .modal-content.animate-out { animation: scaleDown 0.3s theme('transitionTimingFunction.gentle') forwards; } #product-detail-panel.animate-in { animation: slideInRight 0.4s theme('transitionTimingFunction.gentle') forwards; } #product-detail-panel.animate-out { animation: slideOutRight 0.3s theme('transitionTimingFunction.gentle') forwards; } #product-detail-backdrop.animate-in { animation: fadeIn 0.4s ease-out forwards; } #product-detail-backdrop.animate-out { animation: fadeOut 0.3s ease-in forwards; }

        /* --- Swiper Enhancements --- */
        .arrivals-swiper .swiper-button-next, .arrivals-swiper .swiper-button-prev { @apply text-primary dark:text-primary-light bg-light-surface/80 dark:bg-dark-surface/80 backdrop-blur-sm border border-light-border/60 dark:border-dark-border/60 rounded-full w-10 h-10 shadow-md dark:shadow-md-dark transition-all duration-300 ease-gentle hover:scale-110 hover:shadow-lg hover:bg-light-surface dark:hover:bg-dark-surface; } .arrivals-swiper .swiper-button-next::after, .arrivals-swiper .swiper-button-prev::after { @apply text-sm font-bold; } .arrivals-swiper .swiper-pagination-bullet { @apply bg-light-text-muted/40 dark:bg-dark-text-muted/40 w-2.5 h-2.5 rounded-full transition-all duration-300 mx-1; } .arrivals-swiper .swiper-pagination-bullet-active { @apply bg-primary dark:bg-primary-light scale-125 w-5; } @media (max-width: 767px) { .arrivals-swiper .swiper-button-prev, .arrivals-swiper .swiper-button-next { display: none; } } .arrivals-swiper .swiper-slide { width: auto !important; height: auto; flex-shrink: 0; }

        /* --- Visually Hidden Utility --- */
        .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

        /* --- Product Card Enhancements --- */
        .product-card { @apply flex flex-col bg-light-surface dark:bg-dark-surface rounded-xl overflow-hidden shadow-card dark:shadow-card-dark border border-light-border/30 dark:border-dark-border/30 transition-all duration-350 ease-gentle hover:transform hover:-translate-y-1.5 hover:shadow-card-hover dark:hover:shadow-card-hover-dark hover:border-primary/40 dark:hover:border-primary-light/40; max-width: 280px; }
        .arrivals-swiper .product-card { max-width: 260px; /* Kept specific max-width for swiper */ }
        .product-card-img { transition: transform 0.4s theme('transitionTimingFunction.gentle'); } .product-card:hover .product-card-img { transform: scale(1.08); /* Slightly more zoom */ } .product-card .product-card-actions { opacity: 0; transform: translateY(8px) scale(0.95); transition: opacity 0.3s ease-out, transform 0.3s ease-out; pointer-events: none; } .product-card:hover .product-card-actions { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; } .product-card .action-btn { @apply bg-light-surface/80 dark:bg-dark-surface/80 backdrop-blur-sm shadow-sm; }

        /* --- REFINED Input & Textarea Styles --- */
        .form-input, .overlay-input, textarea.form-input { @apply block w-full px-4 py-3 text-base leading-relaxed rounded-lg transition duration-200 ease-in-out appearance-none bg-light-background dark:bg-dark-surface border border-light-input-border dark:border-dark-input-border text-light-text-primary dark:text-dark-text-primary placeholder-light-text-muted dark:placeholder-dark-text-muted shadow-inner-input dark:shadow-inner-input-dark focus:outline-none focus:border-primary dark:focus:border-primary-light focus:ring-3 focus:ring-primary/20 dark:focus:ring-primary-light/20 focus:shadow-inner-input-focus dark:focus:shadow-inner-input-focus-dark; }
        textarea.form-input { padding-top: 0.8rem; padding-bottom: 0.8rem; min-height: 120px; line-height: 1.6; @apply bg-white dark:bg-dark-surface; }
        textarea.form-input:focus { box-shadow: 0 0 0 3px theme('colors.primary.DEFAULT / 20%'), theme('boxShadow.inner-input-focus'); } html.dark textarea.form-input:focus { box-shadow: 0 0 0 3px theme('colors.primary.light / 20%'), theme('boxShadow.inner-input-focus-dark'); }
        .form-input.invalid, .overlay-input.invalid, textarea.form-input.invalid { @apply border-error dark:border-error ring-2 ring-error/30 dark:ring-error/30 !important; } .form-input.invalid:focus, .overlay-input.invalid:focus, textarea.form-input.invalid:focus { @apply ring-error/40 dark:ring-error/40 border-error dark:border-error; }
        input:-webkit-autofill, input:-webkit-autofill:hover, input:-webkit-autofill:focus, input:-webkit-autofill:active { -webkit-box-shadow: 0 0 0 40px theme('colors.light.background') inset, theme('boxShadow.inner-input') !important; -webkit-text-fill-color: theme('colors.light.text-primary') !important; transition: background-color 5000s ease-in-out 0s; border-color: theme('colors.light.input-border') !important; } html.dark input:-webkit-autofill, html.dark input:-webkit-autofill:hover, html.dark input:-webkit-autofill:focus, html.dark input:-webkit-autofill:active { -webkit-box-shadow: 0 0 0 40px theme('colors.dark.surface') inset, theme('boxShadow.inner-input-dark') !important; -webkit-text-fill-color: theme('colors.dark.text-primary') !important; border-color: theme('colors.dark.input-border') !important; }
        select.overlay-input, select.form-input { padding-left: 3rem; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: left 1rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em; } html.dark select.overlay-input, html.dark select.form-input { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239CA3AF' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); } html.dark select.overlay-input option, html.dark select.form-input option { background-color: theme('colors.dark.surface'); color: theme('colors.dark.text-primary'); }
        .form-input.ltr { text-align: left; direction: ltr; }

        /* --- Modal Base Styles --- */
        .modal-overlay { /* Less intense backdrop */ @apply bg-black/50 dark:bg-black/60; /* Removed backdrop blur for clarity */ }
        .modal-content { @apply shadow-xl dark:shadow-2xl-dark max-h-[90vh] border border-light-border/60 dark:border-dark-border/60 rounded-xl relative; /* Kept base styles */ }

        /* --- Order Modal Specific Styles --- */
        /* Use light surface (white) for the main modal body */
        #order-form-modal .modal-content { @apply bg-light-surface dark:bg-dark-surface; }
        #order-form-modal .order-summary { @apply bg-light-background dark:bg-dark-background; } /* Summary contrast */
        #order-form-modal .form-input, #order-form-modal textarea.form-input { @apply bg-light-background dark:bg-dark-background; } /* Inputs match summary bg */
        #order-form-modal input:-webkit-autofill { -webkit-box-shadow: 0 0 0 40px theme('colors.light.background') inset, theme('boxShadow.inner-input') !important; }
        #order-form-modal html.dark input:-webkit-autofill { -webkit-box-shadow: 0 0 0 40px theme('colors.dark.background') inset, theme('boxShadow.inner-input-dark') !important; }

        /* --- Cart Modal Specific Styles --- */
        /* Use light surface (white) for cart modal too for bright clarity */
        #cart-modal .modal-content { @apply bg-light-surface dark:bg-dark-surface; }
        #cart-modal #cart-items-container .cart-item { @apply bg-light-background dark:bg-dark-background; } /* Item contrast */
        #cart-modal .modal-footer { @apply bg-light-surface dark:bg-dark-surface; } /* Footer matches modal bg */


        /* === Enhanced Category Card === */
        .category-card {
            @apply transition-all duration-300 ease-gentle border-2 border-light-border/70 dark:border-dark-border/70 rounded-2xl text-center p-8 bg-light-surface dark:bg-dark-surface shadow-sm hover:shadow-lg dark:hover:shadow-lg-dark; /* Larger padding, rounded-2xl */
            @apply hover:border-primary dark:hover:border-primary-light hover:-translate-y-2; /* More lift */
        }
        .category-card.active {
            @apply border-primary dark:border-primary-light bg-gradient-to-br from-primary/5 to-transparent dark:from-primary-light/10 dark:to-transparent transform -translate-y-2 shadow-lg dark:shadow-lg-dark; /* Gradient active bg */
            @apply ring-4 ring-offset-2 ring-primary/30 dark:ring-primary-light/30 ring-offset-light-background dark:ring-offset-dark-surface; /* Thicker ring */
        }
        .category-card i { @apply text-5xl md:text-6xl mb-5 transition-all duration-300 ease-gentle group-hover:scale-110 group-hover:text-primary dark:group-hover:text-primary-light; } /* Larger icon, faster transition */
        .category-card span { @apply text-lg md:text-xl font-semibold text-light-text-primary dark:text-dark-text-primary transition-colors duration-300 group-hover:text-primary dark:group-hover:text-primary-light; } /* Larger text */
        .category-card.active i, .category-card.active span { @apply text-primary dark:text-primary-light; }
        .category-card.active i { transform: scale(1.05) rotate(-5deg); } /* Slight rotation on active */
        .category-card:not(.active) i { @apply text-light-text-secondary dark:text-dark-text-secondary; }

        /* === Enhanced 3D Button Styles === */
        .btn { @apply inline-flex items-center justify-center px-7 py-3.5 text-base font-semibold rounded-xl cursor-pointer select-none; /* Larger padding, rounded-xl */ @apply transition-all duration-fast ease-smooth transform; @apply focus:outline-none focus:ring-3 focus:ring-offset-2 focus:ring-offset-light-background dark:focus:ring-offset-dark-surface; @apply disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none disabled:grayscale; /* Base shadow applied based on variant */ @apply hover:-translate-y-[3px] hover:brightness-110; /* More pronounced lift */ @apply active:translate-y-[2px] active:shadow-btn-active-shadow active:brightness-90; /* Clearer active state */ }
        .btn-primary { @apply bg-gradient-to-b from-primary to-primary-dark text-primary-text border border-primary-dark/70 shadow-btn-primary-3d dark:shadow-btn-primary-3d-dark focus:ring-primary/40 dark:focus:ring-primary-light/50 hover:from-primary-light hover:to-primary dark:bg-gradient-to-b dark:from-primary dark:to-primary-light dark:border-primary/60 dark:text-gray-900 dark:hover:from-primary-light dark:hover:to-accent/30 dark:text-black; }
        .btn-secondary { @apply bg-light-surface text-light-text-secondary border border-light-border/80 shadow-btn-3d dark:shadow-btn-3d-dark focus:ring-primary/30 dark:focus:ring-primary-light/40 hover:border-primary/70 hover:text-primary hover:bg-primary/10 dark:bg-dark-surface dark:text-dark-text-secondary dark:border-dark-border/80 dark:hover:border-primary-light/70 dark:hover:text-primary-light dark:hover:bg-primary-light/15; }
        .btn-success { @apply bg-gradient-to-b from-success to-success-dark text-success-text border border-success-dark/70 shadow-btn-success-3d dark:shadow-btn-success-3d-dark focus:ring-success/40 dark:focus:ring-success-light/50 hover:from-success-light hover:to-success dark:bg-gradient-to-b dark:from-success-light dark:to-success dark:border-emerald-500/80; } /* Ensured dark state styling */
        .btn-danger { @apply bg-gradient-to-b from-error to-error-dark text-error-text border border-error-dark/70 shadow-btn-danger-3d focus:ring-error/40 dark:focus:ring-error-light/50 hover:from-error-light hover:to-error; }
        .btn-accent { @apply bg-gradient-to-b from-accent-light to-accent text-accent-text border border-accent-dark/70 shadow-btn-accent-3d focus:ring-accent/40 hover:from-accent hover:to-accent-dark dark:from-accent dark:to-accent-dark dark:border-accent/60 dark:hover:from-accent-light dark:hover:to-accent; }

        /* --- Icon Button & Action Button --- */
        .btn-icon { @apply w-10 h-10 p-0 flex items-center justify-center rounded-full transition-all duration-200 ease-smooth bg-light-surface/70 dark:bg-dark-surface/70 backdrop-blur-sm text-light-text-secondary dark:text-dark-text-secondary border border-light-border/50 dark:border-dark-border/50 shadow-sm hover:shadow-md hover:text-primary dark:hover:text-primary-light hover:bg-light-surface dark:hover:bg-dark-surface hover:scale-110 hover:border-primary/30 dark:hover:border-primary-light/30 active:scale-95 active:shadow-inner; }
        .action-btn { @apply w-10 h-10 flex items-center justify-center rounded-full text-light-text-secondary dark:text-dark-text-secondary transition-all duration-200 ease-smooth hover:bg-light-border/60 dark:hover:bg-dark-border/60 hover:text-primary dark:hover:text-primary-light active:scale-90 focus:outline-none focus:ring-2 ring-offset-1 focus:ring-primary/30 dark:focus:ring-primary-light/30 ring-offset-light-background dark:ring-offset-dark-background; }
        .cart-btn.has-items .cart-icon { @apply text-primary dark:text-primary-light animate-pulse; } /* Simple pulse */
        #cart-count { transition: transform 0.3s theme('transitionTimingFunction.bouncy'), background-color 0.2s ease; }

        /* --- Scroll-to-top Button --- */
        #scroll-to-top-btn { @apply fixed bottom-6 left-6 z-50 w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all duration-medium ease-gentle opacity-0 invisible transform scale-90 bg-gradient-to-br from-primary to-accent text-white shadow-btn-primary-3d dark:shadow-btn-primary-3d-dark hover:scale-110 hover:brightness-110 hover:shadow-xl active:scale-100 active:translate-y-px active:shadow-btn-active-shadow active:brightness-90; } html.dark #scroll-to-top-btn { @apply bg-gradient-to-br from-primary-light to-accent/80; } #scroll-to-top-btn.visible { @apply opacity-100 visible scale-100; } #scroll-to-top-btn i { @apply text-xl; }

        /* Removed redundant WhatsApp Submit Button specific style block as it will now use .btn and .btn-success */

        /* Shimmer effect placeholder */
        .shimmer-bg { background: linear-gradient(to right, transparent 0%, theme('colors.light.border / 50%') 50%, transparent 100%); background-size: 200% 100%; animation: shimmer 1.5s infinite linear; }
        html.dark .shimmer-bg { background: linear-gradient(to right, transparent 0%, theme('colors.dark.border / 50%') 50%, transparent 100%); background-size: 200% 100%; }

    </style>
</head>
<body class="bg-light-background dark:bg-dark-background text-light-text-primary dark:text-dark-text-primary transition-colors duration-medium font-sans antialiased text-base overflow-x-hidden">

    <header id="main-header" class="sticky top-0 left-0 right-0 z-50 h-16 md:h-20 bg-light-background/80 dark:bg-dark-background/80 backdrop-blur-lg border-b border-light-border/50 dark:border-dark-border/50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 h-full flex justify-between items-center">
            <a href="#hero" class="logo flex-shrink-0 transition-opacity hover:opacity-80" aria-label="الصفحة الرئيسية">
                <img src="logo.png" alt="Master Quality Logo" class="max-h-9 md:max-h-10" onerror="this.src='https://placehold.co/150x40/F8FAFC/0891B2?text=Master+Quality&font=cairo'; this.onerror=null;">
            </a>
            <nav id="main-nav" class="hidden lg:block">
                <ul class="flex space-x-8 space-x-reverse">
                    <li><a href="#hero" class="nav-link text-base font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light pb-2">الرئيسية</a></li>
                    <li><a href="#categories" class="nav-link text-base font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light pb-2">الفئات</a></li>
                    <li><a href="#new-arrivals" class="nav-link text-base font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light pb-2">جديدنا</a></li>
                    <li><a href="#products" class="nav-link text-base font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light pb-2">المنتجات</a></li>
                </ul>
            </nav>
            <div class="flex items-center space-x-2 sm:space-x-3 space-x-reverse">
                 <button id="search-filter-toggle-btn" class="action-btn" aria-label="بحث وفلترة"><i class="fas fa-search text-lg"></i></button>
                 <button id="cart-button" class="action-btn cart-btn relative" aria-label="سلة التسوق">
                     <i class="fas fa-cart-shopping cart-icon text-lg text-cart-icon-color dark:text-cart-icon-color-dark transition-colors duration-200"></i>
                     <span id="cart-count" class="absolute -top-1 -right-1 bg-cart-badge-bg text-white text-[0.7rem] font-bold rounded-full w-5 h-5 flex items-center justify-center leading-none border-2 border-light-background dark:border-dark-background transition-transform transform scale-0 origin-center">0</span>
                 </button>
                 <button id="theme-toggle-button" class="action-btn" aria-label="تبديل الوضع"><i class="fas fa-sun text-lg"></i></button>
                 <button id="mobile-nav-toggle" class="lg:hidden action-btn" aria-label="فتح القائمة" aria-expanded="false"><i class="fas fa-bars text-lg"></i></button>
            </div>
        </div>
        <div id="mobile-nav-menu" class="lg:hidden absolute top-full left-0 right-0 bg-light-surface dark:bg-dark-surface border-t border-b border-light-border dark:border-dark-border shadow-lg transform -translate-y-full opacity-0 invisible -z-10">
            <nav class="p-5">
                <ul class="flex flex-col space-y-2">
                     <li><a href="#hero" class="nav-link block text-lg font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light px-4 py-3 rounded-lg hover:bg-primary/5 dark:hover:bg-primary-light/10">الرئيسية</a></li>
                     <li><a href="#categories" class="nav-link block text-lg font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light px-4 py-3 rounded-lg hover:bg-primary/5 dark:hover:bg-primary-light/10">الفئات</a></li>
                     <li><a href="#new-arrivals" class="nav-link block text-lg font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light px-4 py-3 rounded-lg hover:bg-primary/5 dark:hover:bg-primary-light/10">جديدنا</a></li>
                     <li><a href="#products" class="nav-link block text-lg font-medium text-light-text-secondary dark:text-dark-text-secondary hover:text-primary dark:hover:text-primary-light px-4 py-3 rounded-lg hover:bg-primary/5 dark:hover:bg-primary-light/10">المنتجات</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content pt-8 md:pt-12">

        <section id="hero" class="relative min-h-[75vh] md:min-h-[85vh] flex items-center justify-center bg-gradient-to-br from-primary/10 via-transparent to-accent/5 dark:from-primary-dark/15 dark:via-transparent dark:to-accent/10 overflow-hidden section-animate">
             <div class="absolute inset-0 opacity-20 dark:opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%230891B2' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); "></div>
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10 animate-fade-in-up animation-delay-200">
                <h1 class="text-4xl sm:text-5xl lg:text-6xl xl:text-7xl font-bold font-heading text-light-text-primary dark:text-dark-text-primary mb-5 md:mb-6 leading-tight tracking-tight drop-shadow-md dark:drop-shadow-lg">
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent dark:from-primary-light dark:to-accent/90">الأناقة</span> تبدأ من هنا
                </h1>
                <p class="text-lg sm:text-xl md:text-2xl text-light-text-secondary dark:text-dark-text-secondary mb-10 md:mb-12 max-w-xl lg:max-w-2xl mx-auto">اكتشفي تشكيلتنا المختارة بعناية من أجود التصاميم العصرية التي تبرز جمالك.</p>
                <a href="#products" class="btn btn-primary px-10 py-4 text-lg md:text-xl"><i class="fas fa-shopping-bag mr-2.5"></i> تسوقي الآن</a>
            </div>
            <div class="absolute top-1/4 left-1/4 w-2/5 h-2/5 bg-primary/15 dark:bg-primary-dark/10 rounded-full filter blur-[120px] opacity-40 dark:opacity-30 transform-gpu animate-pulse-glow"></div>
            <div class="absolute bottom-1/4 right-1/4 w-1/3 h-1/3 bg-accent/10 dark:bg-accent/15 rounded-full filter blur-[100px] opacity-50 dark:opacity-35 transform-gpu animate-pulse-glow animation-delay-2000"></div>
        </section>

        <section id="categories" class="py-16 md:py-24 bg-light-background dark:bg-dark-background section-animate">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl md:text-4xl lg:text-5xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary text-center mb-14 md:mb-20">تصفحي حسب الفئة</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-6 md:gap-8 lg:gap-10">
                     <!-- REMOVED HTML Comment -->
                    <a href="#products" data-category="all" class="category-card group"><i class="fas fa-tags"></i><span>الكل</span></a>
                    <a href="#products" data-category="trousers" class="category-card group"><i class="fas fa-user-secret"></i><span>بناطيل</span></a>
                    <a href="#products" data-category="dresses" class="category-card group"><i class="fas fa-vest-patches"></i><span>فساتين</span></a>
                    <a href="#products" data-category="maternity" class="category-card group"><i class="fas fa-person-pregnant"></i><span>حوامل</span></a>
                    <a href="#products" data-category="tops" class="category-card group"><i class="fas fa-tshirt"></i><span>توبات</span></a>
                </div>
            </div>
        </section>

        <section id="new-arrivals" class="py-16 md:py-24 bg-gradient-to-b from-light-surface to-light-background dark:from-dark-surface dark:to-dark-background overflow-hidden section-animate">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative">
                 <h2 class="text-3xl md:text-4xl lg:text-5xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary text-center mb-14 md:mb-20"><i class="fas fa-sparkles text-accent mr-3"></i> أحدث ما وصلنا</h2>
                <div class="swiper arrivals-swiper pb-12 md:pb-16">
                    <div class="swiper-wrapper" id="new-arrivals-wrapper">
                         <!-- REMOVED HTML Comment -->
                    </div>
                    <div class="swiper-pagination !bottom-4 md:!bottom-5"></div>
                    <div class="swiper-button-next !right-1 md:!-right-3 transform translate-y-[-50%]"></div>
                    <div class="swiper-button-prev !left-1 md:!-left-3 transform translate-y-[-50%]"></div>
                </div>
            </div>
        </section>

        <section id="products" class="py-16 md:py-24 bg-light-background dark:bg-dark-background section-animate">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div id="category-header" class="text-center mb-14 md:mb-20">
                    <h2 id="category-title-main" class="text-4xl md:text-5xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mb-4">جميع المنتجات</h2>
                    <p id="category-description" class="text-light-text-secondary dark:text-dark-text-secondary text-base md:text-lg max-w-lg mx-auto">تصفحي جميع منتجاتنا المختارة بعناية فائقة.</p>
                    <button id="clear-filters-btn" class="hidden mt-5 text-sm text-accent hover:text-accent-dark dark:hover:text-accent-light font-medium transition-colors underline underline-offset-2 hover:no-underline inline-flex items-center gap-1">
                        <i class="fas fa-times-circle text-xs"></i> إزالة الفلاتر
                    </button>
                </div>
                <div class="product-grid grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 md:gap-7 lg:gap-8 mb-14 md:mb-20" id="product-grid-main">
                     <!-- REMOVED HTML Comment -->
                </div>
                <div class="load-more-container text-center py-6">
                    <button id="load-more-button" class="btn btn-secondary px-8 py-3.5 text-lg"><i class="fas fa-chevron-down mr-2 text-sm"></i> عرض المزيد</button>
                </div>
                <div id="no-results" class="hidden text-center py-20 md:py-24 px-6 bg-light-surface dark:bg-dark-surface rounded-2xl border border-dashed border-light-border dark:border-dark-border max-w-xl mx-auto shadow-sm dark:shadow-sm-dark">
                     <i class="fas fa-box-open text-6xl md:text-7xl text-warning/50 dark:text-warning/60 mb-8"></i>
                    <p class="text-xl md:text-2xl font-semibold text-light-text-primary dark:text-dark-text-primary mb-4">عفواً، لا توجد منتجات!</p>
                    <p class="text-base md:text-lg text-light-text-muted dark:text-dark-text-muted">جرّب تعديل الفلاتر أو استعراض فئة أخرى.</p>
                </div>
            </div>
        </section>

        <footer id="footer" class="pt-16 pb-10 bg-gradient-to-t from-light-surface to-light-background dark:from-dark-surface dark:to-dark-background text-center text-sm border-t border-light-border/70 dark:border-dark-border/70 section-animate">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="footer-logo mb-6">
                    <img src="logo.png" alt="Master Quality Logo Footer" class="max-h-10 mx-auto opacity-80" onerror="this.src='https://placehold.co/130x40/F8FAFC/6B7280?text=Master+Quality&font=cairo'; this.onerror=null;">
                </div>
                <p class="mb-5 text-sm md:text-base text-light-text-secondary dark:text-dark-text-secondary">&copy; <span id="year">2025</span> Master Quality. جميع الحقوق محفوظة.</p>
                <div class="flex justify-center items-center space-x-5 space-x-reverse mb-6">
                     <a href="https://wa.me/9647778076465" target="_blank" rel="noopener noreferrer" class="font-semibold text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 transition-colors duration-200 inline-flex items-center gap-2 text-base md:text-lg group">
                         <i class="fab fa-whatsapp text-xl md:text-2xl transition-transform group-hover:scale-110"></i>
                        <span>تواصل معنا عبر واتساب</span>
                    </a>
                </div>
                <div class="mt-6 flex justify-center gap-x-6">
                    <a href="#" id="privacy-policy-link" class="text-xs text-light-text-muted dark:text-dark-text-muted hover:text-primary dark:hover:text-primary-light transition-colors duration-200 hover:underline underline-offset-2">سياسة الخصوصية</a>
                    <a href="#" id="return-policy-link" class="text-xs text-light-text-muted dark:text-dark-text-muted hover:text-primary dark:hover:text-primary-light transition-colors duration-200 hover:underline underline-offset-2">سياسة الإرجاع</a>
                </div>
            </div>
        </footer>

    </main>

    <div id="product-detail-panel" class="fixed inset-y-0 right-0 w-full sm:w-4/5 md:w-[450px] lg:w-[500px] xl:w-[550px] h-full bg-light-background dark:bg-dark-surface shadow-2xl z-[60] overflow-y-auto p-6 pt-20 md:p-8 md:pt-24 border-l border-light-border/60 dark:border-dark-border/60 hidden">
         <button id="close-detail-panel-btn" class="action-btn absolute top-5 left-5 z-10" title="إغلاق"><i class="fas fa-times text-xl"></i></button>
        <div id="product-detail-content" class="space-y-7 md:space-y-9">
            <!-- REMOVED HTML Comment -->
        </div>
    </div>
    <div id="product-detail-backdrop" style="display: none;" class="fixed inset-0 bg-black/60 dark:bg-black/75 z-[59] backdrop-blur-md"></div>

    <div id="order-form-modal" style="display: none;" class="modal-overlay fixed inset-0 bg-black/50 dark:bg-black/60 z-[70] flex items-center justify-center p-4">
        <div class="modal-content w-full max-w-xl bg-light-surface dark:bg-dark-surface">
            <button id="modal-close-button-order" class="action-btn absolute top-4 left-4 z-10" title="إغلاق"><i class="fas fa-times text-2xl"></i></button>
            <div class="text-center p-6 border-b border-light-border dark:border-dark-border">
                 <i class="fas fa-shipping-fast text-5xl text-primary dark:text-primary-light mb-4 block animation-bounce-small"></i>
                <h2 class="text-2xl md:text-3xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mb-1.5">تأكيد الطلب</h2>
                <p class="text-base text-light-text-secondary dark:text-dark-text-secondary">الدفع نقداً عند الاستلام</p>
            </div>
            <div class="p-7 md:p-8">
                 <div class="order-summary bg-light-background dark:bg-dark-background p-5 rounded-xl border border-light-border dark:border-dark-border mb-8 shadow-sm dark:shadow-sm-dark">
                    <h4 id="order-summary-main-title" class="text-lg font-semibold text-primary dark:text-primary-light mb-4 pb-3 border-b border-primary/20 dark:border-primary-light/20 flex items-center gap-2.5"><i class="fas fa-receipt text-lg"></i> ملخص الطلب</h4>
                    <div id="order-summary-single-item-details" class="text-base space-y-3 mb-3">
                        <p id="order-summary-title" class="font-semibold text-light-text-primary dark:text-dark-text-primary">اسم المنتج هنا</p>
                        <div class="text-light-text-secondary dark:text-dark-text-secondary flex justify-between items-center text-sm">
                             <span class="flex items-center gap-1.5"><i class="fas fa-ruler-combined text-base text-accent mr-1"></i> المقاس: <span id="order-summary-size" class="font-medium text-light-text-primary dark:text-dark-text-primary bg-light-surface dark:bg-dark-surface px-2.5 py-1 rounded text-sm border border-light-border dark:border-dark-border"></span></span>
                             <span class="flex items-center gap-1.5"><i class="fas fa-tag text-base text-accent mr-1"></i> السعر: <span id="order-summary-price" class="font-bold text-lg text-primary dark:text-primary-light"></span> <span class="text-xs">د.ع</span></span>
                        </div>
                    </div>
                     <ul id="order-summary-items-list" class="hidden list-none p-4 my-4 text-right max-h-52 overflow-y-auto border border-light-border dark:border-dark-border rounded-lg bg-light-surface dark:bg-dark-background text-base space-y-3.5 shadow-inner-sm dark:shadow-inner-sm-dark">
                         <!-- REMOVED HTML Comment -->
                     </ul>
                    <input type="hidden" id="order-form-product-id"><input type="hidden" id="order-form-product-title"><input type="hidden" id="order-form-product-size"><input type="hidden" id="order-form-product-price">
                </div>
                <form id="order-form" novalidate class="space-y-6">
                    <div id="form-error-message" class="hidden p-4 bg-error/10 border border-error/30 text-error text-base rounded-lg font-medium text-center shadow-sm dark:shadow-sm-dark"></div>
                    <div>
                        <label for="customer-name" class="block mb-2 text-base font-medium text-light-text-secondary dark:text-dark-text-secondary"><i class="fas fa-user mr-1.5 text-sm text-accent"></i> الاسم الكامل *</label>
                        <input type="text" id="customer-name" name="customerName" required placeholder="الاسم الثلاثي" aria-required="true" class="form-input"/>
                    </div>
                    <div>
                        <label for="customer-phone" class="block mb-2 text-base font-medium text-light-text-secondary dark:text-dark-text-secondary"><i class="fab fa-whatsapp mr-1.5 text-sm text-accent"></i> رقم الهاتف (واتساب) *</label>
                        <input type="tel" id="customer-phone" name="customerPhone" required pattern="^(07[5789][0-9]{8})$" placeholder=" يبدأ بـ 07xxxxxxxx" aria-required="true" class="form-input ltr"/>
                    </div>
                    <div>
                        <label for="customer-address" class="block mb-2 text-base font-medium text-light-text-secondary dark:text-dark-text-secondary"><i class="fas fa-map-marker-alt mr-1.5 text-sm text-accent"></i> العنوان الكامل *</label>
                        <textarea id="customer-address" name="customerAddress" rows="4" required placeholder="المحافظة، المنطقة، أقرب نقطة دالة..." aria-required="true" class="form-input resize-none"></textarea>
                    </div>
                    <!-- IMPROVED WhatsApp Button Style -->
                    <button type="submit" id="modal-whatsapp-button-final-elegant" class="btn btn-success w-full py-4 text-lg flex items-center justify-center gap-x-2.5">
                        <i class="fab fa-whatsapp text-xl"></i> <span>إرسال الطلب عبر واتساب</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div id="cart-modal" style="display: none;" class="modal-overlay fixed inset-0 bg-black/50 dark:bg-black/60 z-[70] flex items-center justify-center p-4">
        <div class="modal-content w-full max-w-2xl flex flex-col bg-light-surface dark:bg-dark-surface">
            <button id="modal-close-button-cart" class="action-btn absolute top-4 left-4 z-10" title="إغلاق"><i class="fas fa-times text-2xl"></i></button>
            <div class="text-center p-6 border-b border-light-border dark:border-dark-border flex-shrink-0">
                 <i class="fas fa-cart-shopping text-5xl text-primary dark:text-primary-light mb-3 block"></i>
                 <h2 class="text-2xl md:text-3xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mb-1">سلة التسوق</h2>
                 <p class="text-base text-light-text-secondary dark:text-dark-text-secondary">المنتجات التي أضفتها مؤخراً</p>
             </div>
             <div id="cart-items-container" class="p-5 md:p-7 flex-grow overflow-y-auto space-y-5 max-h-[60vh]">
                <div id="cart-empty-message" class="hidden text-center py-16 px-4 flex flex-col items-center justify-center h-full">
                    <i class="fas fa-shopping-bag text-7xl text-accent/40 dark:text-accent/50 mb-8 opacity-70"></i>
                    <p class="text-xl md:text-2xl font-semibold text-light-text-secondary dark:text-dark-text-secondary mb-3">سلتك فارغة!</p>
                    <p class="text-base text-light-text-muted dark:text-dark-text-muted mb-6">ابدئي بإضافة المنتجات التي تعجبك.</p>
                     <a href="#products" id="start-shopping-btn-cart" class="btn btn-primary px-8 py-3.5 text-lg"><i class="fas fa-store mr-2"></i> البدء بالتسوق</a>
                </div>
                 <!-- REMOVED HTML Comment -->
            </div>
             <div class="p-6 border-t border-light-border dark:border-dark-border flex-shrink-0 bg-light-surface dark:bg-dark-surface rounded-b-xl">
                  <button id="cart-order-all-btn" class="btn btn-success w-full py-4 text-lg">
                    <i class="fas fa-check-circle mr-2 text-base"></i> إتمام طلب المنتجات في السلة
                  </button>
             </div>
        </div>
     </div>

    <div id="search-filter-overlay" style="display: none;" class="fixed inset-0 bg-black/50 dark:bg-black/70 z-[65] flex justify-center items-start pt-20 sm:pt-24 px-4 backdrop-blur-md">
        <div class="overlay-content bg-light-surface dark:bg-dark-surface w-full max-w-xl p-7 md:p-8 rounded-2xl shadow-xl relative border border-light-border dark:border-dark-border animate-in">
            <button class="action-btn absolute top-4 left-4" id="close-search-filter-overlay" aria-label="إغلاق"><i class="fas fa-times text-2xl"></i></button>
             <h3 class="text-xl md:text-2xl font-semibold font-heading text-center mb-7 text-light-text-primary dark:text-dark-text-primary"><i class="fas fa-sliders-h mr-2 text-accent"></i> البحث والفلترة</h3>
            <div class="space-y-6">
                <div>
                    <label for="overlay-search-input" class="block text-base font-medium text-light-text-secondary dark:text-dark-text-secondary mb-2"><i class="fas fa-search mr-1.5 text-sm text-accent"></i> البحث عن منتج</label>
                     <div class="relative">
                        <input type="search" id="overlay-search-input" placeholder="اكتب اسم المنتج أو جزء منه..." class="overlay-input pr-11">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-light-text-muted dark:text-dark-text-muted text-lg pointer-events-none"></i>
                    </div>
                </div>
                <div>
                     <label for="overlay-size-select" class="block text-base font-medium text-light-text-secondary dark:text-dark-text-secondary mb-2"><i class="fas fa-ruler-combined mr-1.5 text-sm text-accent"></i> الفلترة حسب المقاس</label>
                     <select id="overlay-size-select" aria-label="اختر المقاس للفلترة" class="overlay-input">
                         <option value="all">-- كل المقاسات --</option>
                        <option value="XS">XS</option> <option value="S">S</option> <option value="M">M</option>
                        <option value="L">L</option> <option value="XL">XL</option> <option value="XXL">XXL</option>
                        <option value="2XL">2XL</option>
                    </select>
                </div>
                 <button id="apply-overlay-filters" class="btn btn-primary w-full py-3.5 text-lg"><i class="fas fa-check mr-1.5"></i> تطبيق وعرض النتائج</button>
                 <button id="clear-overlay-filters-btn" class="btn btn-secondary w-full py-3 text-base mt-2"><i class="fas fa-times mr-1.5"></i> مسح الفلاتر</button>
            </div>
        </div>
    </div>

    <div id="privacy-policy-modal" style="display: none;" class="modal-overlay fixed inset-0 bg-black/60 dark:bg-black/75 z-[70] flex items-center justify-center p-4">
         <div class="modal-content w-full max-w-3xl flex flex-col bg-light-surface dark:bg-dark-surface">
            <button id="modal-close-button-privacy" class="action-btn absolute top-4 left-4 z-10" title="إغلاق"><i class="fas fa-times text-2xl"></i></button>
             <div class="text-center p-6 border-b border-light-border dark:border-dark-border flex-shrink-0">
                  <i class="fas fa-shield-alt text-5xl text-primary dark:text-primary-light mb-3 block"></i>
                  <h2 class="text-2xl md:text-3xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mb-1">سياسة الخصوصية</h2>
              </div>
              <div id="privacy-policy-content" class="p-7 md:p-8 flex-grow overflow-y-auto text-base text-light-text-secondary dark:text-dark-text-secondary space-y-5 leading-relaxed max-h-[65vh]">
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-2 mb-2">مقدمة</h3><p>نحن في Master Quality نقدر خصوصيتك ونسعى لحماية بياناتك الشخصية. توضح سياسة الخصوصية هذه كيف نجمع ونستخدم ونحمي معلوماتك عند استخدامك لموقعنا الإلكتروني.</p>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">المعلومات التي نجمعها</h3><p>عند قيامك بطلب منتج، قد نطلب منك تقديم معلومات شخصية معينة لإتمام عملية الشراء والتوصيل، وتشمل هذه المعلومات:</p><ul class="list-disc list-inside space-y-1.5 mr-5"><li>الاسم الكامل</li><li>رقم الهاتف (خاصة رقم واتساب لتأكيد الطلب والتواصل)</li><li>العنوان الكامل للتوصيل (المحافظة، المنطقة، أقرب نقطة دالة)</li></ul><p>لا نجمع أي معلومات دفع إلكترونية حيث أن الدفع يتم نقداً عند الاستلام.</p>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">كيف نستخدم معلوماتك</h3><p>نستخدم المعلومات التي نجمعها للأغراض التالية:</p><ul class="list-disc list-inside space-y-1.5 mr-5"><li>معالجة وتأكيد طلباتك.</li><li>توصيل المنتجات إلى عنوانك المحدد.</li><li>التواصل معك بخصوص طلبك عبر الهاتف أو واتساب.</li><li>تحسين تجربة استخدامك للموقع وخدماتنا.</li></ul>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">مشاركة المعلومات</h3><p>نحن لا نبيع أو نؤجر معلوماتك الشخصية لأطراف ثالثة. قد نشارك معلوماتك الضرورية (مثل الاسم، الهاتف، والعنوان) مع شركاء التوصيل الموثوقين لدينا فقط لغرض توصيل طلبك إليك.</p>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">أمن المعلومات</h3><p>نتخذ تدابير أمنية معقولة لحماية معلوماتك الشخصية من الوصول غير المصرح به أو الاستخدام أو التعديل أو الكشف. ومع ذلك، لا يمكن ضمان أمان أي نظام نقل بيانات عبر الإنترنت بنسبة 100%.</p>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">ملفات تعريف الارتباط (Cookies) وتخزين المتصفح</h3><p>قد يستخدم موقعنا ملفات تعريف الارتباط الأساسية وتخزين المتصفح (LocalStorage) لتحسين تجربة التصفح (مثل تذكر تفضيلات الوضع المظلم ومحتويات سلة التسوق مؤقتًا). لا تُستخدم هذه البيانات لجمع معلومات تعريف شخصية خارج نطاق وظائف الموقع الأساسية.</p>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">حقوقك</h3><p>لديك الحق في طلب الوصول إلى معلوماتك الشخصية التي نحتفظ بها أو تصحيحها. يمكنك التواصل معنا لممارسة هذه الحقوق.</p>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">التغييرات على سياسة الخصوصية</h3><p>قد نقوم بتحديث سياسة الخصوصية هذه من وقت لآخر. سيتم نشر أي تغييرات على هذه الصفحة. ننصحك بمراجعة هذه الصفحة بشكل دوري للاطلاع على أي تحديثات.</p>
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">اتصل بنا</h3><p>إذا كان لديك أي أسئلة حول سياسة الخصوصية هذه، يمكنك التواصل معنا عبر واتساب على الرقم: <a href="https://wa.me/9647778076465" target="_blank" rel="noopener noreferrer" class="text-green-600 dark:text-green-400 hover:underline">9647778076465</a></p><p class="mt-8 text-sm text-light-text-muted dark:text-dark-text-muted">آخر تحديث: 25 أبريل 2025</p>
              </div>
              <div class="p-5 border-t border-light-border dark:border-dark-border flex-shrink-0 text-left">
                  <button id="privacy-modal-close-btn-bottom" class="btn btn-secondary px-6 py-3">فهمت، إغلاق</button>
              </div>
         </div>
      </div>

    <!-- NEW: Return Policy Modal -->
    <div id="return-policy-modal" style="display: none;" class="modal-overlay fixed inset-0 bg-black/60 dark:bg-black/75 z-[70] flex items-center justify-center p-4">
         <div class="modal-content w-full max-w-3xl flex flex-col bg-light-surface dark:bg-dark-surface">
            <button id="modal-close-button-return" class="action-btn absolute top-4 left-4 z-10" title="إغلاق"><i class="fas fa-times text-2xl"></i></button>
             <div class="text-center p-6 border-b border-light-border dark:border-dark-border flex-shrink-0">
                  <i class="fas fa-undo-alt text-5xl text-primary dark:text-primary-light mb-3 block"></i> <!-- Changed Icon -->
                  <h2 class="text-2xl md:text-3xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mb-1">سياسة الإرجاع والاستبدال</h2> <!-- Changed Title -->
              </div>
              <div id="return-policy-content" class="p-7 md:p-8 flex-grow overflow-y-auto text-base text-light-text-secondary dark:text-dark-text-secondary space-y-5 leading-relaxed max-h-[65vh]">
                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-2 mb-2">هدفنا رضاكم</h3>
                   <p>نسعى في Master Quality لتقديم منتجات عالية الجودة ترضي أذواقكم. إذا لم تكن راضياً تماماً عن المنتج الذي استلمته، فنحن هنا للمساعدة.</p>

                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">شروط الإرجاع والاستبدال</h3>
                   <p>يمكنك طلب إرجاع أو استبدال المنتج خلال فترة <strong class="text-light-text-primary dark:text-dark-text-primary">[عدد الأيام،  2 أيام]</strong> من تاريخ استلام الطلب، وذلك ضمن الشروط التالية:</p>
                   <ul class="list-disc list-inside space-y-1.5 mr-5">
                       <li>أن يكون المنتج في حالته الأصلية التي استلمته بها، غير مستخدم، ومع كافة البطاقات والملصقات الأصلية المرفقة.</li>
                       <li>أن يكون المنتج بنفس التغليف الأصلي.</li>
                       <li>تقديم ما يثبت عملية الشراء (مثل رسالة تأكيد الطلب عبر واتساب).</li>
                       <li>[ لا يمكن إرجاع/استبدال الملابس الداخلية أو ملابس السباحة لأسباب صحية].</li>
                       <li>في حالة وجود عيب مصنعي في المنتج، يرجى التواصل معنا فوراً.</li>
                   </ul>

                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">آلية الإرجاع والاستبدال</h3>
                   <p>لطلب الإرجاع أو الاستبدال، يرجى اتباع الخطوات التالية:</p>
                   <ol class="list-decimal list-inside space-y-1.5 mr-5">
                       <li>تواصل معنا عبر واتساب على الرقم: <a href="https://wa.me/9647778076465" target="_blank" rel="noopener noreferrer" class="text-green-600 dark:text-green-400 hover:underline">9647778076465</a> خلال الفترة المحددة.</li>
                       <li>وضح سبب الإرجاع أو الاستبدال وزودنا بتفاصيل الطلب.</li>
                       <li>سنقوم بترتيب عملية استلام المنتج المرتجع منك عبر مندوب التوصيل.</li>
                       <li>بعد استلام المنتج وفحصه والتأكد من مطابقته للشروط، سيتم التدقيق بطلبك (استرداد المبلغ أو إرسال المنتج البديل).</li>
                   </ol>

                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">تكاليف الإرجاع والاستبدال</h3>
                   <ul class="list-disc list-inside space-y-1.5 mr-5">
                       <li>في حالة وجود عيب مصنعي أو خطأ في الطلب من طرفنا، سنتحمل كافة تكاليف الشحن والاستبدال.</li>
                       <li>في حالة رغبة العميل في الإرجاع أو الاستبدال لأسباب أخرى (مثل تغيير المقاس أو عدم الرغبة بالمنتج)، يتحمل العميل تكاليف الشحن والإرجاع البالغة <strong class="text-light-text-primary dark:text-dark-text-primary">[ : 5,000 د.ع]</strong>.</li>
                   </ul>

                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">استرداد المبلغ</h3>
                   <p>في حالة الإرجاع والموافقة على استرداد المبلغ، سيتم ذلك خلال <strong class="text-light-text-primary dark:text-dark-text-primary">[عدد الأيام، : 3 أيام عمل]</strong> بعد استلام المنتج المرتجع والتأكد منه. سيتم التواصل معك لترتيب طريقة الاسترداد المناسبة.</p>

                   <h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-6 mb-2">اتصل بنا</h3>
                   <p>إذا كان لديك أي استفسارات بخصوص سياسة الإرجاع والاستبدال، لا تتردد في التواصل معنا عبر واتساب.</p>

                   <p class="mt-8 text-sm text-light-text-muted dark:text-dark-text-muted">آخر تحديث: 25 أبريل 2025</p>
                   <!-- End Placeholder Content -->
              </div>
              <div class="p-5 border-t border-light-border dark:border-dark-border flex-shrink-0 text-left">
                  <button id="return-modal-close-btn-bottom" class="btn btn-secondary px-6 py-3">فهمت، إغلاق</button>
              </div>
         </div>
      </div>

    <button id="scroll-to-top-btn" title="العودة للأعلى">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>

    <script>
    // --- Product Data (Checked) ---
    const products = [ /* Product data remains the same */
        { id: 1, title: "بنطلون جيجنز Master Quality أزرق مريح", image: "1.png", price: "10,000", size: "S (كمر 36)", base_size: "S", category: "trousers", availability: "in stock", description: "جيجنز مريح وعملي بلون أزرق جذاب، مثالي للارتداء اليومي.", is_new: false }, { id: 4, title: "بنطلون جيجنز Master Quality أزرق عملي", image: "4.png", price: "10,000", size: "M (كمر 40)", base_size: "M", category: "trousers", availability: "in stock", description: "جيجنز بقصة عملية ومريحة للاستخدام اليومي.", is_new: false }, { id: 5, title: "بنطلون Master Quality مطبع بألوان زاهية", image: "5.png", price: "10,000", size: "L (كمر 42)", base_size: "L", category: "trousers", availability: "in stock", description: "بنطلون قماش خفيف بنقشة بيزلي زاهية ومميزة.", is_new: true }, { id: 7, title: "بنطلون Master Quality خصر عالي جملي", image: "7.png", price: "10,000", size: "XXL (كمر 48)", base_size: "XXL", category: "trousers", availability: "in stock", description: "بنطلون أنيق بلون جملي دافئ وخصر عالي مع أزرار زينة.", is_new: false }, { id: 8, title: "بنطلون Master Quality مقلم أرجل واسعة رمادي", image: "8.png", price: "10,000", size: "M (كمر 38)", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون عصري مقلم بقصة أرجل واسعة ومريحة.", is_new: false }, { id: 9, title: "بنطلون Master Quality أسود بحزام وكسرات", image: "9.png", price: "10,000", size: "M (كمر 38)", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون أسود كلاسيكي مع حزام أنيق وكسرات أمامية لإطلالة رسمية.", is_new: false }, { id: 10, title: "بنطلون Master Quality بيج أرجل واسعة", image: "10.png", price: "10,000", size: "M (كمر 38)", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون بيج فاتح بقصة أرجل واسعة وخامة مريحة للصيف.", is_new: false }, { id: 11, title: "بنطلون Master Quality أصفر خردلي برباط خصر", image: "11.png", price: "10,000", size: "L (كمر 42)", base_size: "L", category: "trousers", availability: "in stock", description: "بنطلون كاجوال مريح بلون أصفر خردلي جذاب وخصر مطاطي مع رباط.", is_new: false }, { id: 12, title: "بنطلون Master Quality أبيض قصة مرتبة", image: "12.png", price: "10,000", size: "S (كمر 34)", base_size: "S", category: "trousers", availability: "in stock", description: "بنطلون أبيض أساسي بقصة كلاسيكية مرتبة لمختلف المناسبات.", is_new: true }, { id: 13, title: "بنطلون Master Quality دانتيل أبيض", image: "13.png", price: "10,000", size: "L (كمر 42)", base_size: "L", category: "trousers", availability: "in stock", description: "بنطلون أنيق من الدانتيل الأبيض الفاخر لإطلالة مميزة وجذابة.", is_new: false }, { id: 14, title: "بنطلون Master Quality ليجنز زيتي مطبع", image: "14.png", price: "10,000", size: "M (كمر 37)", base_size: "M", category: "trousers", availability: "in stock", description: "ليجنز مريح بلون زيتي عملي ونقشة هادئة.", is_new: false }, { id: 102, title: "بنطلون كارجو Master Quality بيج برباط كاحل", image: "102.png", price: "8,000", size: "M", base_size: "M", category: "trousers", availability: "in stock", description: "بنطلون كارجو عملي ومريح بلون بيج، يتميز برباط قابل للتعديل عند الكاحل.", is_new: true },
        { id: 2, title: "بنطلون جينز حوامل Master Quality أزرق فاتح", image: "2.png", price: "14,000", size: "XL (كمر 44)", base_size: "XL", category: "maternity", availability: "in stock", description: "جينز حوامل بقصة مريحة ولون فاتح مع حزام بطن قماشي عريض ومرن.", is_new: false }, { id: 3, title: "بنطلون جينز حوامل Master Quality أزرق فاتح", image: "3.png", price: "14,000", size: "L (كمر 40)", base_size: "L", category: "maternity", availability: "in stock", description: "جينز حوامل بقصة مريحة ولون فاتح مع حزام بطن قماشي عريض ومرن.", is_new: false }, { id: 54, title: "بلوزة حوامل Master Quality بيج بياقة V", image: "54.png", price: "8,000", size: "XS", base_size: "XS", category: "maternity", availability: "in stock", description: "بلوزة حوامل مريحة بلون بيج، تتميز بتصميم لف وياقة V وأكمام قصيرة.", is_new: true },
        { id: 15, title: "توب تانك Master Quality مضلع رمادي غامق", image: "15.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب أساسي مضلع ومريح بلون رمادي غامق للاستخدام اليومي.", is_new: false }, { id: 16, title: "توب كروب Master Quality مضلع أخضر ليموني", image: "16.png", price: "4,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "توب كروب عصري مضلع بلون نيون منعش وحافة مكشكشة.", is_new: true }, { id: 17, title: "توب تانك Master Quality مخطط فوشي/أبيض", image: "17.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب مخطط كلاسيكي بألوان صيفية زاهية وحواف بيضاء.", is_new: false }, { id: 18, title: "توب تانك Master Quality مضلع أبيض", image: "18.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب أبيض أساسي مضلع لا غنى عنه في أي خزانة.", is_new: false }, { id: 19, title: "توب تانك Master Quality أخضر زاهي", image: "19.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب أساسي مريح وعملي بلون أخضر منعش.", is_new: false }, { id: 20, title: "توب تانك Master Quality تركوازي", image: "20.png", price: "4,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "توب أساسي ناعم بلون تركوازي هادئ ومريح.", is_new: false }, { id: 21, title: "توب تانك Master Quality أسود", image: "21.png", price: "4,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "توب أسود أساسي عملي لكل الإطلالات برقبة واسعة قليلاً.", is_new: false }, { id: 22, title: "كاميصول Master Quality تركوازي بحواف دانتيل", image: "22.png", price: "4,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "كاميصول ناعم بلون تركوازي مع لمسة دانتيل أنثوية على الحافة.", is_new: false }, { id: 23, title: "كاميصول Master Quality تركوازي بحواف دانتيل", image: "23.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول ناعم بلون تركوازي مع لمسة دانتيل أنثوية على الحافة.", is_new: false }, { id: 24, title: "توب تانك Master Quality رمادي فاتح ميلانج", image: "24.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "توب أساسي مريح وعملي بلون رمادي فاتح ميلانج.", is_new: false }, { id: 25, title: "كاميصول Master Quality أخضر فاتح بحواف دانتيل", image: "25.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول ناعم بلون أخضر باستيل ولمسة دانتيل رقيقة.", is_new: false }, { id: 26, title: "توب كروب Master Quality أخضر فاتح بملمس مميز", image: "26.png", price: "4,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "توب كروب عصري بملمس مجعد (سموكيد) ورقبة V.", is_new: true }, { id: 27, title: "توب تانك Master Quality مخطط أخضر/أبيض مضلع", image: "27.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "توب مضلع مخطط بقصة مريحة وألوان منعشة.", is_new: false }, { id: 28, title: "كاميصول Master Quality أوف وايت/كريمي", image: "28.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول أساسي ناعم بلون أوف وايت هادئ ومريح.", is_new: false }, { id: 29, title: "توب كروب Master Quality خوخي/مرجاني بملمس مميز", image: "29.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "توب كروب عصري بملمس مجعد (سموكيد) ورقبة V بلون خوخي.", is_new: false }, { id: 30, title: "توب/فيست Master Quality محبوك بنقشة مموجة", image: "30.png", price: "4,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "فيست محبوك بنقشة مموجة جريئة وألوان زاهية (أزرق وأصفر).", is_new: true }, { id: 31, title: "توب تانك Master Quality أخضر ليموني نيون", image: "31.png", price: "4,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "توب رياضي أو كاجوال بلون نيون منعش وقصة مريحة.", is_new: false }, { id: 32, title: "توب كروب Master Quality أخضر بقصة غير متماثلة", image: "32.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب كروب عصري بقصة كتف غير متماثلة وجريئة.", is_new: false }, { id: 33, title: "توب تانك Master Quality مخطط كحلي/أبيض", image: "33.png", price: "4,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب مخطط كلاسيكي بستايل بحري أنيق (كحلي وأبيض).", is_new: false }, { id: 34, title: "توب كروب Master Quality مضلع بيج", image: "34.png", price: "4,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "توب كروب أساسي مضلع بلون بيج محايد وعصري.", is_new: false }, { id: 35, title: "كاميصول Master Quality فوشي بحواف دانتيل", image: "35.png", price: "4,000", size: "2XL", base_size: "2XL", category: "tops", availability: "in stock", description: "كاميصول أنثوي بلون فوشي جذاب ولمسة دانتيل رقيقة.", is_new: false }, { id: 37, title: "توب كروب Master Quality مخطط أخضر فاتح/أبيض مضلع", image: "37.png", price: "4,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "توب كروب مضلع ومخطط بألوان هادئة (أخضر فاتح وأبيض).", is_new: false }, { id: 38, title: "توب كروب Master Quality أسود بكشكشة", image: "38.png", price: "4,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "توب كروب أسود أنيق بتصميم كشكشة أمامي للمناسبات.", is_new: true }, { id: 42, title: "تي شيرت Master Quality أصفر فاتح مطبع", image: "42.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "تي شيرت عصري ومريح بلون أصفر فاتح مع طبعات كتابية، مثالي للإطلالات اليومية.", is_new: true }, { id: 43, title: "بلوزة Master Quality بأكمام طويلة ونقشة بيزلي", image: "43.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة وياقة، تتميز بنقشة بيزلي باللونين الأزرق والأبيض.", is_new: true }, { id: 45, title: "بلوزة Master Quality موردة بأكمام طويلة", image: "45.png", price: "8,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة وياقة V، تتميز بنقشة موردة زاهية وحواف مطاطية.", is_new: true }, { id: 47, title: "بلوزة Master Quality بلون خمري وأكمام طويلة", image: "47.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة ناعمة بلون خمري غني، تتميز بأكمام طويلة مع أساور مطاطية وياقة دائرية.", is_new: true }, { id: 48, title: "تي شيرت Master Quality أبيض بطبعة فلامنجو", image: "48.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "تي شيرت قطني مريح باللون الأبيض مع طبعة فلامنجو وردية مميزة.", is_new: true }, { id: 49, title: "بلوزة Master Quality بأكمام طويلة ونقشة برتقالية وبيج", image: "49.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة وياقة، تتميز بنقشة خطوط مموجة باللونين البرتقالي والبيج.", is_new: true }, { id: 51, title: "بلوزة Master Quality بنقشة حيوانية أبيض وأسود", image: "51.png", price: "8,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "بلوزة عصرية بأكمام متوسطة الطول ونقشة حيوانية جذابة باللونين الأبيض والأسود.", is_new: true }, { id: 53, title: "بلوزة Master Quality بيج بأكمام طويلة ورباط أمامي", image: "53.png", price: "8,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة وياقة، تتميز بتصميم رباط أمامي جذاب ولون بيج محايد.", is_new: true }, { id: 56, title: "طقم Master Quality أبيض بلوزة وبنطلون واسع دانتيل", image: "56.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "طقم أنيق مكون من قطعتين باللون الأبيض، بلوزة بأكمام طويلة وتفاصيل دانتيل (برودي) مع بنطلون بأرجل واسعة بنفس التفاصيل.", is_new: true }, { id: 58, title: "بلوزة Master Quality فوشيا بأكمام طويلة وكسرات", image: "58.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة أنيقة بلون فوشيا زاهي، تتميز بكسرات أمامية وأكمام طويلة وياقة برباط.", is_new: true }, { id: 59, title: "بلوزة Master Quality بيضاء أكتاف مكشوفة وكشكشة", image: "59.png", price: "8,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "بلوزة صيفية أنيقة باللون الأبيض، تتميز بتصميم أكتاف مكشوفة وكشكشة عريضة على الصدر والأكمام.", is_new: true }, { id: 61, title: "بلوزة Master Quality بيضاء دانتيل (برودي) بياقة رباط", image: "61.png", price: "8,000", size: "XXL", base_size: "XXL", category: "tops", availability: "in stock", description: "بلوزة بيضاء أنيقة بأكمام طويلة وتفاصيل دانتيل (برودي) بالكامل، مع ياقة برباط وحافة سفلية مميزة.", is_new: true }, { id: 66, title: "بلوزة Master Quality خضراء بأكمام كشكشة", image: "66.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "بلوزة صيفية بلون أخضر زاهي، تتميز بأكمام قصيرة مزينة بكشكشة وياقة دائرية.", is_new: true }, { id: 67, title: "بلوزة Master Quality ليلكي بأكمام طويلة وكشكشة ياقة", image: "67.png", price: "8,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "بلوزة أنيقة بلون ليلكي فاتح، تتميز بأكمام طويلة وياقة V مزينة بكشكشة.", is_new: true }, { id: 68, title: "بلوزة Master Quality منقطة بياقة عالية وأكمام طويلة", image: "68.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة وياقة عالية مكشكشة، تتميز بنقشة منقطة باللونين البيج والأسود.", is_new: true }, { id: 69, title: "بلوزة Master Quality سوداء بأكمام طويلة وياقة دائرية", image: "69.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة سوداء أساسية بأكمام طويلة وتصميم أكتاف منفوخة قليلاً وياقة دائرية.", is_new: true }, { id: 70, title: "بلوزة Master Quality بيضاء بتطريز أسود وياقة رباط", image: "70.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "بلوزة بيضاء أنيقة بأكمام 3/4، تتميز بتطريز أسود على الصدر والأكمام وياقة V برباط.", is_new: true }, { id: 75, title: "طقم Master Quality أخضر فاتح توب وتنورة دانتيل (برودي)", image: "75.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "طقم صيفي أنيق بلون أخضر فاتح، مكون من توب بأكمام قصيرة وتنورة طويلة متدرجة، كلاهما بتفاصيل دانتيل (برودي).", is_new: true }, { id: 76, title: "تي شيرت Master Quality أبيض بطبعة قطة وزهور", image: "76.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "تي شيرت قطني مريح باللون الأبيض، يتميز بطبعة مرحة لقطة سوداء مع زهور وكتابة \"It's Friday\".", is_new: true }, { id: 78, title: "طقم Master Quality أبيض توب وتنورة دانتيل (برودي)", image: "78.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "طقم صيفي أنيق باللون الأبيض، مكون من توب قصير بأحزمة عريضة وتنورة ميدي، كلاهما بتفاصيل دانتيل (برودي).", is_new: true }, { id: 84, title: "بلوزة Master Quality موردة بأكمام كشكشة", image: "84.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة صيفية أنيقة بنقشة موردة، تتميز بأكمام قصيرة مزينة بكشكشة وياقة دائرية.", is_new: true }, { id: 88, title: "بلوزة Master Quality بيضاء بأكمام منقوشة 3/4", image: "88.png", price: "8,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "بلوزة أنيقة بجسم أبيض وأكمام 3/4 منفوخة بنقشة زهور خضراء وياقة دائرية.", is_new: true }, { id: 91, title: "توب Master Quality تركوازي بياقة V وأكمام قصيرة", image: "91.png", price: "8,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "توب أساسي بلون تركوازي زاهي، يتميز بياقة V وأكمام قصيرة وحافة مموجة.", is_new: true }, { id: 92, title: "بلوزة Master Quality ليلكي بأكمام طويلة وكشكشة جانبية", image: "92.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "بلوزة أنيقة بلون ليلكي فاتح، تتميز بأكمام طويلة وياقة دائرية مع كشكشة تمتد بشكل مائل على الصدر.", is_new: true }, { id: 93, title: "قميص Master Quality ليلكي مقلم بأكمام طويلة", image: "93.png", price: "8,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "قميص كلاسيكي بلون ليلكي فاتح مع خطوط بيضاء رفيعة، يتميز بأكمام طويلة وياقة وأزرار أمامية.", is_new: true }, { id: 94, title: "بلوزة Master Quality تركوازي لف بأكمام طويلة", image: "94.png", price: "8,000", size: "L", base_size: "L", category: "tops", availability: "in stock", description: "بلوزة أنيقة بلون تركوازي لامع، تتميز بتصميم لف وياقة V وأكمام طويلة بأسورة.", is_new: true }, { id: 95, title: "بلوزة Master Quality منقوشة بأكمام طويلة وياقة رباط", image: "95.png", price: "8,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "بلوزة أنيقة بأكمام طويلة، تتميز بنقشة هندسية باللونين الأخضر والأبيض وياقة برباط.", is_new: true }, { id: 98, title: "بلوزة Master Quality منقوشة بأكمام كشكشة", image: "98.png", price: "8,000", size: "S", base_size: "S", category: "tops", availability: "in stock", description: "بلوزة صيفية بنقشة عصرية، تتميز بأكمام قصيرة مزينة بكشكشة وياقة دائرية.", is_new: true }, { id: 100, title: "بلوزة Master Quality بيضاء بكشكشة أمامية وأكمام طويلة", image: "100.png", price: "8,000", size: "XL", base_size: "XL", category: "tops", availability: "in stock", description: "بلوزة بيضاء أنيقة بأكمام طويلة، تتميز بكشكشة متعددة الطبقات تمتد على طول الجزء الأمامي وياقة V.", is_new: true }, { id: 103, title: "قميص/تونيك Master Quality مقلم مع حزام", image: "103.png", price: "8,000", size: "M", base_size: "M", category: "tops", availability: "in stock", description: "قميص أو تونيك طويل بأكمام طويلة وياقة، يتميز بخطوط طولية متعددة الألوان وحزام قماشي لربط الخصر.", is_new: true }, { id: 104, title: "بلوزة Master Quality سوداء بطبعة أوراق شجر بيضاء", image: "104.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "بلوزة سوداء أنيقة بأكمام 3/4 وياقة دائرية، تتميز بطبعة أوراق شجر بيضاء.", is_new: true }, { id: 166, title: "بلوزة Master Quality سوداء بطبعة أوراق شجر بيضاء مكرر", image: "166.png", price: "8,000", size: "XS", base_size: "XS", category: "tops", availability: "in stock", description: "بلوزة سوداء أنيقة بأكمام 3/4 وياقة دائرية، تتميز بطبعة أوراق شجر بيضاء.", is_new: true },
        { id: 116, title: "فستان Master Quality مورد أزرق وأخضر", image: "116.png", price: "12,000", size: "M", base_size: "M", category: "dresses", availability: "in stock", description: "فستان صيفي ميدي بنقشة موردة زاهية، يتميز بياقة V وأكمام قصيرة مكشكشة وحافة متدرجة.", is_new: true }, { id: 117, title: "فستان Master Quality أخضر وأبيض منقوش بحزام", image: "117.png", price: "12,000", size: "XXL", base_size: "XXL", category: "dresses", availability: "in stock", description: "فستان ميدي بنقشة عصرية باللونين الأخضر والأبيض، يتميز بأكمام طويلة وياقة V وحزام قماشي و حافة متدرجة.", is_new: true }, { id: 118, title: "فستان Master Quality خمري شيفون بأكمام طويلة", image: "118.png", price: "12,000", size: "S", base_size: "S", category: "dresses", availability: "in stock", description: "فستان ميدي بلون خمري غني من قماش شيفون، يتميز بأكمام طويلة وياقة عالية مكشكشة وحافة متدرجة.", is_new: true }, { id: 119, title: "فستان Master Quality أخضر سادة بأكمام قصيرة", image: "119.png", price: "12,000", size: "L", base_size: "L", category: "dresses", availability: "in stock", description: "فستان ميدي كاجوال بلون أخضر سادة، يتميز بأكمام قصيرة وياقة دائرية وخصر مرتفع.", is_new: true }, { id: 121, title: "فستان ماكسي Master Quality أزرق بنقشة بيزلي", image: "121.png", price: "12,000", size: "XS", base_size: "XS", category: "dresses", availability: "in stock", description: "فستان ماكسي فضفاض ومريح بنقشة بيزلي زاهية، يتميز بأكمام قصيرة وياقة V.", is_new: true }, { id: 1211, title: "فستان ماكسي Master Quality أزرق بنقشة بيزلي مكرر", image: "121s.png", price: "12,000", size: "S", base_size: "S", category: "dresses", availability: "in stock", description: "فستان ماكسي فضفاض ومريح بنقشة بيزلي زاهية، يتميز بأكمام قصيرة وياقة V.", is_new: true }, { id: 122, title: "فستان Master Quality كاروهات بخصر مزموم", image: "122.png", price: "12,000", size: "XL", base_size: "XL", category: "dresses", availability: "in stock", description: "فستان قصير بأكمام طويلة وقماش كاروهات، يتميز بخصر مزموم (مطاط) وياقة دائرية مع فتحة صغيرة.", is_new: true }, { id: 124, title: "فستان Master Quality خمري بأكمام طويلة وكشكشة ياقة", image: "124.png", price: "12,000", size: "M", base_size: "M", category: "dresses", availability: "in stock", description: "فستان ميدي بلون خمري غني، يتميز بأكمام طويلة وياقة V مزينة بكشكشة وخصر مطاطي.", is_new: true }, { id: 127, title: "فستان حوامل Master Quality أخضر مورد بخصر مزموم", image: "127.png", price: "12,000", size: "M", base_size: "M", category: "dresses", availability: "in stock", description: "فستان حوامل ميدي بنقشة موردة، يتميز بأكمام طويلة وياقة قميص وخصر مزموم (مطاط).", is_new: true }, { id: 128, title: "فستان Master Quality أخضر فاتح محكم بحزام", image: "128.png", price: "12,000", size: "XXL", base_size: "XXL", category: "dresses", availability: "in stock", description: "فستان ميدي بلون أخضر فاتح وقماش محكم، يتميز بأكمام قصيرة مكشكشة وياقة V وحزام قماشي.", is_new: true }, { id: 143, title: "فستان Master Quality وردي سادة بياقة V", image: "143.png", price: "12,000", size: "XS", base_size: "XS", category: "dresses", availability: "in stock", description: "فستان ميدي كاجوال بلون وردي، يتميز بأكمام قصيرة وياقة V وفتحة صغيرة بأزرار.", is_new: true }, { id: 146, title: "فستان ماكسي Master Quality ليلكي أكتاف مكشوفة", image: "146.png", price: "12,000", size: "XL", base_size: "XL", category: "dresses", availability: "in stock", description: "فستان ماكسي بلون ليلكي فاتح وتصميم أكتاف مكشوفة، يتميز بأكمام 3/4 وياقة مكشكشة.", is_new: true }, { id: 151, title: "فستان ماكسي Master Quality تركوازي بليسيه بياقة هالتر", image: "151.png", price: "12,000", size: "M", base_size: "M", category: "dresses", availability: "in stock", description: "فستان ماكسي أنيق بلون تركوازي وقماش بليسيه، يتميز بياقة هالتر وحزام خصر معدني.", is_new: true }, { id: 155, title: "فستان Master Quality منقوش أزرق وأخضر بحزام", image: "155.png", price: "12,000", size: "S", base_size: "S", category: "dresses", availability: "in stock", description: "فستان ميدي بنقشة عصرية باللونين الأزرق والأخضر، يتميز بأكمام 3/4 واسعة وياقة V وحزام قماشي.", is_new: true },
    ];

    // --- DOM Elements (Checked, Added Return Policy) ---
    const htmlElement = document.documentElement;
    const header = document.getElementById('main-header');
    const mainNavLinks = document.querySelectorAll('#main-nav a.nav-link');
    const mobileNavToggle = document.getElementById('mobile-nav-toggle');
    const mobileNavMenu = document.getElementById('mobile-nav-menu');
    const mobileNavMenuLinks = mobileNavMenu?.querySelectorAll('a.nav-link');
    const productGrid = document.getElementById('product-grid-main');
    const categoryHeader = document.getElementById('category-header');
    const categoryTitleMain = document.getElementById('category-title-main');
    const categoryDescription = document.getElementById('category-description');
    const clearFiltersBtn = document.getElementById('clear-filters-btn');
    const noResultsDiv = document.getElementById('no-results');
    const loadMoreButton = document.getElementById('load-more-button');
    const newArrivalsWrapper = document.getElementById('new-arrivals-wrapper');
    const searchFilterToggleBtn = document.getElementById('search-filter-toggle-btn');
    const themeToggleButton = document.getElementById('theme-toggle-button');
    const cartButton = document.getElementById('cart-button');
    const cartCountSpan = document.getElementById('cart-count');
    const searchFilterOverlay = document.getElementById('search-filter-overlay');
    const overlayContent = searchFilterOverlay?.querySelector('.overlay-content');
    const closeSearchFilterOverlayBtn = document.getElementById('close-search-filter-overlay');
    const overlaySearchInput = document.getElementById('overlay-search-input');
    const overlaySizeSelect = document.getElementById('overlay-size-select');
    const applyOverlayFiltersBtn = document.getElementById('apply-overlay-filters');
    const clearOverlayFiltersBtn = document.getElementById('clear-overlay-filters-btn');
    const productDetailPanel = document.getElementById('product-detail-panel');
    const productDetailContent = document.getElementById('product-detail-content');
    const closeDetailPanelBtn = document.getElementById('close-detail-panel-btn');
    const productDetailBackdrop = document.getElementById('product-detail-backdrop');
    const orderFormModalOverlay = document.getElementById('order-form-modal');
    const orderFormModalContent = orderFormModalOverlay?.querySelector('.modal-content');
    const orderFormModalCloseButton = document.getElementById('modal-close-button-order');
    const cartModalOverlay = document.getElementById('cart-modal');
    const cartModalContent = cartModalOverlay?.querySelector('.modal-content');
    const cartModalCloseButton = document.getElementById('modal-close-button-cart');
    const cartItemsContainer = document.getElementById('cart-items-container');
    const cartEmptyMessage = document.getElementById('cart-empty-message');
    const cartOrderAllBtn = document.getElementById('cart-order-all-btn');
    const orderForm = document.getElementById('order-form');
    const formErrorMessage = document.getElementById('form-error-message');
    const orderSummaryMainTitle = document.getElementById('order-summary-main-title');
    const orderSummarySingleItemDetails = document.getElementById('order-summary-single-item-details');
    const orderSummaryItemsList = document.getElementById('order-summary-items-list');
    const orderSummaryTitle = document.getElementById('order-summary-title');
    const orderSummarySize = document.getElementById('order-summary-size');
    const orderSummaryPrice = document.getElementById('order-summary-price');
    const orderFormProductId = document.getElementById('order-form-product-id');
    const orderFormProductTitle = document.getElementById('order-form-product-title');
    const orderFormProductSize = document.getElementById('order-form-product-size');
    const orderFormProductPrice = document.getElementById('order-form-product-price');
    const scrollToTopBtn = document.getElementById('scroll-to-top-btn');
    const privacyPolicyLink = document.getElementById('privacy-policy-link');
    const privacyPolicyModalOverlay = document.getElementById('privacy-policy-modal');
    const privacyPolicyModalContent = privacyPolicyModalOverlay?.querySelector('.modal-content');
    const privacyPolicyModalCloseButton = document.getElementById('modal-close-button-privacy');
    const privacyModalCloseBtnBottom = document.getElementById('privacy-modal-close-btn-bottom');
    const startShoppingBtnCart = document.getElementById('start-shopping-btn-cart');
    // New Return Policy Elements
    const returnPolicyLink = document.getElementById('return-policy-link');
    const returnPolicyModalOverlay = document.getElementById('return-policy-modal');
    const returnPolicyModalContent = returnPolicyModalOverlay?.querySelector('.modal-content');
    const returnPolicyModalCloseButton = document.getElementById('modal-close-button-return');
    const returnModalCloseBtnBottom = document.getElementById('return-modal-close-btn-bottom');


    // --- State & Constants (Checked) ---
    const whatsappNumber = '9647778076465'; let currentProductIdForDetail = null; let activeCategory = 'all'; let cart = JSON.parse(localStorage.getItem('mqCart_v4')) || []; let cartItemsForOrder = []; let displayedProductCount = 0; const productsPerLoad = 12; let currentFilteredProducts = []; let currentSearchTerm = ''; let currentSizeFilter = 'all'; let isMobileMenuOpen = false; let activeModalOverlay = null; let isPanelOpening = false; let swiperInstance = null; const categoryDescriptions = { all: "تصفحي جميع منتجاتنا المختارة بعناية فائقة.", trousers: "تشكيلة واسعة من البناطيل المريحة والأنيقة لجميع إطلالاتك.", dresses: "فساتين أنيقة وعصرية لمختلف المناسبات، من الكاجوال إلى السهرة.", maternity: "ملابس حوامل مصممة لتوفير الراحة والأناقة خلال فترة الحمل.", tops: "مجموعة متنوعة من التوبات والبلوزات والقمصان العصرية والكلاسيكية.", };

    // --- Utility Functions (Checked) ---
    const debounce = (func, wait) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), wait); }; }; const formatPrice = (priceString) => { try { return parseInt(priceString.replace(/,/g, ''), 10).toLocaleString('ar-IQ'); } catch { return priceString; } };

    // --- Cart Management (Checked) ---
    const updateCartCount = () => { if (!cartCountSpan || !cartButton) return; const count = cart.length; cartCountSpan.textContent = count; cartCountSpan.classList.toggle('visually-hidden', count === 0); cartCountSpan.classList.toggle('scale-100', count > 0); cartCountSpan.classList.toggle('scale-0', count === 0); cartButton.classList.toggle('has-items', count > 0); }; const isInCart = (productId) => cart.includes(Number(productId));
    const updateCartButtonIcon = (btn, isNowInCart) => { if (!btn) return; const icon = btn.querySelector('i'); if (icon) { const baseClass = btn.classList.contains('btn-icon') ? 'text-base' : 'text-lg'; const currentAnimation = icon.classList.contains('animate-ping') ? ' animate-ping' : ''; icon.className = `${baseClass} ${isNowInCart ? 'fas fa-check text-success' : 'fas fa-cart-plus'} ${currentAnimation}`; icon.classList.add('transform', 'scale-125', 'transition-transform', 'duration-200'); setTimeout(() => icon.classList.remove('scale-125'), 200); } btn.classList.toggle('is-in-cart', isNowInCart); const ariaLabel = isNowInCart ? 'إزالة من السلة' : 'إضافة للسلة'; btn.setAttribute('aria-label', ariaLabel); if (btn.title) btn.title = ariaLabel; if (btn.id === 'detail-panel-cart-btn') { const textSpan = btn.querySelector('.button-text'); if (textSpan) textSpan.textContent = isNowInCart ? 'تمت الإضافة (إزالة؟)' : 'إضافة للسلة'; btn.classList.toggle('btn-success', isNowInCart); btn.classList.toggle('btn-secondary', !isNowInCart); if (isNowInCart) { btn.classList.add('text-white'); btn.classList.remove('text-light-text-secondary', 'dark:text-dark-text-secondary'); } else { btn.classList.remove('text-white'); btn.classList.add('text-light-text-secondary', 'dark:text-dark-text-secondary'); } } };
    const toggleCart = (productId) => { const numProductId = Number(productId); const index = cart.indexOf(numProductId); const wasInCart = index > -1; const isNowInCart = !wasInCart; if (wasInCart) { cart.splice(index, 1); } else { cart.push(numProductId); } localStorage.setItem('mqCart_v4', JSON.stringify(cart)); updateCartCount(); document.querySelectorAll(`.cart-btn[data-id="${numProductId}"], .cart-remove-btn[data-id="${numProductId}"]`).forEach(btn => { if (btn.classList.contains('cart-remove-btn')) { if (!isNowInCart) { const cartItemDiv = btn.closest('.cart-item'); if (cartItemDiv) { cartItemDiv.style.transition = 'opacity 0.3s ease, transform 0.3s ease, max-height 0.3s ease, padding 0.3s ease, margin 0.3s ease, border 0.3s ease'; cartItemDiv.style.opacity = '0'; cartItemDiv.style.transform = 'translateX(20px) scale(0.95)'; cartItemDiv.style.maxHeight = '0px'; cartItemDiv.style.paddingTop = '0px'; cartItemDiv.style.paddingBottom = '0px'; cartItemDiv.style.marginTop = '0px'; cartItemDiv.style.marginBottom = '0px'; cartItemDiv.style.borderWidth = '0px'; setTimeout(() => renderCartItems(), 350); } else { renderCartItems(); } } } else { updateCartButtonIcon(btn, isNowInCart); } }); if (cartModalOverlay?.style.display === 'flex' && isNowInCart) { renderCartItems(); } };

    // --- Theme Toggle (Checked) ---
    const applyTheme = (theme) => { if (!htmlElement || !themeToggleButton) return; const icon = themeToggleButton.querySelector('i'); if (theme === 'dark') { htmlElement.classList.add('dark'); if (icon) icon.className = 'fas fa-moon text-lg'; localStorage.setItem('mqTheme_v2', 'dark'); } else { htmlElement.classList.remove('dark'); if (icon) icon.className = 'fas fa-sun text-lg'; localStorage.setItem('mqTheme_v2', 'light'); } document.querySelectorAll('img[src^="https://placehold.co"]').forEach(img => { const currentSrc = img.getAttribute('src'); if (currentSrc) { let newSrc = currentSrc; if (theme === 'dark') { newSrc = newSrc.replace('/F8FAFC/', '/0F172A/').replace('/6B7280', '/9CA3AF').replace('/E5E7EB/', '/374151/'); } else { newSrc = newSrc.replace('/0F172A/', '/F8FAFC/').replace('/9CA3AF', '/6B7280').replace('/374151/', '/E5E7EB/'); } if (newSrc !== currentSrc) { img.setAttribute('src', newSrc); } } }); }; const toggleTheme = () => { const currentTheme = htmlElement.classList.contains('dark') ? 'dark' : 'light'; applyTheme(currentTheme === 'dark' ? 'light' : 'dark'); };

    // --- Create Product Card (Checked) ---
    const createProductCard = (product, isCarousel = false) => { const cardWrapper = document.createElement('div'); cardWrapper.className = `product-card group flex flex-col bg-light-surface dark:bg-dark-surface rounded-xl overflow-hidden shadow-card dark:shadow-card-dark border border-light-border/30 dark:border-dark-border/30 transition-all duration-350 ease-gentle hover:transform hover:-translate-y-1.5 hover:shadow-card-hover dark:hover:shadow-card-hover-dark hover:border-primary/40 dark:hover:border-primary-light/40 ${isCarousel ? 'swiper-product-card' : ''}`; cardWrapper.dataset.id = product.id; cardWrapper.dataset.category = product.category; cardWrapper.dataset.base_size = product.base_size; cardWrapper.dataset.title = product.title.toLowerCase(); if (!isCarousel) { cardWrapper.classList.add('opacity-0', 'section-animate'); } else { cardWrapper.style.maxWidth = '260px'; } const imageContainer = document.createElement('div'); imageContainer.className = 'relative aspect-square overflow-hidden bg-gray-100 dark:bg-gray-700'; const img = document.createElement('img'); img.src = product.image; img.alt = product.title; img.loading = 'lazy'; img.className = 'product-card-img w-full h-full object-contain transition-transform duration-slow ease-gentle group-hover:scale-[1.08]'; img.onerror = () => { const bgColor = htmlElement.classList.contains('dark') ? '1E293B' : 'F8FAFC'; const textColor = htmlElement.classList.contains('dark') ? '6B7280' : '9CA3AF'; img.src = `https://placehold.co/400x400/${bgColor}/${textColor}?text=لا+توجد+صورة&font=cairo`; img.classList.add('opacity-70'); img.onerror = null; }; imageContainer.appendChild(img); const badgesContainer = document.createElement('div'); badgesContainer.className = 'absolute top-3 left-3 flex flex-col gap-1.5 z-10 pointer-events-none'; if (product.availability === 'in stock') { badgesContainer.innerHTML += `<span class="badge text-xs font-medium px-2.5 py-1 rounded-full bg-success text-success-text shadow-sm border border-white/20">متوفر</span>`; } else { badgesContainer.innerHTML += `<span class="badge text-xs font-medium px-2.5 py-1 rounded-full bg-error text-error-text shadow-sm border border-white/20">غير متوفر</span>`; } if (product.is_new) { badgesContainer.innerHTML += `<span class="badge text-xs font-medium px-2.5 py-1 rounded-full bg-info text-info-text shadow-sm border border-white/20">جديد 🔥</span>`; } imageContainer.appendChild(badgesContainer); const hoverActionsContainer = document.createElement('div'); hoverActionsContainer.className = 'product-card-actions absolute top-3 right-3 z-20 flex flex-col gap-2.5'; const isCurrentlyInCart = isInCart(product.id); hoverActionsContainer.innerHTML = `<button class="cart-btn btn-icon w-9 h-9" data-id="${product.id}" aria-label="${isCurrentlyInCart ? 'إزالة من السلة' : 'إضافة للسلة'}"><i class="text-base ${isCurrentlyInCart ? 'fas fa-check text-success' : 'fas fa-cart-plus'}"></i></button><button class="view-details-btn btn-icon w-9 h-9" data-id="${product.id}" aria-label="عرض التفاصيل"><i class="fas fa-eye text-base"></i></button>`; imageContainer.appendChild(hoverActionsContainer); const infoContainer = document.createElement('div'); infoContainer.className = 'p-4 pt-3 text-center border-t border-light-border/50 dark:border-dark-border/50 flex-grow flex flex-col justify-between'; const titleEl = document.createElement('h3'); titleEl.className = 'text-base font-semibold text-light-text-primary dark:text-dark-text-primary mb-1.5 line-clamp-2 h-[3em]'; titleEl.textContent = product.title; const priceEl = document.createElement('p'); priceEl.className = 'text-lg font-bold text-primary dark:text-primary-light mt-auto'; priceEl.innerHTML = `${formatPrice(product.price)} <span class="text-sm font-normal text-light-text-muted dark:text-dark-text-muted">د.ع</span>`; infoContainer.appendChild(titleEl); infoContainer.appendChild(priceEl); const cartBtn = hoverActionsContainer.querySelector('.cart-btn'); const detailsBtn = hoverActionsContainer.querySelector('.view-details-btn'); cartBtn.onclick = (e) => { e.stopPropagation(); toggleCart(product.id); }; detailsBtn.onclick = (e) => { e.stopPropagation(); openDetailPanel(product.id); }; cardWrapper.onclick = (e) => { if (!e.target.closest('button')) { openDetailPanel(product.id); } }; cardWrapper.appendChild(imageContainer); cardWrapper.appendChild(infoContainer); if (isCarousel) { const slide = document.createElement('div'); slide.className = 'swiper-slide'; slide.appendChild(cardWrapper); return slide; } else { return cardWrapper; } };

    // --- Modal & Panel Management (Checked) ---
    const openModal = (modalOverlay) => { if (!modalOverlay || activeModalOverlay === modalOverlay) return; if (activeModalOverlay) closeModal(true); activeModalOverlay = modalOverlay; modalOverlay.style.display = 'flex'; modalOverlay.classList.remove('animate-out'); modalOverlay.classList.add('animate-in'); const content = modalOverlay.querySelector('.modal-content'); if(content) { content.classList.remove('animate-out'); content.classList.add('animate-in'); } document.body.style.overflow = 'hidden'; modalOverlay.dispatchEvent(new CustomEvent('modalOpened')); };
    const closeModal = (instant = false) => { if (!activeModalOverlay) return; const overlayToClose = activeModalOverlay; activeModalOverlay = null; const duration = instant ? 0 : 300; overlayToClose.classList.remove('animate-in'); overlayToClose.classList.add('animate-out'); overlayToClose.style.animationDuration = `${duration}ms`; const content = overlayToClose.querySelector('.modal-content'); if (content) { content.classList.remove('animate-in'); content.classList.add('animate-out'); content.style.animationDuration = `${duration}ms`; } setTimeout(() => { overlayToClose.style.display = 'none'; overlayToClose.classList.remove('animate-out'); overlayToClose.style.animationDuration = ''; if (content) { content.classList.remove('animate-out'); content.style.animationDuration = ''; } if (!activeModalOverlay && (!productDetailPanel || productDetailPanel.classList.contains('hidden'))) { document.body.style.overflow = ''; } overlayToClose.dispatchEvent(new CustomEvent('modalClosed')); }, duration); };
    const openSearchFilterOverlay = () => { if (!searchFilterOverlay || !overlayContent) return; if (activeModalOverlay) closeModal(true); activeModalOverlay = searchFilterOverlay; searchFilterOverlay.style.display = 'flex'; searchFilterOverlay.classList.remove('animate-out'); searchFilterOverlay.classList.add('animate-in'); overlayContent.classList.remove('animate-out'); overlayContent.classList.add('animate-in'); document.body.style.overflow = 'hidden'; overlaySearchInput?.focus(); };
    const closeSearchFilterOverlay = () => { if (!searchFilterOverlay || !overlayContent || activeModalOverlay !== searchFilterOverlay) return; const overlayToClose = searchFilterOverlay; activeModalOverlay = null; overlayToClose.classList.remove('animate-in'); overlayToClose.classList.add('animate-out'); overlayContent.classList.remove('animate-in'); overlayContent.classList.add('animate-out'); setTimeout(() => { overlayToClose.style.display = 'none'; overlayToClose.classList.remove('animate-out'); overlayContent.classList.remove('animate-out'); if (!activeModalOverlay && (!productDetailPanel || productDetailPanel.classList.contains('hidden'))) { document.body.style.overflow = ''; } }, 300); };

    // --- Product Detail Panel (Checked) ---
    const openDetailPanel = (productId) => { const product = products.find(p => p.id === Number(productId)); if (!product || !productDetailPanel || !productDetailContent || !productDetailBackdrop || isPanelOpening) return; isPanelOpening = true; currentProductIdForDetail = productId; const isCurrentlyInCart = isInCart(productId); const availabilityText = product.availability === 'in stock' ? "متوفر حالياً" : "غير متوفر حالياً"; const availabilityClass = product.availability === 'in stock' ? 'text-success dark:text-success-light' : 'text-error dark:text-error-light'; const availabilityIcon = product.availability === 'in stock' ? 'fa-check-circle' : 'fa-times-circle'; productDetailContent.innerHTML = `<div class="aspect-[4/3] bg-light-surface dark:bg-dark-background rounded-lg overflow-hidden border border-light-border dark:border-dark-border mb-6 shadow-md dark:shadow-md-dark"><img id="detail-panel-image" src="${product.image}" alt="${product.title}" class="w-full h-full object-contain p-2" onerror="this.src='https://placehold.co/600x450/${htmlElement.classList.contains('dark')?'1E293B':'F8FAFC'}/${htmlElement.classList.contains('dark')?'6B7280':'9CA3AF'}?text=Image+Error&font=cairo'; this.onerror=null;"></div> <h2 id="detail-panel-title" class="text-3xl md:text-4xl font-bold font-heading text-light-text-primary dark:text-dark-text-primary">${product.title}</h2> <div class="space-y-3 text-base py-5 border-b border-light-border dark:border-dark-border"><div class="flex justify-between items-center"><span class="text-light-text-secondary dark:text-dark-text-secondary flex items-center gap-2"><i class="fas fa-ruler-combined text-base text-accent"></i>المقاس:</span><span id="detail-panel-size" class="font-semibold text-light-text-primary dark:text-dark-text-primary bg-light-surface dark:bg-dark-surface px-3 py-1 rounded-md text-base border border-light-border dark:border-dark-border shadow-sm">${product.size}</span></div><div class="flex justify-between items-center"><span class="text-light-text-secondary dark:text-dark-text-secondary flex items-center gap-2"><i class="fas fa-tag text-base text-accent"></i>السعر:</span><div><span id="detail-panel-price" class="text-2xl md:text-3xl font-bold text-primary dark:text-primary-light">${formatPrice(product.price)}</span><span class="text-sm text-light-text-muted dark:text-dark-text-muted mr-1"> د.ع</span></div></div><div class="flex justify-between items-center" id="detail-panel-availability-info"><span class="text-light-text-secondary dark:text-dark-text-secondary flex items-center gap-2"><i class="fas fa-box-open text-base text-accent"></i>التوفر:</span><span id="detail-panel-availability" class="font-semibold ${availabilityClass} text-base flex items-center gap-1.5"><i class="fas ${availabilityIcon} text-sm"></i>${availabilityText}</span></div></div> <div><h3 class="text-xl font-semibold font-heading text-light-text-primary dark:text-dark-text-primary mt-5 mb-3">الوصف التفصيلي</h3><p id="detail-panel-description" class="text-base text-light-text-secondary dark:text-dark-text-secondary leading-relaxed">${product.description || "لا يوجد وصف متوفر حالياً لهذا المنتج."}</p></div> <div class="space-y-3 pt-7 mt-7 border-t border-light-border dark:border-dark-border"><button id="detail-panel-order-btn" data-id="${product.id}" class="btn btn-primary w-full py-4 text-lg ${product.availability !== 'in stock' ? 'opacity-50 cursor-not-allowed disabled' : ''}" ${product.availability !== 'in stock' ? 'disabled' : ''}><i class="fas fa-truck text-lg mr-2"></i> ${product.availability === 'in stock' ? 'اطلب هذا المنتج الآن':'غير متوفر حالياً للطلب'}</button><button id="detail-panel-cart-btn" data-id="${product.id}" class="cart-btn w-full py-3.5 text-base ${isCurrentlyInCart ? 'btn btn-success is-in-cart':'btn btn-secondary'}"><i class="text-lg ${isCurrentlyInCart ? 'fas fa-check-circle':'fas fa-cart-plus'}"></i><span class="button-text mr-2">${isCurrentlyInCart ? 'تمت الإضافة (إزالة؟)':'إضافة للسلة'}</span></button></div>`; const orderBtn = productDetailContent.querySelector('#detail-panel-order-btn'); const cartBtn = productDetailContent.querySelector('#detail-panel-cart-btn'); if (orderBtn && product.availability === 'in stock') { orderBtn.addEventListener('click', (e) => openOrderModal(e.currentTarget.dataset.id)); } if (cartBtn) { cartBtn.addEventListener('click', () => toggleCart(productId)); } productDetailPanel.classList.remove('hidden', 'animate-out'); productDetailPanel.classList.add('animate-in'); productDetailBackdrop.style.display = 'block'; productDetailBackdrop.classList.remove('hidden', 'animate-out', 'opacity-0'); productDetailBackdrop.classList.add('animate-in', 'opacity-100'); document.body.style.overflow = 'hidden'; productDetailPanel.scrollTop = 0; setTimeout(() => { isPanelOpening = false; }, 400); };
    const closeDetailPanel = () => { if (!productDetailPanel || !productDetailBackdrop || productDetailPanel.classList.contains('hidden') || isPanelOpening) return; productDetailPanel.classList.remove('animate-in'); productDetailPanel.classList.add('animate-out'); productDetailBackdrop.classList.remove('animate-in'); productDetailBackdrop.classList.add('animate-out'); const duration = 300; setTimeout(() => { productDetailPanel.classList.add('hidden'); productDetailPanel.classList.remove('animate-out'); productDetailBackdrop.style.display = 'none'; productDetailBackdrop.classList.remove('animate-out'); productDetailBackdrop.classList.add('opacity-0'); currentProductIdForDetail = null; if (!activeModalOverlay) { document.body.style.overflow = ''; } }, duration); };

    // --- Order Modal (Checked) ---
    const openOrderModal = (productId = null) => { if (currentProductIdForDetail !== null) { closeDetailPanel(); } closeModal(true); let orderTotal = 0; const currency = "د.ع"; if (productId) { const product = products.find(p => p.id === Number(productId)); if (!product || !orderSummaryTitle || !orderSummarySize || !orderSummaryPrice || !orderFormProductId || !orderFormProductTitle || !orderFormProductSize || !orderFormProductPrice || !orderSummarySingleItemDetails || !orderSummaryItemsList || !orderSummaryMainTitle) return; orderSummarySingleItemDetails.classList.remove('hidden'); orderSummaryItemsList.classList.add('hidden'); orderSummaryMainTitle.innerHTML = `<i class="fas fa-receipt text-lg"></i> ملخص الطلب لمنتج واحد`; orderSummaryTitle.textContent = product.title; orderSummarySize.textContent = product.size; orderSummaryPrice.textContent = formatPrice(product.price); orderFormProductId.value = product.id; orderFormProductTitle.value = product.title; orderFormProductSize.value = product.size; orderFormProductPrice.value = product.price; cartItemsForOrder = []; try { orderTotal = parseInt(product.price.replace(/,/g, ''), 10); } catch { orderTotal = 0; } } else { if (!orderSummaryItemsList || !orderSummarySingleItemDetails || !orderSummaryMainTitle || !orderSummaryItemsList) return; orderSummarySingleItemDetails.classList.add('hidden'); orderSummaryItemsList.classList.remove('hidden'); orderSummaryItemsList.innerHTML = ''; if (cartItemsForOrder.length === 0) { orderSummaryItemsList.innerHTML = '<li class="text-center text-light-text-muted dark:text-dark-text-muted py-4">لا توجد منتجات متاحة للطلب في سلة التسوق.</li>'; orderTotal = 0; } else { let listHtml = ''; orderTotal = cartItemsForOrder.reduce((sum, item) => { const itemPrice = parseInt(item.price.replace(/,/g, ''), 10) || 0; listHtml += `<li class="flex justify-between items-start text-base border-b border-light-border/50 dark:border-dark-border/50 pb-3 last:border-b-0"><span class="flex-1 mr-3 leading-tight">${item.title} <span class="block text-sm text-light-text-muted dark:text-dark-text-muted">(${item.size})</span></span> <span class="font-semibold text-primary dark:text-primary-light whitespace-nowrap">${formatPrice(item.price)} ${currency}</span></li>`; return sum + itemPrice; }, 0); orderSummaryItemsList.innerHTML = listHtml; } const totalLi = document.createElement('li'); totalLi.className = 'flex justify-between items-center pt-3 mt-3 border-t border-primary/20 dark:border-primary-light/20 font-bold text-lg'; totalLi.innerHTML = `<span>الإجمالي:</span> <span class="text-primary dark:text-primary-light">${orderTotal.toLocaleString('ar-IQ')} ${currency}</span>`; if(orderTotal > 0) orderSummaryItemsList.appendChild(totalLi); orderSummaryMainTitle.innerHTML = `<i class="fas fa-receipt text-lg"></i> ملخص طلب (${cartItemsForOrder.length} منتجات)`; orderFormProductId.value = ''; orderFormProductTitle.value = ''; orderFormProductSize.value = ''; orderFormProductPrice.value = ''; } orderForm?.reset(); formErrorMessage?.classList.add('hidden'); orderForm?.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid')); openModal(orderFormModalOverlay); };
    const closeOrderModal = () => closeModal();
    const prepareOrderForAllCartItems = () => { cartItemsForOrder = cart.map(id => products.find(p => p.id === id)).filter(p => p && p.availability === 'in stock'); if (cartItemsForOrder.length === 0) { alert("عفواً، لا توجد منتجات متاحة حالياً للطلب في سلة التسوق."); return; } if (cartModalOverlay?.style.display === 'flex') { closeCartModal(); } openOrderModal(null); };

    // --- Cart Modal (Checked) ---
    const openCartModal = () => { renderCartItems(); openModal(cartModalOverlay); }; const closeCartModal = () => closeModal();
    const renderCartItems = () => { if (!cartItemsContainer || !cartEmptyMessage || !cartOrderAllBtn) return; const fragment = document.createDocumentFragment(); const cartProducts = cart.map(id => products.find(p => p.id === id)).filter(p => p); let availableItemsCount = 0; if (cartProducts.length === 0) { cartItemsContainer.innerHTML = ''; cartEmptyMessage.classList.remove('hidden'); cartOrderAllBtn.disabled = true; } else { cartEmptyMessage.classList.add('hidden'); cartProducts.forEach(product => { if (product.availability === 'in stock') availableItemsCount++; const itemElement = document.createElement('div'); itemElement.className = `cart-item flex items-center gap-5 p-4 bg-light-surface dark:bg-dark-background rounded-lg border border-light-border dark:border-dark-border shadow-sm dark:shadow-sm-dark transition-all duration-300 ease-in-out ${product.availability !== 'in stock' ? 'opacity-60 grayscale hover:opacity-70' : 'hover:shadow-md'}`; itemElement.innerHTML = `<img src="${product.image}" alt="${product.title}" class="w-20 h-24 object-contain rounded-md flex-shrink-0 bg-white p-1 border border-light-border/50 dark:border-dark-border/50" onerror="this.src='https://placehold.co/80x96/F8FAFC/6B7280?text=Img&font=cairo'; this.onerror=null;"> <div class="flex-grow text-base overflow-hidden"><p class="font-semibold text-light-text-primary dark:text-dark-text-primary truncate mb-1.5 text-lg">${product.title}</p><p class="text-sm text-light-text-secondary dark:text-dark-text-secondary mb-2">المقاس: <span class="font-medium">${product.size}</span></p><p class="text-xl font-bold text-primary dark:text-primary-light">${formatPrice(product.price)} <span class="text-xs font-normal">د.ع</span></p> ${product.availability !== 'in stock' ? '<p class="text-xs text-error mt-1 font-medium">(غير متوفر حالياً)</p>' : ''}</div> <div class="flex flex-col items-center gap-3 flex-shrink-0"><button class="cart-remove-btn btn-icon bg-error/10 text-error hover:bg-error hover:text-white w-9 h-9 shadow-none hover:shadow-md" data-id="${product.id}" title="إزالة من السلة"><i class="fas fa-trash-alt text-sm"></i></button><button class="cart-order-single-btn btn-icon bg-primary/10 text-primary dark:text-primary-light hover:bg-primary hover:text-white w-9 h-9 shadow-none hover:shadow-md ${product.availability !== 'in stock' ? 'opacity-50 cursor-not-allowed disabled' : ''}" data-id="${product.id}" title="طلب هذا المنتج فقط" ${product.availability !== 'in stock' ? 'disabled' : ''}><i class="fas fa-truck text-sm"></i></button></div>`; const removeBtn = itemElement.querySelector('.cart-remove-btn'); const orderSingleBtn = itemElement.querySelector('.cart-order-single-btn'); if (removeBtn) { removeBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleCart(product.id); }); } if (orderSingleBtn && product.availability === 'in stock') { orderSingleBtn.addEventListener('click', (e) => { e.stopPropagation(); closeCartModal(); openOrderModal(product.id); }); } fragment.appendChild(itemElement); }); cartItemsContainer.innerHTML = ''; cartItemsContainer.appendChild(fragment); cartOrderAllBtn.disabled = availableItemsCount === 0; } };

    // --- Policy Modals (Added Return Policy) ---
    const openPrivacyPolicyModal = () => { openModal(privacyPolicyModalOverlay); };
    const closePrivacyPolicyModal = () => { closeModal(); }; // closeModal() works as it clears activeModalOverlay

    const openReturnPolicyModal = () => { openModal(returnPolicyModalOverlay); };
    const closeReturnPolicyModal = () => { closeModal(); }; // closeModal() works as it clears activeModalOverlay


    // --- Filter and Display Products (Checked) ---
    const applyFilters = (scrollToProducts = false, instant = false) => { if (!productGrid || !loadMoreButton || !categoryTitleMain || !categoryDescription || !noResultsDiv || !clearFiltersBtn) return; let filtered = activeCategory === 'all' ? [...products] : products.filter(p => p.category === activeCategory); if (currentSearchTerm) { const terms = currentSearchTerm.toLowerCase().split(' ').filter(Boolean); filtered = filtered.filter(p => { const productText = `${p.title} ${p.description || ''} ${p.id}`.toLowerCase(); return terms.every(term => productText.includes(term)); }); } if (currentSizeFilter !== 'all') { filtered = filtered.filter(p => { const sizeStr = String(p.size || '').toUpperCase(); const baseSizeStr = String(p.base_size || '').toUpperCase(); const filterStr = currentSizeFilter.toUpperCase(); return sizeStr.includes(filterStr) || baseSizeStr === filterStr; }); } currentFilteredProducts = filtered; productGrid.innerHTML = ''; displayedProductCount = 0; const activeCategoryElement = document.querySelector(`.category-card[data-category='${activeCategory}'] span`); categoryTitleMain.textContent = activeCategory === 'all' ? 'جميع المنتجات' : (activeCategoryElement?.textContent || activeCategory); categoryDescription.textContent = categoryDescriptions[activeCategory] || `عرض ${currentFilteredProducts.length} منتج مطابق للفلترة.`; const isFiltered = activeCategory !== 'all' || !!currentSearchTerm || currentSizeFilter !== 'all'; clearFiltersBtn.classList.toggle('hidden', !isFiltered); if (currentFilteredProducts.length > 0) { noResultsDiv.classList.add('hidden'); productGrid.classList.remove('hidden'); loadMoreProducts(instant); } else { noResultsDiv.classList.remove('hidden'); productGrid.classList.add('hidden'); loadMoreButton.classList.add('hidden'); } if (scrollToProducts) { const productsSection = document.getElementById('products'); if (productsSection) { const headerOffset = header?.offsetHeight || 70; const elementPosition = productsSection.getBoundingClientRect().top + window.pageYOffset; const offsetPosition = elementPosition - headerOffset - 30; window.scrollTo({ top: offsetPosition, behavior: 'smooth' }); } } }; const debouncedApplyFilters = debounce((scrollTo) => applyFilters(scrollTo, false), 350);
    const loadMoreProducts = (instant = false) => { if (!productGrid || !loadMoreButton) return; const nextBatch = currentFilteredProducts.slice(displayedProductCount, displayedProductCount + productsPerLoad); if (nextBatch.length === 0 && displayedProductCount === 0) { noResultsDiv.classList.remove('hidden'); productGrid.classList.add('hidden'); loadMoreButton.classList.add('hidden'); return; } else if (nextBatch.length === 0) { loadMoreButton.classList.add('hidden'); return; } const fragment = document.createDocumentFragment(); nextBatch.forEach((product, index) => { const card = createProductCard(product, false); if (!instant) card.style.transitionDelay = `${index * 60}ms`; /* Slightly longer stagger */ fragment.appendChild(card); if (sectionObserver && !card.classList.contains('visible') && !instant) { sectionObserver.observe(card); } else { card.classList.add('visible', 'opacity-100'); card.classList.remove('opacity-0', 'section-animate'); } }); productGrid.appendChild(fragment); displayedProductCount += nextBatch.length; requestAnimationFrame(() => { loadMoreButton.classList.toggle('hidden', displayedProductCount >= currentFilteredProducts.length); loadMoreButton.disabled = false; }); };
    const clearAllFilters = () => { activeCategory = 'all'; currentSearchTerm = ''; currentSizeFilter = 'all'; if(overlaySearchInput) overlaySearchInput.value = ''; if(overlaySizeSelect) overlaySizeSelect.value = 'all'; document.querySelectorAll('.category-card').forEach(el => { const isNowActive = el.dataset.category === 'all'; el.classList.toggle('active', isNowActive); const icon = el.querySelector('i'); if (icon) { icon.classList.toggle('text-primary', isNowActive); icon.classList.toggle('dark:text-primary-light', isNowActive); icon.classList.toggle('text-light-text-secondary', !isNowActive); icon.classList.toggle('dark:text-dark-text-secondary', !isNowActive); } }); applyFilters(true, true); closeSearchFilterOverlay(); };

    // --- WhatsApp Order Submission (Checked) ---
    const handleOrderSubmit = (event) => { event.preventDefault(); if (!orderForm || !formErrorMessage) return; formErrorMessage.classList.add('hidden'); orderForm.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid')); const nameInput = document.getElementById('customer-name'); const phoneInput = document.getElementById('customer-phone'); const addressInput = document.getElementById('customer-address'); let isValid = true; let errors = []; if (!nameInput?.value.trim()) { errors.push("يرجى إدخال الاسم الكامل."); isValid = false; nameInput?.classList.add('invalid'); } if (!phoneInput?.value.trim() || !phoneInput.checkValidity()) { errors.push("رقم هاتف واتساب غير صحيح (مثال: 07xxxxxxxxx)."); isValid = false; phoneInput?.classList.add('invalid'); } if (!addressInput?.value.trim()) { errors.push("يرجى إدخال العنوان الكامل للتوصيل."); isValid = false; addressInput?.classList.add('invalid'); } if (!isValid) { formErrorMessage.innerHTML = errors.join('<br>'); formErrorMessage.classList.remove('hidden'); formErrorMessage.focus(); return; } let message = "👋 *طلب جديد من Master Quality*\n\n"; message += `👤 *الاسم:* ${nameInput.value.trim()}\n`; message += `📞 *الهاتف:* ${phoneInput.value.trim()}\n`; message += `📍 *العنوان:* ${addressInput.value.trim()}\n\n`; message += "🛒 *المنتجات المطلوبة:*\n--------------------\n"; let totalPrice = 0; const currency = "د.ع"; if (cartItemsForOrder.length > 0) { cartItemsForOrder.forEach((item, index) => { message += `${index + 1}. ${item.title} (${item.size}) - *${formatPrice(item.price)} ${currency}*\n`; try { totalPrice += parseInt(item.price.replace(/,/g, ''), 10); } catch {} }); } else { const title = orderFormProductTitle?.value; const size = orderFormProductSize?.value; const price = orderFormProductPrice?.value; if (title && size && price) { message += `1. ${title} (${size}) - *${formatPrice(price)} ${currency}*\n`; try { totalPrice = parseInt(price.replace(/,/g, ''), 10); } catch {} } else { message += "خطأ: لم يتم تحديد المنتج المطلوب.\n"; } } message += "--------------------\n"; if (totalPrice > 0) { message += `💰 *الإجمالي للمنتجات:* ${totalPrice.toLocaleString('ar-IQ')} ${currency}\n`; } message += "*(الدفع نقداً عند الاستلام)*\n\n_تم إرسال هذا الطلب من خلال الموقع._"; const encodedMessage = encodeURIComponent(message); const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`; window.open(whatsappURL, '_blank'); setTimeout(() => { closeOrderModal(); orderForm.reset(); if (cartItemsForOrder.length > 0) { const orderedIds = cartItemsForOrder.map(item => item.id); cart = cart.filter(id => !orderedIds.includes(id)); localStorage.setItem('mqCart_v4', JSON.stringify(cart)); updateCartCount(); renderCartItems(); cartItemsForOrder = []; } }, 800); }; if (orderForm) { orderForm.addEventListener('submit', handleOrderSubmit); ['customer-name', 'customer-phone', 'customer-address'].forEach(id => { const input = document.getElementById(id); input?.addEventListener('input', () => input.classList.remove('invalid')); }); }

    // --- Navigation & Category Filtering (Checked) ---
    const setActiveCategory = (category, clickedElement = null) => { activeCategory = category; document.querySelectorAll('.category-card').forEach(el => { const isNowActive = el.dataset.category === category; el.classList.toggle('active', isNowActive); const icon = el.querySelector('i'); if (icon) { icon.classList.toggle('text-primary', isNowActive); icon.classList.toggle('dark:text-primary-light', isNowActive); icon.classList.toggle('text-light-text-secondary', !isNowActive); icon.classList.toggle('dark:text-dark-text-secondary', !isNowActive); } }); if (clickedElement) { currentSearchTerm = ''; currentSizeFilter = 'all'; if (overlaySearchInput) overlaySearchInput.value = ''; if (overlaySizeSelect) overlaySizeSelect.value = 'all'; } applyFilters(!!clickedElement); };

    // --- Swiper Initialization (Checked) ---
    const initSwiper = () => { if (typeof Swiper === 'undefined') { console.warn("Swiper library not loaded."); const arrivalsSection = document.getElementById('new-arrivals'); if(arrivalsSection) arrivalsSection.style.display = 'none'; return; } if (!newArrivalsWrapper) { console.warn("New arrivals wrapper element not found."); return; } const newArrivals = products.filter(p => p.is_new).sort((a, b) => b.id - a.id); if (newArrivals.length > 0) { newArrivalsWrapper.innerHTML = ''; newArrivals.forEach(product => newArrivalsWrapper.appendChild(createProductCard(product, true))); if (swiperInstance) { swiperInstance.destroy(true, true); swiperInstance = null; } try { swiperInstance = new Swiper('.arrivals-swiper', { slidesPerView: 'auto', spaceBetween: 16, grabCursor: true, loop: newArrivals.length > 5, speed: 500, centeredSlides: false, breakpoints: { 480: { spaceBetween: 16 }, 768: { spaceBetween: 20 }, 1024: { spaceBetween: 24 } }, navigation: { nextEl: '.arrivals-swiper .swiper-button-next', prevEl: '.arrivals-swiper .swiper-button-prev' }, pagination: { el: '.arrivals-swiper .swiper-pagination', clickable: true }, a11y: { enabled: true, prevSlideMessage: 'السابق', nextSlideMessage: 'التالي', paginationBulletMessage: 'الانتقال للشريحة {{index}}' }, preloadImages: false, lazy: { loadPrevNext: true, loadOnTransitionStart: true, elementClass: 'swiper-lazy' }, }); } catch (error) { console.error("Swiper initialization failed:", error); newArrivalsWrapper.classList.add('flex', 'overflow-x-auto', 'gap-4', 'p-4'); const controls = newArrivalsWrapper.closest('.container')?.querySelectorAll('.swiper-button-next, .swiper-button-prev, .swiper-pagination'); controls?.forEach(el => el.style.display = 'none'); } } else { const arrivalsSection = newArrivalsWrapper.closest('#new-arrivals'); if(arrivalsSection) arrivalsSection.style.display = 'none'; } };

    // --- Header Scroll & Active Nav (Checked) ---
    const handleHeaderScroll = () => { if (!header) return; const scrollY = window.scrollY; const shouldBeScrolled = scrollY > 50; header.classList.toggle('scrolled', shouldBeScrolled); let currentSectionId = ''; const sections = document.querySelectorAll('main section[id]'); const headerHeight = header.offsetHeight || 70; const scrollPosition = scrollY + headerHeight + window.innerHeight * 0.3; for (let i = sections.length - 1; i >= 0; i--) { const section = sections[i]; if (section.offsetTop <= scrollPosition) { currentSectionId = section.id; break; } } if (!currentSectionId && scrollY < window.innerHeight * 0.5) { currentSectionId = 'hero'; } mainNavLinks.forEach(link => { const linkHref = link.getAttribute('href'); link.classList.toggle('active', linkHref === `#${currentSectionId}`); }); mobileNavMenuLinks?.forEach(link => { const linkHref = link.getAttribute('href'); const isActive = linkHref === `#${currentSectionId}`; link.classList.toggle('active', isActive); if (isActive) { if (htmlElement.classList.contains('dark')) { link.classList.add('dark:bg-primary-light/15', 'dark:text-primary-light'); link.classList.remove('dark:text-dark-text-secondary'); } else { link.classList.add('bg-primary/10', 'text-primary'); link.classList.remove('text-light-text-secondary'); } } else { link.classList.remove('bg-primary/10', 'text-primary', 'dark:bg-primary-light/15', 'dark:text-primary-light'); link.classList.add('text-light-text-secondary', 'dark:text-dark-text-secondary'); } }); };

    // --- Mobile Menu Toggle (Checked) ---
    const toggleMobileMenu = () => { isMobileMenuOpen = !isMobileMenuOpen; if (mobileNavMenu && mobileNavToggle) { mobileNavMenu.classList.toggle('invisible', !isMobileMenuOpen); mobileNavMenu.classList.toggle('opacity-0', !isMobileMenuOpen); mobileNavMenu.classList.toggle('-translate-y-full', !isMobileMenuOpen); mobileNavMenu.classList.toggle('opacity-100', isMobileMenuOpen); mobileNavMenu.classList.toggle('translate-y-0', isMobileMenuOpen); mobileNavMenu.classList.toggle('-z-10', !isMobileMenuOpen); mobileNavMenu.classList.toggle('z-40', isMobileMenuOpen); const icon = mobileNavToggle.querySelector('i'); if (icon) icon.className = `fas ${isMobileMenuOpen ? 'fa-times' : 'fa-bars'} text-lg transition-transform duration-200 ${isMobileMenuOpen ? 'rotate-90' : ''}`; mobileNavToggle.setAttribute('aria-expanded', String(isMobileMenuOpen)); } }; const closeMobileMenu = () => { if (isMobileMenuOpen) { toggleMobileMenu(); } };

    // --- Section Animation Observer (Checked) ---
    let sectionObserver = null; const initSectionObserver = () => { if (!('IntersectionObserver' in window)) { console.warn("IntersectionObserver not supported."); document.querySelectorAll('.section-animate').forEach(el => { el.classList.add('visible', 'opacity-100', '!transform-none'); el.classList.remove('opacity-0', 'section-animate'); }); return; } sectionObserver = new IntersectionObserver((entries, observer) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); } }); }, { threshold: 0.15, rootMargin: "0px 0px -50px 0px" }); document.querySelectorAll('.section-animate').forEach(section => { if (section) sectionObserver.observe(section); }); };

    // --- Scroll to Top (Checked) ---
    const handleScroll = () => { if (scrollToTopBtn) { if (window.scrollY > window.innerHeight * 0.6) { scrollToTopBtn.classList.add('visible'); } else { scrollToTopBtn.classList.remove('visible'); } } handleHeaderScroll(); }; const scrollToTop = () => { window.scrollTo({ top: 0, behavior: 'smooth' }); };

    // --- Event Listeners Setup (Added Return Policy) ---
    const setupEventListeners = () => {
        window.addEventListener('scroll', debounce(handleScroll, 50));
        document.addEventListener('keydown', handleEscapeKey);
        mobileNavToggle?.addEventListener('click', toggleMobileMenu);
        searchFilterToggleBtn?.addEventListener('click', openSearchFilterOverlay);
        themeToggleButton?.addEventListener('click', toggleTheme);
        cartButton?.addEventListener('click', openCartModal);
        startShoppingBtnCart?.addEventListener('click', () => closeCartModal());

        mobileNavMenuLinks?.forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });

        closeSearchFilterOverlayBtn?.addEventListener('click', closeSearchFilterOverlay);
        searchFilterOverlay?.addEventListener('click', (e) => { if (e.target === searchFilterOverlay) closeSearchFilterOverlay(); });
        applyOverlayFiltersBtn?.addEventListener('click', handleApplyOverlayFilters);
        overlaySearchInput?.addEventListener('input', () => debouncedApplyFilters(true));
        overlaySizeSelect?.addEventListener('change', () => { currentSizeFilter = overlaySizeSelect.value || 'all'; applyFilters(true, true); });
        clearOverlayFiltersBtn?.addEventListener('click', clearAllFilters);

        loadMoreButton?.addEventListener('click', () => { loadMoreButton.disabled = true; setTimeout(loadMoreProducts, 200); });
        clearFiltersBtn?.addEventListener('click', clearAllFilters);

        closeDetailPanelBtn?.addEventListener('click', closeDetailPanel);
        productDetailBackdrop?.addEventListener('click', closeDetailPanel);

        orderFormModalCloseButton?.addEventListener('click', closeOrderModal);
        orderFormModalOverlay?.addEventListener('click', (e) => { if (e.target === orderFormModalOverlay) closeOrderModal(); });

        cartModalCloseButton?.addEventListener('click', closeCartModal);
        cartModalOverlay?.addEventListener('click', (e) => { if (e.target === cartModalOverlay) closeCartModal(); });

        // Ensured cartOrderAllBtn listener is attached
        if(cartOrderAllBtn) {
            cartOrderAllBtn.addEventListener('click', prepareOrderForAllCartItems);
        } else {
            console.error("Cart order all button not found for event listener attachment.");
        }

        // Privacy Policy Modal Listeners
        privacyPolicyLink?.addEventListener('click', (e) => { e.preventDefault(); openPrivacyPolicyModal(); });
        privacyPolicyModalCloseButton?.addEventListener('click', closePrivacyPolicyModal);
        privacyModalCloseBtnBottom?.addEventListener('click', closePrivacyPolicyModal);
        privacyPolicyModalOverlay?.addEventListener('click', (e) => { if (e.target === privacyPolicyModalOverlay) closePrivacyPolicyModal(); });

        // --- NEW: Return Policy Modal Listeners ---
        returnPolicyLink?.addEventListener('click', (e) => { e.preventDefault(); openReturnPolicyModal(); });
        returnPolicyModalCloseButton?.addEventListener('click', closeReturnPolicyModal);
        returnModalCloseBtnBottom?.addEventListener('click', closeReturnPolicyModal);
        returnPolicyModalOverlay?.addEventListener('click', (e) => { if (e.target === returnPolicyModalOverlay) closeReturnPolicyModal(); });

        // Other setup
        const yearSpan = document.getElementById('year');
        if (yearSpan) yearSpan.textContent = new Date().getFullYear();
        scrollToTopBtn?.addEventListener('click', scrollToTop);
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', (e) => {
                e.preventDefault();
                const category = card.dataset.category;
                if (category) {
                    setActiveCategory(category, card);
                }
            });
        });
    };


    // --- Helper Functions (Checked) ---
    const handleApplyOverlayFilters = () => { currentSearchTerm = overlaySearchInput?.value.toLowerCase().trim() || ''; currentSizeFilter = overlaySizeSelect?.value || 'all'; applyFilters(true, true); closeSearchFilterOverlay(); }; const handleEscapeKey = (event) => { if (event.key === 'Escape') { if (productDetailPanel && !productDetailPanel.classList.contains('hidden')) { closeDetailPanel(); } else if (activeModalOverlay) { closeModal(); } else if (isMobileMenuOpen) { closeMobileMenu(); } } };

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => { console.log("DOM Ready. Initializing App."); const storedTheme = localStorage.getItem('mqTheme_v2'); const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches; applyTheme(storedTheme || (prefersDark ? 'dark' : 'light')); initSectionObserver(); initSwiper(); if (productGrid && loadMoreButton) { setActiveCategory('all'); } else { console.error("Core elements (productGrid/loadMoreButton) missing."); } updateCartCount(); setupEventListeners(); handleScroll(); console.log("App Initialized."); });

    </script>

</body>
</html>
